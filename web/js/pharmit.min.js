function Feature(e,a,t){var n=this;this.obj={},this.shape=null,this.selected=!1,this.updateViewer=function(){},this.container=$("<div>").appendTo(a).addClass("featurediv"),this.container.get(0).feature=this,this.container.disableSelection();var i=$("<h3></h3>").appendTo(this.container);this.enabled=$("<div>").addClass("toggle toggle-light togglediv").appendTo(i).toggles().on("toggle",function(e,a){a?(n.obj.enabled=!0,n.container.addClass("enabledfeature")):(n.obj.enabled=!1,n.container.removeClass("enabledfeature")),n.updateViewer()}).click(function(){return!1});var o=$("<div>").addClass("featurenamediv").appendTo(i),r=$("<span>").addClass("featurenameheading").appendTo(o),s=$("<div>").addClass("featureclose").appendTo(i).click(function(){n.shape&&e.removeFeature(n.shape),n.container.feature=null,n.container.remove()}),d=($("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(s),$("<span>").appendTo(o).addClass("featuresummary"));d.append($(document.createTextNode("("))),this.xsummary=$("<span>").appendTo(d),d.append($(document.createTextNode(","))),this.ysummary=$("<span>").appendTo(d),d.append($(document.createTextNode(","))),this.zsummary=$("<span>").appendTo(d),d.append($(document.createTextNode(") Radius "))),this.rsummary=$("<span>").appendTo(d);var l=$("<div>").appendTo(this.container),p=this.select=$('<select name="featurename">').addClass("featureselect").appendTo(l);$.each(this.featureNames,function(e,a){$('<option value="'+a+'">'+a+"</option>").appendTo(p)}),p.change(function(){var e=this.value;n.obj.name=e,r.text(e),"Aromatic"==e||"HydrogenDonor"==e||"HydrogenAcceptor"==e?(n.orientdiv.show(),n.sizediv.hide(),n.obj.hasvec=!0):"Hydrophobic"==e?(n.orientdiv.hide(),n.sizediv.show(),n.obj.hasvec=!1):(n.orientdiv.hide(),n.sizediv.hide(),n.obj.hasvec=!1),n.updateViewer()}),p.selectmenu({width:"12em",change:function(){p.trigger("change")}});var c=$("<div>").appendTo(l).addClass("locationdiv"),u=function(e,a){var t=function(){e.change()};return a.spin=a.stop=a.change=t,a},h=function(e){return Math.round(1e3*e)/1e3},m=$("<div>").appendTo(c).addClass("coorddiv");$("<label>x:</label>").appendTo(m),this.x=$("<input>").appendTo(m).addClass("coordinput").change(function(){var e=this.value=h(parseFloat(this.value));n.xsummary.text(numeral(e).format("0.[00]")),n.obj.x=h(e),n.updateViewer()}),this.x.spinner(u(n.x,{step:.1,numberFormat:"n"})),m=$("<div>").appendTo(c).addClass("coorddiv"),$("<label>y:</label>").appendTo(m),this.y=$("<input>").appendTo(m).addClass("coordinput"),this.y.spinner(u(n.y,{step:.1,numberFormat:"n"})).change(function(){var e=this.value=h(parseFloat(this.value));n.ysummary.text(numeral(e).format("0.[00]")),n.obj.y=h(e),n.updateViewer()}),m=$("<div>").appendTo(c).addClass("coorddiv"),$("<label>z:</label>").appendTo(m),this.z=$("<input>").appendTo(m).addClass("coordinput"),this.z.spinner(u(n.z,{step:.1,numberFormat:"n"})).change(function(){var e=this.value=h(parseFloat(this.value));n.zsummary.text(numeral(e).format("0.[00]")),n.obj.z=e,n.updateViewer()}),m=$("<div>").appendTo(c).addClass("coorddiv"),$("<label>Radius:</label>").appendTo(m),this.radius=$("<input>").appendTo(m).addClass("radiusinput"),this.radius.spinner(u(n.radius,{step:.1,numberFormat:"n"})).change(function(){n.rsummary.text(numeral(this.value).format("0.[00]")),n.obj.radius=this.value=h(this.value),n.updateViewer()});var v=this.orientdiv=$("<div>").appendTo(l).addClass("orientdiv"),f=null,b=null,g=function(){var e=Math.round(parseFloat(b.val()))%360,a=Math.round(parseFloat(f.val()))%360;isNaN(e)&&(e=0),isNaN(a)&&(a=0),b.val(e),f.val(a),a=a*Math.PI/180,e=e*Math.PI/180,n.obj.svector={x:Math.sin(a)*Math.cos(e),y:Math.sin(a)*Math.sin(e),z:Math.cos(a)},n.updateViewer()};this.orientenabled=$('<input type="checkbox">').appendTo(v).change(function(){$(this).prop("checked")?(f.spinner("option","disabled",!1),b.spinner("option","disabled",!1),n.obj.vector_on=1):(f.spinner("option","disabled",!0),b.spinner("option","disabled",!0),n.obj.vector_on=0,g()),n.updateViewer()});var y=$("<span>").addClass("nowrap").appendTo(v);$("<label>&theta;:</label>").appendTo(y),f=this.theta=$("<input>").appendTo(y).addClass("orientinput"),this.theta.spinner(u(n.theta,{step:1,numberFormat:"n"})).change(g),y=$("<span>").addClass("nowrap").appendTo(v),$("<label>&phi;:</label>").appendTo(y),b=this.phi=$("<input>").appendTo(y).addClass("orientinput"),this.phi.spinner(u(n.theta,{step:1,numberFormat:"n"})).change(g),this.orientdiv.hide();var T=this.sizediv=$("<div>").appendTo(l).addClass("sizediv");this.minsize=$("<input>").appendTo(T).addClass("sizeinput"),this.minsize.spinner(u(n.minsize,{step:1,numberFormat:"n"})).change(function(){n.obj.minsize=this.value,n.updateViewer()}),$("<label> &le; #Atoms &le;</label>").appendTo(T).addClass("nowrap"),this.maxsize=$("<input>").appendTo(T).addClass("sizeinput"),this.maxsize.spinner(u(n.maxsize,{step:1,numberFormat:"n"})).change(function(){n.obj.maxsize=this.value,n.updateViewer()}),this.sizediv.hide(),this.setFeature(t),delete this.updateViewer,this.viewer=e,this.updateViewer(),a.accordion("refresh"),a.accordion("option","active",a.children().length-1)}Feature.prototype.setFeature=function(e){if(this.select.val(e.name).trigger("change"),this.select.selectmenu("refresh"),this.x.val(e.x).trigger("change"),this.y.val(e.y).trigger("change"),this.z.val(e.z).trigger("change"),this.radius.val(e.radius).trigger("change"),this.enabled.toggles(e.enabled),this.obj.enabled=!!e.enabled,this.orientenabled.prop("checked",1==e.vector_on).trigger("change"),$.isNumeric(e.minsize)?this.minsize.val(e.minsize).trigger("change"):this.obj.minsize="",$.isNumeric(e.maxsize)?this.maxsize.val(e.maxsize).trigger("change"):this.obj.maxsize="",e.svector){var a=e.svector.x,t=e.svector.y,n=e.svector.z,i=180*Math.acos(n/Math.sqrt(a*a+t*t+n*n))/Math.PI,o=180*Math.atan2(t,a)/Math.PI;this.theta.val(i).trigger("change"),this.phi.val(o).trigger("change")}else this.obj.svector={x:1,y:0,z:0}},Feature.prototype.featureNames=["Aromatic","HydrogenDonor","HydrogenAcceptor","Hydrophobic","NegativeIon","PositiveIon"],Feature.prototype.updateViewer=function(){if(null!==this.shape&&this.viewer.removeFeature(this.shape),this.obj.enabled){var e=this;this.shape=this.viewer.addFeature(this.obj,function(){e.selected?e.deselectFeature():e.selectFeature()})}},Feature.prototype.selectFeature=function(){this.viewer.selectFeature(this.shape),this.container.addClass("selectedFeature"),this.selected=!0,this.obj.selected=!0},Feature.prototype.deselectFeature=function(){this.viewer.unselectFeature(this.shape),this.container.removeClass("selectedFeature"),this.selected=!1,this.obj.selected=!1},function(e){e.support.cssPseudoClasses=function(){try{var a=e("<input type='checkbox' checked/>").appendTo("body"),t=e('<style type="text/css" />').appendTo("head");t.text("input:checked {width: 200px; display: none}");var n="200px"==a.css("width");return a.remove(),t.remove(),n}catch(i){return!1}}(),e.fn.fileinput=function(a){var t=this;return a||(a='<button class="fileinput">Browse...</button>'),t.each(function(){var t=e(this);t.wrap('<div class="fileinput-wrapper" style=" position: relative; display: inline-block;" />'),t.parent().mousemove(function(a){var t,n,i=e(this);t=i.offset().left,n=i.offset().top,i.find("input").css({left:a.pageX-t-i.find("input[type=file]").width()+30,top:a.pageY-n-10})}),t.attr("tabindex","-1").css({filter:"alpha(opacity=0)","-moz-opacity":0,opacity:0,position:"absolute","z-index":-1}),t.before(a),t.prev().addClass("fileinput"),e.support.cssPseudoClasses?(t.prev(".fileinput").click(function(){t.click()}),t.prev(":submit.fileinput").click(function(e){e.preventDefault()})):(t.css({"z-index":"auto",cursor:"pointer"}),t.prev(".fileinput").css("z-index",-1),t.removeAttr("tabindex"),t.prev(".fileinput").attr("tabindex","-1"),t.hover(function(){e(this).prev(".fileinput").addClass("hover")},function(){e(this).prev(".fileinput").removeClass("hover")}).focusin(function(){e(this).prev(".fileinput").addClass("focus")}).focusout(function(){e(this).prev(".fileinput").removeClass("focus")}).mousedown(function(){e(this).prev(".fileinput").addClass("active")}).mouseup(function(){e(this).prev(".fileinput").removeClass("active")}))}),t}}(jQuery);var Pharmit={};$(document).ready(function(){var e=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+e+"=([^&#]*)",t=new RegExp(a),n=t.exec(window.location.href);return null===n?null:n[1]};Pharmit.server="/fcgi-bin/pharmitserv.fcgi";var a=$("#pharmit"),t=new Pharmit.Viewer(a),n=(new Pharmit.PharmaResults(a,t),new Pharmit.Query(a,t));e("SESSION")&&$.get(decodeURI(e("SESSION")),function(e){n.loadSession(e)}),$("button, input[type='button'], input[type='submit']").button().bind("mouseup",function(){$(this).blur()})});var Pharmit=Pharmit||{};Pharmit.PharmaResults=function(){function e(){}return e}();var Pharmit=Pharmit||{};Pharmit.Query=function(){function e(e,t){var n=$("<div>").addClass("pharmit_query"),i=null,o=null,r=null,s=null,d=null,l=null,p=function(){},c=function(e,a){if(e.files.length>0){var t=e.files[0],n=new FileReader;n.onload=function(e){a(e.target.result,t.name)},n.readAsText(t),$(e).val("")}},u=function(){},h=function(e,a){r=e,s=a,t.setReceptor(e,a)},m=function(){var e=i.children().detach();e.sort(function(e,a){var t=e.feature.obj,n=a.feature.obj;return t.enabled!=n.enabled?n.enabled-t.enabled:t.name!=n.name?t.name.localeCompare(n.name):t.radius-n.radius}),i.append(e)},v=this.loadSession=function(e){var a=$.parseJSON(e);i.detach(),i.empty(),a.points&&$.each(a.points,function(e,a){new Feature(t,i,a)}),i.accordion("option","active",!1),i.accordion("refresh"),o.after(i),$.each(a,function(e,a){var t=$("input[name="+e+"]");t.length&&t.val(a)}),r=a.receptor,s=a.recname,t.setReceptor(r,s),a.sdf?(d=decodeURIComponent(a.sdf),l=d.match(/^@<TRIPOS>MOLECULE/)?".mol2":d.match(/^HETATM/)||d.match(/^ATOM/)?".pdb":d.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/)?".sdf":".xyz"):(d=a.ligand,l=a.ligandFormat),t.setLigand(d,l),a.backgroundcolor&&$("#"+a.backgroundcolor).prop("checked",!0).change(),t.setView(a.view)},f=function(){var e={};return e.points=[],$.each(i.children(),function(a,t){e.points.push(t.feature.obj)}),$.each($("[name]",n),function(a,t){t.name&&(e[t.name]=t.value)}),e.backgroundcolor="whiteBackground",$("#blackBackground").prop("checked")&&(e.backgroundcolor="blackBackground"),e.ligand=d,e.ligandFormat=l,e.receptor=r,e.recname=s,e},b=function(){var e=Pharmit.server+'?cmd=savedata&type="text%2Fphjson"&fname="pharmit.json"',a=$("<form>",{action:e,method:"post"}),t=f();a.append($("<input>",{name:"data",type:"hidden",value:JSON.stringify(t,null,4)})),a.appendTo(document.body),a.submit(),$(a).remove()},g=function(e,a){var t=$("<div>").addClass("searchdiv"),n=$("<button>Search "+a[0]+"</button>").appendTo(t).button(),i=$("<button>Select subset to search</button>").appendTo(t).button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}});t.buttonset();for(var o=$("<ul>").appendTo($("body")).addClass("floatmenu"),r=[],s=0,d=a.length;d>s;s++)r[s]="<li>"+a[s]+"</li>";o.append(r),o.hide().menu().on("menuselect",function(e,a){n.button("option","label","Search "+a.item.text())}),n.click(p),i.click(function(){var e=o.show().position({my:"left top",at:"left buttom",of:this});return $(document).one("click",function(){e.hide()}),!1}),e.prepend(t)},y=$("<div>").appendTo(n).addClass("leftclose"),T=$("<span>").addClass("ui-icon ui-icon-carat-1-w").appendTo(y);n.resizable({handles:"e",resize:function(e,a){t.setLeft(a.size.width)}}),n.disableSelection(),y.click(function(){if(y.hasClass("leftisclosed")){y.removeClass("leftisclosed"),T.removeClass("ui-icon-carat-1-e"),T.addClass("ui-icon-carat-1-w");var e=n.width();n.css("width","");var a=n.width();n.width(e),n.animate({width:a},{progress:function(){t.setLeft(n.width())}}),n.resizable("option","disabled",!1)}else n.animate({width:0},{progress:function(){t.setLeft(n.width())}}),y.addClass("leftisclosed"),T.addClass("ui-icon-carat-1-e"),T.removeClass("ui-icon-carat-1-w"),n.resizable("option","disabled",!0)});var w=$("<div>").appendTo(n).addClass("queryheader");g(w,["MolPort","ZINC"]);var C=$("<div>").appendTo(w).addClass("loaderdiv").addClass("nowrap"),x=$("<button>Load Receptor...</button>").button(),z=$("<button>Load Features...</button>").button();e.append(n);$('<input type="file">').appendTo(C).fileinput(x).change(function(){c(this,h)}),$('<input type="file">').appendTo(C).fileinput(z).change(u);n.detach();var k=$("<div>").appendTo(n).addClass("querybody"),S=$("<div>").appendTo(k);o=$("<div>Pharmacophore</div>").appendTo(S).addClass("queryheading"),i=$("<div>").appendTo(S),i.accordion({header:"> div > h3",animate:!0,collapsible:!0,heightStyle:"content",beforeActivate:function(e,a){var t=null,n=i.children();$.each(n,function(e,a){a.feature.deselectFeature()}),a.newHeader.length>0&&(t=a.newHeader.parent(),t.get(0).feature.selectFeature())}}).sortable({axis:"y",handle:"h3",stop:function(e,a){a.item.children("h3").triggerHandler("focusout"),$(this).accordion("refresh")}});var F=$("<div>").appendTo(S).addClass("featurebuttons"),M=($("<button>Add</button>").appendTo(F).button({text:!0,icons:{secondary:"ui-icon-circle-plus"}}).click(function(){new Feature(t,i,a)}),$("<button>Sort</button>").appendTo(F).button({text:!0,icons:{secondary:"ui-icon ui-icon-carat-2-n-s"}}).click(m),$("<div>").appendTo(k));$("<div>Filters</div>").appendTo(M).addClass("queryheading");var P=$("<div>").appendTo(M),j=$("<h3>Hit Reduction<br></h3>").appendTo(P),R=($('<span class="headingsummary"></span>').appendTo(j),$("<div>").addClass("hitreduction").appendTo(P)),V=$("<table>").appendTo(R),H=$("<tr>").addClass("filterrow").appendTo(V);$("<td>").append('<label title="Maximum number of orientations returned for each conformation" value="1" for="reduceorienttext">Max Hits per Conf:</label>').appendTo(H);var L=$("<td>").appendTo(H);$('<input id="reduceorienttext" name="max-orient">').appendTo(L).spinner(),H=$("<tr>").addClass("filterrow").appendTo(V),$("<td>").append('<label title="Maximum number of conformations returned for each compound" value="1" for="reduceconfstext">Max Hits per Mol:</label>').appendTo(H),L=$("<td>").appendTo(H),$('<input id="reduceconfstext" name="reduceConfs">').appendTo(L).spinner(),H=$("<tr>").addClass("filterrow").appendTo(V),$("<td>").append('<label title="Maximum number of hits returned" value="1" for="reducehitstext">Max Total Hits:</label>').appendTo(H),L=$("<td>").appendTo(H),$('<input id="reducehitstext" name="max-hits">').appendTo(L).spinner(),j=$("<h3>Hit Screening<br></h3>").appendTo(P);var N=($('<span class="headingsummary"></span>').appendTo(j),$('<div class="hitscreening"></div>').appendTo(P)),A=$("<table>").appendTo(N);H=$("<tr>").addClass("filterrow").appendTo(A),L=$("<td>").appendTo(H),$('<input id="minmolweight" name="minMolWeight">').appendTo(L).spinner(),$("<td>").appendTo(H).append($('<label title="Minimum/maximum molecular weight (weights are approximate)" value="1" for="maxmolweight">&le;  MolWeight &le;</label>')),L=$("<td>").appendTo(H),$('<input id="maxmolweight" name=maxMolWeight>').appendTo(L).spinner(),H=$("<tr>").addClass("filterrow").appendTo(A),L=$("<td>").appendTo(H),$('<input id="minnrot" name="minrotbonds">').appendTo(L).spinner(),$("<td>").appendTo(H).append($('<label title="Minimum/maximum number of rotatable bonds" value="1" for="maxnrot"> &le;  RotBonds &le;</label>')),L=$("<td>").appendTo(H),$('<input id="maxnrot" name="maxrotbonds">').appendTo(L).spinner(),P.accordion({animate:!0,active:!1,collapsible:!0,heightStyle:"content"});var B=$("<div>").appendTo(k);$("<div>Visualization</div>").appendTo(B).addClass("queryheading");var I=$("<div>").appendTo(B).addClass("vizdiv");t.appendViewerControls(I);var D=$("<div>").appendTo(n).addClass("queryfooter"),O=$("<div>").appendTo(D).addClass("bottomloaders").addClass("nowrap");e.append(n);{var q=$("<button>Load Session...</button>").button();$('<input type="file">').appendTo(O).fileinput(q).change(function(){c(this,v)}),$("<button>Save Session...</button>").appendTo(O).button().click(b)}t.setLeft(n.width())}var a={name:"Hydrophobic",x:0,y:0,z:0,radius:1,enabled:!0,vector_on:0,minsize:"",maxsize:"",svector:null,hasvec:!1};return e}();var Pharmit=Pharmit||{};Pharmit.Viewer=function(){"use strict";function e(e){var a=($3Dmol.elementColors,{none:"None",rasmol:"RasMol",whiteCarbon:"White",greenCarbon:"Green",cyanCarbon:"Cyan",magentaCarbon:"Magenta",yellowCarbon:"Yellow",orangeCarbon:"Orange",purpleCarbon:"Purple",blueCarbon:"Blue"}),t={left:0,right:0},n={Aromatic:"purple",HydrogenDonor:"0xf0f0f0",HydrogenAcceptor:"orange",Hydrophobic:"green",NegativeIon:"red",PositiveIon:"blue"},i={Ligand:{model:null,style:{stick:{radius:.15}}},Receptor:{model:null,style:{cartoon:{},line:{linewidth:3}}},Results:{model:null,style:{stick:{}}}},o={sphere:{radius:.2}},r=null,s={map:{prop:"partialCharge",scheme:new $3Dmol.Gradient.RWB(-.8,.8)},opacity:.8},d=null,l=[],p=function(e){if(!e)return"";var a=e.split(".");return a.length<=1?"":a.pop()},c=function(e,t,n){var o=$("<tr>").appendTo(n).addClass("styleselectrow"),r=e+"MolStyleSelect";$('<label for="'+r+'">'+e+" Style:</label>").appendTo(o).addClass("stylelabel").appendTo($("<td>").appendTo(o));var s=$("<td>").appendTo(o),l=$('<select name="'+r+'" id="'+r+'">').appendTo(s).addClass("styleselector");$.each(a,function(e,a){$('<option value="'+e+'">'+a+"</option>").appendTo(l)}),l.val(t),l.selectmenu({width:"9em",appendTo:n,change:function(){l.change()},position:{my:"left top",at:"left bottom",collision:"flip"}}),l.change(function(){var a=this.value,t=i[e].style;$.each(t,function(e,t){"none"==a?t.hidden=!0:(t.colorscheme=a,delete t.hidden)});var n=i[e].model;n&&n.setStyle({},t),l.selectmenu("refresh"),d.render()}),l.change()};this.appendViewerControls=function(e){var a=$("<table>").appendTo(e);c("Ligand","rasmol",a,null),c("Results","rasmol",a,null),c("Receptor","rasmol",a,null);var t=$("<div>").addClass("surfacetransparencydiv").appendTo(e);$('<label for="surfaceopacity">Receptor Surface Opacity:</label>').appendTo(t);var n=$("<div>").addClass("surfacetransparencyslider").appendTo(t);$('<div id="surfaceopacity" name="surfaceopacity">').appendTo(n).slider({animate:"fast",step:.05,min:0,max:1,value:.8,change:function(e,a){s.opacity=a.value,null!==r&&d.setSurfaceMaterialStyle(r,s),d.render()}});var i=$("<div>").addClass("backgroundcolordiv").appendTo(e);$('<label for="backgroundcolor">Background Color:</label>').appendTo(i);var o=$('<div id="backgroundcolor">').appendTo(i);$('<input type="radio" id="whiteBackground" name="backgroundcolor"><label for="whiteBackground">White</label>').appendTo(o).change(function(){$(this).prop("checked")&&d.setBackgroundColor("white"),o.buttonset("refresh")}).prop("checked",!0),$('<input type="radio" id="blackBackground" name="backgroundcolor"><label for="blackBackground">Black</label>').appendTo(o).change(function(){$(this).prop("checked")&&d.setBackgroundColor("black"),o.buttonset("refresh")}),o.buttonset()};this.setReceptor=function(e,a){var t=i.Receptor.model;if(t&&d.removeModel(t),t=null,null!==r&&d.removeSurface(r),r=null,e){var n=p(a);t=d.addModel(e,n),t.setStyle({},i.Receptor.style),t.setStyle({bonds:0},o),i.Receptor.model=t,d.render(),d.mapAtomProperties($3Dmol.applyPartialCharges,{model:t}),r=d.addSurface($3Dmol.SurfaceType.VDW,s,{model:t},{bonds:0,invert:!0}),d.zoomTo({})}d.render()},this.setLigand=function(e,a){var t=i.Ligand.model;if(t&&d.removeModel(t),t=null,e){var n=p(a);t=d.addModel(e,n),t.setStyle({},i.Ligand.style),i.Ligand.model=t,d.zoomTo({model:t})}d.render()},this.setView=function(e){e&&d.setView(e)},this.getView=function(){return d.getView()},this.addFeature=function(e,a){var t={center:{x:e.x,y:e.y,z:e.z},radius:e.radius,color:n[e.name],wireframe:!0,linewidth:1.5,clickable:!0,callback:a},i={sphere:null,arrows:[],label:null};if(i.sphere=d.addSphere(t),e.selected&&i.sphere.updateStyle({wireframe:!1}),e.hasvec&&e.vector_on&&e.svector){var o=new $3Dmol.Vector3(e.svector.x,e.svector.y,e.svector.z),r=e.radius+1,s=(r-.5)/r;o=o.normalize();var p=o.clone().multiplyScalar(e.radius).add(e),c=o.clone().multiplyScalar(r).add(e),u={start:p,end:c,radius:.075,radiusRatio:2,mid:s,wireframe:!e.selected,color:n[e.name]};i.arrows.push(d.addArrow(u)),"Aromatic"==e.name&&(p=o.clone().multiplyScalar(-e.radius).add(e),c=o.clone().multiplyScalar(-r).add(e),u.start=p,u.end=c,i.arrows.push(d.addArrow(u)))}if("Hydrophobic"==e.name){var h=e.minsize+":"+e.maxsize;if(":"!=h){var m={position:{x:e.x,y:e.y,z:e.z},showBackground:!0,fontColor:"black",backgroundColor:n[e.name],backgroundOpacity:.5,alignment:$3Dmol.SpriteAlignment.center};i.label=d.addLabel(h,m)}}return d.render(),l.push(i),l.length-1},this.selectFeature=function(e){var a=l[e];a&&a.sphere&&(a.sphere.updateStyle({wireframe:!1}),$.each(a.arrows,function(e,a){a.updateStyle({wireframe:!1})}),d.render())},this.unselectFeature=function(e){var a=l[e];a&&a.sphere&&(a.sphere.updateStyle({wireframe:!0}),$.each(a.arrows,function(e,a){a.updateStyle({wireframe:!0})}),d.render())},this.removeFeature=function(e){var a=l[e];for(a&&(a.sphere&&d.removeShape(a.sphere),$.each(a.arrows,function(e,a){d.removeShape(a)}),a.label&&d.removeLabel(a.label),d.render()),delete l[e];l.length>0&&"undefined"==typeof l[l.length-1];)l.pop()},this.setLeft=function(e){var a=e-t.left;t.left=e,d.translate(a/2,0)},this.setRight=function(e){var a=t.right-e;t.right=e,d.translate(a/2,0)},d=new $3Dmol.GLViewer(e),d.setBackgroundColor("white")}return e}();