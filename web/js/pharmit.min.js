function Feature(e,t,a,n){var i=null,i=n==Feature.INCLUSIVESHAPE?["InclusionSphere"]:n==Feature.EXCLUSIVESHAPE?["ExclusionSphere"]:["Aromatic","HydrogenDonor","HydrogenAcceptor","Hydrophobic","NegativeIon","PositiveIon"],r=this;this.obj={},this.shape=null,this.selected=!1,this.updateViewer=function(){},this.container=$("<div>").appendTo(t).addClass("pharmit_featurediv"),(this.container.get(0).feature=this).container.disableSelection();var o=$("<h3></h3>").appendTo(this.container);this.enabled=$("<div>").addClass("toggle toggle-light pharmit_togglediv").appendTo(o).toggles().on("toggle",function(e,t){t?(r.obj.enabled=!0,r.container.addClass("pharmit_enabledfeature")):(r.obj.enabled=!1,r.container.removeClass("pharmit_enabledfeature")),r.updateViewer()}).click(function(e){return!1});var s=$("<div>").addClass("pharmit_featurenamediv").appendTo(o),l=$("<span>").addClass("pharmit_featurenameheading").appendTo(s),d=$("<div>").addClass("pharmit_featureclose").appendTo(o).click(function(){r.deleteFeature()}),p=($("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(d),$("<span>").appendTo(s).addClass("pharmit_featuresummary"));p.append($(document.createTextNode("("))),this.xsummary=$("<span>").appendTo(p),p.append($(document.createTextNode(","))),this.ysummary=$("<span>").appendTo(p),p.append($(document.createTextNode(","))),this.zsummary=$("<span>").appendTo(p),p.append($(document.createTextNode(") Radius "))),this.rsummary=$("<span>").appendTo(p);var c=$("<div>").appendTo(this.container),h=this.select=$("<select>").addClass("pharmit_featureselect").appendTo(c);$.each(i,function(e,t){$('<option value="'+t+'">'+t+"</option>").appendTo(h)}),h.change(function(){var e=this.value;r.obj.name=e,l.text(e),"Aromatic"==e||"HydrogenDonor"==e||"HydrogenAcceptor"==e?(r.orientdiv.show(),r.sizediv.hide(),r.obj.hasvec=!0):("Hydrophobic"==e?(r.orientdiv.hide(),r.sizediv.show()):(r.orientdiv.hide(),r.sizediv.hide()),r.obj.hasvec=!1),r.updateViewer()}),h.selectmenu({width:"15em",change:function(){h.trigger("change")}}),i.length<=1&&h.next(".ui-selectmenu-button").hide();function u(e,t){return t.spin=t.stop=t.change=function(){e.change()},t}function m(e,t){if($.isNumeric(e.value)){var a=parseFloat(e.value);return t&&t.text(numeral(a).format("0.0[0]")),r.updateViewer(),n=a,Math.round(1e3*n)/1e3}var n}var f=$("<div>").appendTo(c).addClass("pharmit_locationdiv"),v=$("<div>").appendTo(f).addClass("pharmit_coorddiv");$("<label>x:</label>").appendTo(v),this.x=$("<input>").appendTo(v).addClass("pharmit_coordinput").change(function(){r.obj.x=m(this,r.xsummary)}),this.x.spinner(u(r.x,{step:.1,numberFormat:"n"})),v=$("<div>").appendTo(f).addClass("pharmit_coorddiv"),$("<label>y:</label>").appendTo(v),this.y=$("<input>").appendTo(v).addClass("pharmit_coordinput"),this.y.spinner(u(r.y,{step:.1,numberFormat:"n"})).change(function(){r.obj.y=m(this,r.ysummary)}),v=$("<div>").appendTo(f).addClass("pharmit_coorddiv"),$("<label>z:</label>").appendTo(v),this.z=$("<input>").appendTo(v).addClass("pharmit_coordinput"),this.z.spinner(u(r.z,{step:.1,numberFormat:"n"})).change(function(){r.obj.z=m(this,r.zsummary)}),v=$("<div>").appendTo(f).addClass("pharmit_coorddiv"),$("<label>Radius:</label>").appendTo(v),this.radius=$("<input>").appendTo(v).addClass("pharmit_radiusinput"),this.radius.spinner(u(r.radius,{step:.1,numberFormat:"n"})).change(function(){r.obj.radius=m(this,r.rsummary)});function b(){var e=Math.round(parseFloat(w.val()))%360,t=Math.round(parseFloat(y.val()))%360;isNaN(e)&&(e=0),isNaN(t)&&(t=0),w.val(e),y.val(t),t=t*Math.PI/180,e=e*Math.PI/180,r.obj.svector={x:Math.sin(t)*Math.cos(e),y:Math.sin(t)*Math.sin(e),z:Math.cos(t)},r.updateViewer()}var g=this.orientdiv=$("<div>").appendTo(c).addClass("pharmit_orientdiv"),y=null,w=null;this.orientenabled=$('<input type="checkbox">').appendTo(g).change(function(){$(this).prop("checked")?(y.spinner("option","disabled",!1),w.spinner("option","disabled",!1),r.obj.vector_on=1):(y.spinner("option","disabled",!0),w.spinner("option","disabled",!0),r.obj.vector_on=0,b()),r.updateViewer()});var T=$("<span>").addClass("pharmit_nowrap").appendTo(g);$("<label>&theta;:</label>").appendTo(T),y=this.theta=$("<input>").appendTo(T).addClass("pharmit_orientinput"),this.theta.spinner(u(r.theta,{step:1,numberFormat:"n"})).change(b),T=$("<span>").addClass("pharmit_nowrap").appendTo(g),$("<label>&phi;:</label>").appendTo(T),w=this.phi=$("<input>").appendTo(T).addClass("pharmit_orientinput"),this.phi.spinner(u(r.theta,{step:1,numberFormat:"n"})).change(b),this.orientdiv.hide();var _=this.sizediv=$("<div>").appendTo(c).addClass("pharmit_sizediv");this.minsize=$("<input>").appendTo(_).addClass("pharmit_sizeinput"),this.minsize.spinner(u(r.minsize,{step:1,numberFormat:"n"})).change(function(){r.obj.minsize=this.value,r.updateViewer()}),$("<label> &le; #Atoms &le;</label>").appendTo(_).addClass("pharmit_nowrap"),this.maxsize=$("<input>").appendTo(_).addClass("pharmit_sizeinput"),this.maxsize.spinner(u(r.maxsize,{step:1,numberFormat:"n"})).change(function(){r.obj.maxsize=this.value,r.updateViewer()}),this.sizediv.hide(),this.setFeature(a),delete this.updateViewer,this.viewer=e,this.updateViewer(),t.accordion("refresh"),t.accordion("option","active",t.children().length-1)}Feature.INCLUSIVESHAPE=1,Feature.EXCLUSIVESHAPE=2,Feature.prototype.setFeature=function(e){var t,a,n,i,r;this.select.val(e.name).trigger("change"),this.select.selectmenu("refresh"),this.x.val(e.x).trigger("change"),this.y.val(e.y).trigger("change"),this.z.val(e.z).trigger("change"),this.radius.val(e.radius).trigger("change"),this.enabled.toggles(e.enabled),this.obj.enabled=!!e.enabled,this.orientenabled.prop("checked",1==e.vector_on).trigger("change"),$.isNumeric(e.minsize)?this.minsize.val(e.minsize).trigger("change"):this.obj.minsize="",$.isNumeric(e.maxsize)?this.maxsize.val(e.maxsize).trigger("change"):this.obj.maxsize="",e.svector?(t=e.svector.x,a=e.svector.y,n=e.svector.z,i=180*Math.acos(n/Math.sqrt(t*t+a*a+n*n))/Math.PI,r=180*Math.atan2(a,t)/Math.PI,this.theta.val(i).trigger("change"),this.phi.val(r).trigger("change")):this.obj.svector={x:1,y:0,z:0}},Feature.prototype.hideFeature=function(){this.obj.hidden=!0,null!==this.shape&&this.viewer.removeFeature(this.shape),this.updateViewer()},Feature.prototype.unhideFeature=function(){this.obj.hidden=!1,this.updateViewer()},Feature.prototype.updateViewer=function(){var e;null!==this.shape&&(this.viewer.removeFeature(this.shape),this.shape=null),this.obj.enabled&&!this.obj.hidden&&((e=this).shape=this.viewer.addFeature(this.obj,function(){e.selected?e.deselectFeature():e.selectFeature()}))},Feature.prototype.selectFeature=function(){this.viewer.selectFeature(this.shape),this.container.addClass("pharmit_selectedFeature"),this.selected=!0,this.obj.selected=!0},Feature.prototype.deselectFeature=function(){this.viewer.unselectFeature(this.shape),this.container.removeClass("pharmit_selectedFeature"),this.selected=!1,this.obj.selected=!1},Feature.prototype.deleteFeature=function(){null!==this.shape&&this.viewer.removeFeature(this.shape),this.container.feature=null,this.container.remove()};var Pharmit=Pharmit||{};!function(){var r=0;function e(e){return a(t(n(e)))}function t(e){return o(s(i(e),8*e.length))}function a(e){for(var t,a=r?"0123456789ABCDEF":"0123456789abcdef",n="",i=0;i<e.length;i++)t=e.charCodeAt(i),n+=a.charAt(t>>>4&15)+a.charAt(15&t);return n}function n(e){for(var t,a,n="",i=-1;++i<e.length;)t=e.charCodeAt(i),a=i+1<e.length?e.charCodeAt(i+1):0,55296<=t&&t<=56319&&56320<=a&&a<=57343&&(t=65536+((1023&t)<<10)+(1023&a),i++),t<=127?n+=String.fromCharCode(t):t<=2047?n+=String.fromCharCode(192|t>>>6&31,128|63&t):t<=65535?n+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):t<=2097151&&(n+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return n}function i(e){for(var t=Array(e.length>>2),a=0;a<t.length;a++)t[a]=0;for(a=0;a<8*e.length;a+=8)t[a>>5]|=(255&e.charCodeAt(a/8))<<a%32;return t}function o(e){for(var t="",a=0;a<32*e.length;a+=8)t+=String.fromCharCode(e[a>>5]>>>a%32&255);return t}function s(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var a=1732584193,n=-271733879,i=-1732584194,r=271733878,o=0;o<e.length;o+=16){var s=a,l=n,d=i,p=r,a=c(a,n,i,r,e[o+0],7,-680876936),r=c(r,a,n,i,e[o+1],12,-389564586),i=c(i,r,a,n,e[o+2],17,606105819),n=c(n,i,r,a,e[o+3],22,-1044525330);a=c(a,n,i,r,e[o+4],7,-176418897),r=c(r,a,n,i,e[o+5],12,1200080426),i=c(i,r,a,n,e[o+6],17,-1473231341),n=c(n,i,r,a,e[o+7],22,-45705983),a=c(a,n,i,r,e[o+8],7,1770035416),r=c(r,a,n,i,e[o+9],12,-1958414417),i=c(i,r,a,n,e[o+10],17,-42063),n=c(n,i,r,a,e[o+11],22,-1990404162),a=c(a,n,i,r,e[o+12],7,1804603682),r=c(r,a,n,i,e[o+13],12,-40341101),i=c(i,r,a,n,e[o+14],17,-1502002290),a=h(a,n=c(n,i,r,a,e[o+15],22,1236535329),i,r,e[o+1],5,-165796510),r=h(r,a,n,i,e[o+6],9,-1069501632),i=h(i,r,a,n,e[o+11],14,643717713),n=h(n,i,r,a,e[o+0],20,-373897302),a=h(a,n,i,r,e[o+5],5,-701558691),r=h(r,a,n,i,e[o+10],9,38016083),i=h(i,r,a,n,e[o+15],14,-660478335),n=h(n,i,r,a,e[o+4],20,-405537848),a=h(a,n,i,r,e[o+9],5,568446438),r=h(r,a,n,i,e[o+14],9,-1019803690),i=h(i,r,a,n,e[o+3],14,-187363961),n=h(n,i,r,a,e[o+8],20,1163531501),a=h(a,n,i,r,e[o+13],5,-1444681467),r=h(r,a,n,i,e[o+2],9,-51403784),i=h(i,r,a,n,e[o+7],14,1735328473),a=u(a,n=h(n,i,r,a,e[o+12],20,-1926607734),i,r,e[o+5],4,-378558),r=u(r,a,n,i,e[o+8],11,-2022574463),i=u(i,r,a,n,e[o+11],16,1839030562),n=u(n,i,r,a,e[o+14],23,-35309556),a=u(a,n,i,r,e[o+1],4,-1530992060),r=u(r,a,n,i,e[o+4],11,1272893353),i=u(i,r,a,n,e[o+7],16,-155497632),n=u(n,i,r,a,e[o+10],23,-1094730640),a=u(a,n,i,r,e[o+13],4,681279174),r=u(r,a,n,i,e[o+0],11,-358537222),i=u(i,r,a,n,e[o+3],16,-722521979),n=u(n,i,r,a,e[o+6],23,76029189),a=u(a,n,i,r,e[o+9],4,-640364487),r=u(r,a,n,i,e[o+12],11,-421815835),i=u(i,r,a,n,e[o+15],16,530742520),a=m(a,n=u(n,i,r,a,e[o+2],23,-995338651),i,r,e[o+0],6,-198630844),r=m(r,a,n,i,e[o+7],10,1126891415),i=m(i,r,a,n,e[o+14],15,-1416354905),n=m(n,i,r,a,e[o+5],21,-57434055),a=m(a,n,i,r,e[o+12],6,1700485571),r=m(r,a,n,i,e[o+3],10,-1894986606),i=m(i,r,a,n,e[o+10],15,-1051523),n=m(n,i,r,a,e[o+1],21,-2054922799),a=m(a,n,i,r,e[o+8],6,1873313359),r=m(r,a,n,i,e[o+15],10,-30611744),i=m(i,r,a,n,e[o+6],15,-1560198380),n=m(n,i,r,a,e[o+13],21,1309151649),a=m(a,n,i,r,e[o+4],6,-145523070),r=m(r,a,n,i,e[o+11],10,-1120210379),i=m(i,r,a,n,e[o+2],15,718787259),n=m(n,i,r,a,e[o+9],21,-343485551),a=f(a,s),n=f(n,l),i=f(i,d),r=f(r,p)}return Array(a,n,i,r)}function l(e,t,a,n,i,r){return f((o=f(f(t,e),f(n,r)))<<(s=i)|o>>>32-s,a);var o,s}function c(e,t,a,n,i,r,o){return l(t&a|~t&n,e,t,i,r,o)}function h(e,t,a,n,i,r,o){return l(t&n|a&~n,e,t,i,r,o)}function u(e,t,a,n,i,r,o){return l(t^a^n,e,t,i,r,o)}function m(e,t,a,n,i,r,o){return l(a^(t|~n),e,t,i,r,o)}function f(e,t){var a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a}Pharmit.hex_md5=e}(),function(i){i.support.cssPseudoClasses=function(){try{var e=i("<input type='checkbox' checked/>").appendTo("body"),t=i('<style type="text/css" />').appendTo("head");t.text("input:checked {width: 200px; display: none}");var a="200px"==e.css("width");return e.remove(),t.remove(),a}catch(e){return!1}}(),i.fn.fileinput=function(t){return t=t||'<button class="fileinput">Browse...</button>',this.each(function(){var e=i(this);e.wrap('<div class="fileinput-wrapper" style=" position: relative; display: inline-block;" />'),e.parent().mousemove(function(e){var t=i(this),a=t.offset().left,n=t.offset().top;t.find("input").css({left:e.pageX-a-t.find("input[type=file]").width()+30,top:e.pageY-n-10})}),e.attr("tabindex","-1").css({filter:"alpha(opacity=0)","-moz-opacity":0,opacity:0,position:"absolute","z-index":-1}),e.before(t),e.prev().addClass("fileinput"),i.support.cssPseudoClasses?(e.prev(".fileinput").click(function(){e.click()}),e.prev(":submit.fileinput").click(function(e){e.preventDefault()})):(e.css({"z-index":"auto",cursor:"pointer"}),e.prev(".fileinput").css("z-index",-1),e.removeAttr("tabindex"),e.prev(".fileinput").attr("tabindex","-1"),e.hover(function(){i(this).prev(".fileinput").addClass("hover")},function(){i(this).prev(".fileinput").removeClass("hover")}).focusin(function(){i(this).prev(".fileinput").addClass("focus")}).focusout(function(){i(this).prev(".fileinput").removeClass("focus")}).mousedown(function(){i(this).prev(".fileinput").addClass("active")}).mouseup(function(){i(this).prev(".fileinput").removeClass("active")}))}),this}}(jQuery);Pharmit=Pharmit||{};function Message(e,t,a){var n=t,i=a,r=e,o=0;function s(e){"ack2"==e.data&&(o=1)}window.addEventListener("message",s),t.postMessage("ack",a),setTimeout(function e(){o?(n.postMessage(r,i),r=i="",n=null,o=0,window.removeEventListener("message",s)):n&&(n.postMessage("ack",i),setTimeout(e,250))},250)}$(document).ready(function(){Pharmit.server="/fcgi-bin/pharmitserv.fcgi",Pharmit.email="dkoes@pitt.edu";var a={};for(var e in window)a[e]=!0;$(document).tooltip(),Pharmit.inFormSubmit=!1,Pharmit.checkGlobals=function(){var e=[];for(var t in window)t in a||e.push(t);0<e.length&&console.log("Leaked global variables: ["+e.join(", ")+"]")};function t(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null===t?null:t[1]}var n=$("#pharmit").addClass("pharmit_main"),i=new Pharmit.Viewer(n),r=new Pharmit.Results(n,i),o=new Pharmit.Query(n,i,r);t("SESSION")&&$.get(decodeURI(t("SESSION")),function(e){o.loadSession(e)}),Pharmit.checkGlobals(),$("button, input[type='button'], input[type='submit']").button().bind("mouseup",function(){$(this).blur()});window.addEventListener("message",function(e){if("ack"==e.data)e.source.postMessage("ack2","*");else if("ack2"!=e.data&&!(e.data.type&&"init"==e.data.type||e.contexts))try{var t=$.parseJSON(e.data);t.points?o.loadSession(t):o.setLigandAndReceptor(t.ligand,t.ligandFormat,t.receptor,t.recname)}catch(e){console.log("Communication error: "+e)}})}),(Pharmit=Pharmit||{}).MinResults=function(n,r){function o(e){if(0===e.status)return{error:e.msg};for(var t=e.data,a=0;a<t.length;a++)t[a][3]=numeral(t[a][3]).format("0.00"),t[a][4]=numeral(t[a][4]).format("0.000"),t[a][2]=n.mangleName(t[a][2]);return t}function s(e,t){return e.cmd="getsminadata",e.qid=d,""!==u.val()&&(e.maxRMSD=u.val()),""!==h.val()&&(e.maxScore=h.val()),m.prop("checked")&&(e.unique=1),e}var l=null,d=null,i=null,p=null,c=null,h=null,u=null,m=null,f=0,v=null,b=null,g=null,y=this.cancel=function(){clearTimeout(v),$.fn.DataTable.isDataTable(c)&&0<d&&(c.DataTable().clear(),$.post(Pharmit.server,{cmd:"cancelsmina",qid:d})),d=null,r.setResult(),i.button("option","disabled",!0),l.hide()};this.minimize=function(e,t,a,n){p=n,d=e,b=t,25e3<(f=a)&&(alert("Results minimization is limited to 25000 compounds.  Your results will be truncated."),f=25e3);var i={cmd:"startsmina",qid:d,receptorid:t.receptorid,recname:t.recname,num:f};$(".pharmit_mincontainer .pharmit_resbody").css({opacity:0}),$.post(Pharmit.server,i,null,"json").done(function(e){var t;e.status?(sminaid=e.sminaid,t=Math.floor((g.height()-100)/29),c.dataTable({searching:!1,pageLength:t,destroy:!0,lengthChange:!1,order:[[3,"asc"]],orderMulti:!1,columnDefs:[{targets:[0],visible:!1},{targets:[1],visible:!1},{targets:[2],className:"pharmit_minname",searchable:!1,sortable:!1},{targets:[3],className:"pharmit_minscore",searchable:!1},{targets:[4],className:"pharmit_minrmsd",searchable:!1}],language:{emptyTable:"Minimizing...",infoEmpty:" ",infoFiltered:"<br>(filtered from _MAX_ total hits)",info:"Minimizing..."},serverSide:!0,processing:!1,ajax:{url:Pharmit.server,data:s,dataSrc:o}}),c.show(),$(".pharmit_mincontainer .pharmit_resbody").css({opacity:100})):(y(),p&&p(),alert("Error: "+e.msg))}).fail(function(){y(),p&&p(),alert("Error contacting minimization server.  Please inform "+Pharmit.email+" if this problem persists.")}),l.show()};var l=$("<div>").appendTo(n.div).addClass("pharmit_rescontainer pharmit_mincontainer"),e=$("<div>").appendTo(l).addClass("pharmit_resheader"),t=$("<div>Minimization Results</div>").appendTo(e).addClass("pharmit_heading").addClass("pharmit_rightheading"),a=$("<div>").addClass("pharmit_resclose").appendTo(t).click(function(){y(),p&&p()}),g=($("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(a),$("<div>").appendTo(l).addClass("pharmit_resbody")),c=$('<table width="100%" class="display compact" cellspacing="0">').addClass("pharmit_mintable").appendTo(g),w=$("<tr>").appendTo($("<thead>").appendTo(c));$("<th>mid</th>").appendTo(w),$("<th>origpos</th>").appendTo(w),$("<th>Name</th>").appendTo(w),$('<th title="Computed using the AutoDock Vina scoring function">Score</th>').appendTo(w),$('<th title="The minimized RMSD, the heavy atom difference between the pharmacophore aligned pose and the minimized pose.  Small values imply a closer agreement to the query pharmacophore.">mRMSD</th>').appendTo(w),$("<tbody>").appendTo(c),c.on("xhr.dt",function(e,t,a){var n=c.DataTable().settings()[0].oLanguage;a.finished?(ga("send","event","query","minimize",b.subset,a.recordsTotal),i.button("option","disabled",!1),i.one("click",function(){ga("send","event","save","minimized",b.subset,a.recordsTotal)}),n.sInfo="Showing _START_ to _END_ of _TOTAL_ entries"):0===a.status?alert(a.msg):(r.setResult(),n.sInfo=numeral(a.recordsTotal).format("0,0")+"/"+numeral(f).format("0,0"),clearTimeout(v),v=setTimeout(function(){$.fn.DataTable.isDataTable(c)&&0<d&&c.DataTable().ajax.reload()},1e3))}),c.on("draw.dt",function(){$(".pharmit_minname span").powerTip({mouseOnToPopup:!0,placement:"s",smartPlacement:!0})}),$("tbody",c).on("click","tr",function(){var i=c.DataTable().row(this).data()[0],t=this;$(".pharmit_iterate_button").remove(),$(this).hasClass("selected")?($(this).removeClass("selected"),r.setResult()):(c.DataTable().$("tr.selected").removeClass("selected"),$(this).addClass("selected"),$.post(Pharmit.server,{cmd:"getsminamol",qid:d,molid:i}).done(function(n){$(t).hasClass("selected")&&r.setResult(n);var e=$('<div class="pharmit_iterate_button" title="Start new pharmit session around selected ligand">').appendTo($("td",t).last());e.button({icons:{primary:"ui-icon-arrowthickstop-1-e"},text:!1}),e.tooltip({show:{delay:500}}),e.click(function(e){e.stopPropagation();var t=window.open("search.html"),a={ligand:n,ligandFormat:i+".sdf",receptor:b.receptor,recname:b.recname};new Message(JSON.stringify(a),t,"*")})}))});var T=$("<div>").appendTo(l).addClass("pharmit_resfooter"),_=$("<div>").appendTo(T).addClass("pharmit_minparams").disableSelection(),C=$("<table>").appendTo(_),x=$("<tr>").appendTo(C).addClass("pharmit_paramrow");$("<td>").appendTo(x).append($("<label>Max Score</label>"));var S=$("<td>").appendTo(x),h=$('<input name="sminamaxscore">').appendTo(S).addClass("pharmit_sminainput").spinner(),m=$('<input type="checkbox" name="sminaunique">');$("<td>").appendTo(x).addClass("pharmit_checkcell").append(m),$("<td>").appendTo(x).append($("<label>Single<br>conformer</label>")),x=$("<tr>").appendTo(C).addClass("pharmit_paramrow"),$("<td>").appendTo(x).append($("<label>Max mRMSD</label>")),S=$("<td>").appendTo(x),u=$('<input name="sminamaxrmsd">').appendTo(S).addClass("pharmit_sminainput").spinner(),S=$("<td colspan=2>").appendTo(x).addClass("pharmit_applycell"),$("<button>Apply</button>").appendTo(S).button().click(function(){c.DataTable().ajax.reload()});var k=$("<div>").appendTo(T).addClass("pharmit_minbottom"),i=$("<button>Save...</button>").appendTo(k).button().click(function(){Pharmit.inFormSubmit=!0;var e=Pharmit.server+"?cmd=savesmina&qid="+d;""!==u.val()&&(e+="&maxRMSD="+u.val()),""!==h.val()&&(e+="&maxScore="+h.val()),m.prop("checked")&&(e+="&unique=1");var t=c.DataTable().order();e+="&order[0][column]="+t[0][0],e+="&order[0][dir]="+t[0][1];var a=$("<form>",{action:e,method:"post"});a.appendTo(document.body),a.submit(),$(a).remove()});l.hide();var P=0,M=0;$(window).resize(function(){var e,t,a;0<d&&(e=g.height())!=P&&(P=e,e-=$("thead",c).height(),e-=$(".dataTables_info",g).height(),e-=$(".dataTables_paginate",g).height(),e-=20,t=$("tr.odd",c).first().height()+1,(a=Math.floor(e/t))!=M&&(c.DataTable().page.len(a),c.DataTable().draw(),M=a))})},(Pharmit=Pharmit||{}).Query=function(){var q="filter",V={name:"Hydrophobic",x:0,y:0,z:0,radius:1,enabled:!0,vector_on:0,minsize:"",maxsize:"",svector:null,hasvec:!1},B={name:"InclusionSphere",x:0,y:0,z:0,radius:1,enabled:!0,vector_on:0,minsize:"",maxsize:"",svector:null,hasvec:!1},U={name:"ExclusionSphere",x:0,y:0,z:0,radius:1,enabled:!0,vector_on:0,minsize:"",maxsize:"",svector:null,hasvec:!1},W=/@<TRIPOS>MOLECULE[^@]*?@<TRIPOS>ATOM\n(\s*\d+\s*(ACC|DON|CAT|ANI|HYD|AR).*)*\n@<TRIPOS>BOND\n/g,X=null,J=null;return function(e,S,t){function g(){var e=J(!0);"search"==q?(ga("send","event","query","shape",e.subset),t.shquery(e,p)):(ga("send","event","query","pharmacophore",e.subset),t.phquery(e,p))}function a(e,t){var a,n;0<e.files.length&&(a=e.files[0],(n=new FileReader).onload=function(e){t(e.target.result,a.name)},n.readAsText(a),$(e).val(""))}function s(e,a,n){var t=a.parent();a.detach();var i=a.children();$.each(i,function(e,t){t.feature.deleteFeature()}),a.empty(),e&&$.each(e,function(e,t){new Feature(S,a,t,n)}),a.accordion("option","active",!1),a.accordion("refresh"),t.prepend(a)}function r(e){if(e){(new Date).getTime();S.disableRendering();for(var t=[],a=[],n=[],i=0,r=e.length;i<r;i++){var o=e[i];"InclusionSphere"==o.name?a.push(o):"ExclusionSphere"==o.name?n.push(o):t.push(o)}s(t,d),s(a,k,Feature.INCLUSIVESHAPE),s(n,P,Feature.EXCLUSIVESHAPE),$("#exselect").change(),S.enableRendering();(new Date).getTime()}}function i(n,i){m=u=null;var e={cmd:"getpharma",ligand:n,ligandname:i};c&&(h?e.reckey=h:e.receptor=p,e.recname=c),$.post(Pharmit.server,e,null,"json").done(function(e){var t,a;e.status?(r(e.points),e.mol?(u=n,a="mol2",-1!==(t=m=i).indexOf(a,t.length-a.length)&&W.test(n)&&(n=n.replace(W,"")),S.setLigand(n,i)):S.setView()):alert("Error: "+e.msg)}).fail(function(e,t){"parsererror"==t?alert("Didn't understand the the server resonse.  If you can reproduce this error, please send your input files to "+Pharmit.email+"."):alert("Error contacting server.  Please inform "+Pharmit.email+" if this problem persists.")})}function o(e,t){var a;e&&t&&(p=e,c=t,S.setReceptor(e,t),h=null,a=Pharmit.hex_md5(p),$.post(Pharmit.server,{cmd:"setreceptor",key:a,receptor:p}).done(function(){h=a}))}var l=$("<div>").addClass("pharmit_query pharmit_overlay"),y=null,d=null,k=null,P=null,p=null,c=null,h=null,u=null,m=null;this.setLigandAndReceptor=function(e,t,a,n){a&&o(a,n),i(e,t)};var f=this.loadSession=function(e){var i=e;"string"==typeof e&&(i=$.parseJSON(e)),r(i.points),o(i.receptor,i.recname),S.setReceptor(p,c),m=i.sdf?(u=decodeURIComponent(i.sdf)).match(/^@<TRIPOS>MOLECULE/)?".mol2":u.match(/^HETATM/)||u.match(/^ATOM/)?".pdb":u.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/)?".sdf":".xyz":(u=i.ligand,i.ligandFormat),S.setLigand(u,m),$.each(i,function(e,t){var a=$("input[name="+e+"]");(a.length||(a=$("select[name="+e+"]")).length||(a=$("button[name="+e+"]")).length)&&a.val(t).change()}),$.each($(".ui-buttonset",l),function(e,t){var a,n=t.id;i[n]&&(a="#"+i[n],$(a).prop("checked",!0).change())}),S.setView(i.view)};function w(e){return $("<div/>").text(e).html()}function M(t){var e=J(!0),a={cmd:"getmesh",type:t.meshstyle.kind,json:JSON.stringify(e)};null!==t.mesh&&t.meshtolerance==t.val()||$.post(Pharmit.server,a,null,"json").done(function(e){e.tolerance!=t.val()&&null!==t.mesh||(t.mesh&&S.removeMesh(t.mesh),t.mesh=S.addMesh(e,t.meshstyle),t.meshtolerance=e.tolerance)})}function v(e,t){var i=t.standard,a=$("<div>").addClass("pharmit_searchdiv"),r=$('<button id="pharmitsearchbutton" name="subset">Search '+i[0].name+"</button>").appendTo(a).button(),o=$("<button>Select subset to search</button>").appendTo(a).button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}});o.tooltip().tooltip("disable"),r.val(i[0].subdir),a.buttonset();var s,l,d=$("<ul>").appendTo($("body")).addClass("pharmit_floatmenu"),p=[],c=0;for(n=i.length;c<n;c++)s=i[c],l=w(s.name),s.html&&(l=s.html),p[c]="<li value="+c+' class="pharmit_subsetmenu">'+l+"<br>",p[c]+='<span class="pharmit_subsetcnts">'+numeral(s.numConfs).format("0,0")+" conformers of "+numeral(s.numMols).format("0,0")+" molecules</span>",p[c]+='<span class="pharmit_subsettime">Updated: '+s.updated+"</span>",p[c]+="</li>","molport"==s.subdir&&(r.button("option","label","Search "+s.name),r.val(s.subdir));d.append(p),d.append($("<li> </li>"));var h,u=$('<li class="pharmit_contributed">Contributed Libraries</li>'),m=$("<ul>").appendTo(u).addClass("pharmit_contributed_menu"),f=[],v=[],b=t.public;for(c=0,n=b.length;c<n;c++){0!==(s=b[c]).numConfs&&(l=w(s.name),h="",v[c]=l+s.updated,s.description&&(h=" title='"+w(s.description)+"' ",v[c]+=" "+w(s.description)),v[c]=v[c].toLowerCase(),f[c]="<li value="+i.length+h+' class="pharmit_subsetmenu">'+l+"<br>",i.push(s),f[c]+='<span class="pharmit_contrib_subsettime">Created: '+s.updated+"</span>",f[c]+='<span class="pharmit_contrib_subsetcnts">'+numeral(s.numConfs).format("0,0")+" conformers of "+numeral(s.numMols).format("0,0")+" molecules</span>",f[c]+="</li>",f[c]=$(f[c]))}m.append(f),publicdialog=$('<div class="pharmit_public_dialog" title="Contributed Libraries"> </div>'),publicsearch=$('<input type="text" id="input" class="pharmit_contrib_search">'),$('<div class="pharmit_search_div"><b>Search: </b></div>').append(publicsearch).appendTo(publicdialog),publicsearch.keyup(function(){var e=publicsearch.val().toLowerCase();for(c in f)-1<v[c].indexOf(e)?f[c].css("display",""):f[c].css("display","none")}),publicdialog.append(m),publicdialog.appendTo(y),publicdialog.dialog({autoOpen:!1,height:525,width:600,modal:!0}),$('<li class="pharmit_private">Contributed Libraries...</li>').appendTo(d).click(function(){publicdialog.dialog("open")}),d.append($("<li> </li>")),$('<li class="pharmit_private">Access Private Library...</li>').appendTo(d).click(function(){X.dialog("open")}),m.menu({position:{my:"left top",at:"right top",collision:"fit"}}).on("menuselect",function(e,t){var a=i[t.item.val()];r.button("option","label","Search "+a.name),r.val(a.subdir),publicdialog.dialog("close")}),d.hide().menu({position:{my:"left top",at:"right top",collision:"fit"}}).on("menuselect",function(e,t){var a=i[t.item.val()];r.button("option","label","Search "+a.name),r.val(a.subdir)}),r.click(g),r.change(function(){for(var e=r.val(),t=0,a=i.length;t<a;t++)if((s=i[t]).subdir==e){r.button("option","label","Search "+s.name);break}t==a&&r.button("option","label","Unknown Subset")}),o.click(function(){var e=d.show().position({my:"left top",at:"left bottom",of:this,collision:"flipfit"});return $(document).one("click",function(){e.hide()}),!1}),e.prepend(a)}J=function(e){var i={points:[]};return $.each(d.children(),function(e,t){i.points.push(t.feature.obj)}),$.each(k.children(),function(e,t){i.points.push(t.feature.obj)}),$.each(P.children(),function(e,t){i.points.push(t.feature.obj)}),$.each($("[name]",l),function(e,t){var a,n=t.name;n&&(a=t.value,$.isNumeric(t.value)&&(a=Number(t.value)),i[n]=a)}),$.each($(".ui-buttonset",l),function(e,t){var a,n=t.id;n&&0<n.length&&(a=$(":checked",t).attr("id"),i[n]=a)}),i.ligand=u,i.ligandFormat=m,h&&e||(i.receptor=p),i.recname=c,i.receptorid=h,i.view=S.getView(),i};var b=$("<div>").appendTo(l).addClass("pharmit_leftclose"),T=$("<span>").addClass("ui-icon ui-icon-carat-1-w").appendTo(b);l.resizable({handles:"e",resize:function(e,t){S.setLeft(t.size.width)}}),l.disableSelection(),b.click(function(){var e,t;b.hasClass("pharmit_leftisclosed")?(b.removeClass("pharmit_leftisclosed"),T.removeClass("ui-icon-carat-1-e"),T.addClass("ui-icon-carat-1-w"),e=l.width(),l.css("width",""),t=l.width(),l.width(e),l.animate({width:t},{progress:function(){S.setLeft(l.width())}}),l.resizable("option","disabled",!1)):(l.animate({width:0},{progress:function(){S.setLeft(l.width())}}),b.addClass("pharmit_leftisclosed"),T.addClass("ui-icon-carat-1-e"),T.removeClass("ui-icon-carat-1-w"),l.resizable("option","disabled",!0))});var _=$("<div>").appendTo(l).addClass("pharmit_queryheader");$.post(Pharmit.server,{cmd:"getsubsets"},null,"json").done(function(e){v(_,e)}).fail(function(){v(_,{standard:[{name:"Error"}],public:[]}),alert("Error contacting server.  Please inform "+Pharmit.email+" if this problem persists.")});var C=$("<div>").appendTo(_).addClass("pharmit_loaderdiv").addClass("pharmit_nowrap"),x=$("<button>Load Receptor...</button>").button(),F=$('<button title="Pharmacophore features can be provided as pharmacophore query formats (MOE, LigBuilder, LigandScout, Pharmer) or automatically extracted from ligand structures (sdf, pdf, mol2, xyz). If a receptor is loaded, only interacting features will be enabled.">Load Features...</button>').button();e.append(l),$('<input type="file">').appendTo(C).fileinput(x).change(function(e){a(this,o)}),$('<input type="file">').appendTo(C).fileinput(F).change(function(e){a(this,i)}),l.detach(),y=$("<div>").appendTo(l).addClass("pharmit_querybody"),$("<div>Pharmacophore</div>").appendTo(y).addClass("pharmit_heading");var R=$("<div>").appendTo(y);(d=$("<div>").appendTo(R)).accordion({header:"> div > h3",animate:!0,active:!1,collapsible:!0,heightStyle:"content",beforeActivate:function(e,t){var a=d.children();$.each(a,function(e,t){t.feature.deselectFeature()}),0<t.newHeader.length&&t.newHeader.parent().get(0).feature.selectFeature()}}).sortable({axis:"y",handle:"h3",stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),$(this).accordion("refresh")}});var A,z,D,H,N=$("<div>").appendTo(R).addClass("pharmit_featurebuttons");$("<button>Add</button>").appendTo(N).button({text:!0,icons:{secondary:"ui-icon-circle-plus"}}).click(function(){new Feature(S,d,V)}),$("<button>Sort</button>").appendTo(N).button({text:!0,icons:{secondary:"ui-icon ui-icon-carat-2-n-s"}}).click(function(){var e=d.children().detach();e.sort(function(e,t){var a=e.feature.obj,n=t.feature.obj;return a.enabled!=n.enabled?n.enabled-a.enabled:a.name!=n.name?a.name.localeCompare(n.name):a.radius-n.radius}),d.append(e)}),function(e){var t=$("<div>").appendTo(e);$("<div>Shape</div>").appendTo(t).addClass("pharmit_heading");var a=$("<div>").appendTo(t).addClass("pharmit_shapeconstraints"),n=($('<h3 id="inshapehead">Inclusive Shape<br></h3>').appendTo(a),$('<div id="pharmit_inclusiveshape">').appendTo(a)),i=null,r=$("<div>").appendTo(n),o=$('<select name="inselect" id="inselect">').addClass("pharmit_shapeselector").appendTo(r);$('<option value="none">None</option>').appendTo(o),$('<option value="ligand">Ligand</option>').appendTo(o),$('<option value="points">Spheres</option>').appendTo(o),o.val("none"),o.selectmenu({width:"14em",appendTo:r,change:function(){o.change()},position:{my:"left top",at:"left bottom",collision:"flip"}});var s=$('<div id="none-indiv">').appendTo(n);$("<div>No inclusive shape will be used to filter pharmacophore matches.</div>").appendTo(s).addClass("pharmit_shapedesc pharmit_shapefiltertext"),$("<div>No inclusive shape will be used for shape screening.</div>").appendTo(s).addClass("pharmit_shapedesc pharmit_shapesearchtext");var l=$('<div id="ligand-indiv">').appendTo(n);$("<div>At least one heavy atom in a pharmacophore aligned pose must fall within the inclusive shape.</div>").appendTo(l).addClass("pharmit_shapedesc pharmit_shapefiltertext"),$("<div>The entirety of the inclusive shape must be contained within the aligned hit.</div>").appendTo(l).addClass("pharmit_shapedesc pharmit_shapesearchtext");var d=$("<table>").appendTo(l),p=$("<tr>").appendTo(d);$("<td>").append('<label title="Depth in Angstroms to reduce surface of ligand inclusive shape by." value = "1" for="intolerance">Tolerance:</label>').appendTo(p),i=$("<td>").appendTo(p).addClass("pharmit_shapecell");var c=$('<input id="intolerance" name="intolerance">').appendTo(i);c.mesh=null,c.meshstyle={kind:"inclusive"},c.change(function(){M(c)}),c.spinner({step:.5,stop:function(){c.change()}}),c.val(1);var h=$('<div id="inshapestyle">').appendTo(l).addClass("pharmit_meshstylediv");$('<input type="radio" id="inshapestyle-hide" name="inshapestyle"><label for="inshapestyle-hide">Hide</label>').appendTo(h).change(function(){$(this).prop("checked")&&(c.meshstyle.hidden=!0,S.updateMesh(c.mesh,c.meshstyle)),h.buttonset("refresh")}),$('<input type="radio" id="inshapestyle-wire" name="inshapestyle"><label for="inshapestyle-wire">Wire</label>').appendTo(h).change(function(){$(this).prop("checked")&&(c.meshstyle.hidden=!1,c.meshstyle.wireframe=!0,S.updateMesh(c.mesh,c.meshstyle)),h.buttonset("refresh")}),$('<input type="radio" id="inshapestyle-solid" name="inshapestyle"><label for="inshapestyle-solid">Solid</label>').appendTo(h).change(function(){$(this).prop("checked")&&(c.meshstyle.hidden=!1,c.meshstyle.wireframe=!1,S.updateMesh(c.mesh,c.meshstyle)),h.buttonset("refresh")}).prop("checked",!0),h.buttonset();var u=$('<div id="points-indiv">').appendTo(n);$("<div>At least one heavy atom center of a pharmacophore aligned pose must fall within <b>each</b> sphere.</div>").appendTo(u).addClass("pharmit_shapedesc pharmit_shapefiltertext"),$("<div>The entirety of the interaction point shapes must be contained within the aligned hit.</div>").appendTo(u).addClass("pharmit_shapedesc pharmit_shapesearchtext"),(k=$("<div>").appendTo(u)).accordion({header:"> div > h3",animate:!0,active:!1,collapsible:!0,heightStyle:"content",beforeActivate:function(e,t){var a=k.children();$.each(a,function(e,t){t.feature.deselectFeature()}),0<t.newHeader.length&&t.newHeader.parent().get(0).feature.selectFeature()}}).sortable({axis:"y",handle:"h3",stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),$(this).accordion("refresh")}});var m=$('<div class="pharmit_pointsbuttons">').appendTo(u);$("<button>Add</button>").appendTo(m).button({text:!0,icons:{secondary:"ui-icon-circle-plus"}}).click(function(){new Feature(S,k,B,Feature.INCLUSIVESHAPE)});o.change(function(){s.hide(),l.hide(),u.hide(),"ligand"==this.value?($.each(k.children(),function(e,t){t.feature.hideFeature()}),l.show(),$("#inshapehead").addClass("pharmit_oblique"),c.change()):("points"==this.value?($.each(k.children(),function(e,t){t.feature.unhideFeature()}),$("#inshapehead").addClass("pharmit_oblique"),u.show()):($.each(k.children(),function(e,t){t.feature.hideFeature()}),$("#inshapehead").removeClass("pharmit_oblique"),s.show()),c.mesh&&S.removeMesh(c.mesh),c.mesh=null),o.selectmenu("refresh")}),o.change();$('<h3 id="exshapehead">Exclusive Shape<br></h3>').appendTo(a);var f=$('<div id="pharmit_exclusiveshape">').appendTo(a),v=$("<div>").appendTo(f),b=$('<select name="exselect" id="exselect">').addClass("pharmit_shapeselector").appendTo(v);$('<option value="none">None</option>').appendTo(b),$('<option value="receptor">Receptor</option>').appendTo(b),$('<option value="points">Spheres</option>').appendTo(b),b.val("none"),b.selectmenu({width:"11em",appendTo:v,change:function(){b.change()},position:{my:"left top",at:"left bottom",collision:"flip"}});var g=$('<div id="none-exdiv">').appendTo(f);$("<div>No exclusive shape constraint will be applied.</div>").appendTo(g).addClass("pharmit_shapedesc");var y=$('<div id="receptor-exdiv">').appendTo(f);$("<div>").appendTo(y).addClass("pharmit_shapedesc pharmit_shapefiltertext").text("Hits that have heavy atom centers within the exclusive shape in their pharmacophore aligned pose will be filtered out."),$("<div>").appendTo(y).addClass("pharmit_shapedesc pharmit_shapesearchtext").text("Aligned hits may not overlap any portion of the exclusive shape.");var w=$("<table>").appendTo(y),T=$("<tr>").appendTo(w);$("<td>").append('<label title="Depth in Angstroms to reduce surface of receptor exclusive shape by." value = "1" for="extolerance">Tolerance:</label>').appendTo(T),i=$("<td>").appendTo(T).addClass("pharmit_shapecell");var _=$('<input id="extolerance" name="extolerance">').appendTo(i).val(1);_.mesh=null,_.meshstyle={kind:"exclusive"},_.change(function(){M(_)}),_.spinner({step:.5,stop:function(){_.change()}});var C=$('<div id="exshapestyle">').appendTo(y).addClass("pharmit_meshstylediv");$('<input type="radio" id="exshapestyle-hide" name="exshapestyle"><label for="exshapestyle-hide">Hide</label>').appendTo(C).change(function(){$(this).prop("checked")&&(_.meshstyle.hidden=!0,S.updateMesh(_.mesh,_.meshstyle)),C.buttonset("refresh")}),$('<input type="radio" id="exshapestyle-wire" name="exshapestyle"><label for="exshapestyle-wire">Wire</label>').appendTo(C).change(function(){$(this).prop("checked")&&(_.meshstyle.hidden=!1,_.meshstyle.wireframe=!0,S.updateMesh(_.mesh,_.meshstyle)),C.buttonset("refresh")}),$('<input type="radio" id="exshapestyle-solid" name="exshapestyle"><label for="exshapestyle-solid">Solid</label>').appendTo(C).change(function(){$(this).prop("checked")&&(_.meshstyle.hidden=!1,_.meshstyle.wireframe=!1,S.updateMesh(_.mesh,_.meshstyle)),C.buttonset("refresh")}).prop("checked",!0),C.buttonset();var x=$('<div id="points-exdiv">').appendTo(f);$("<div>Heavy atom centers of pharmacophore aligned poses may not fall within any exclusion sphere.</div>").appendTo(x).addClass("pharmit_shapedesc pharmit_shapefiltertext"),$("<div>Aligned hits may not overlap any exclusion sphere.</div>").appendTo(x).addClass("pharmit_shapedesc pharmit_shapesearchtext"),(P=$("<div>").appendTo(x)).accordion({header:"> div > h3",animate:!0,active:!1,collapsible:!0,heightStyle:"content",beforeActivate:function(e,t){var a=P.children();$.each(a,function(e,t){t.feature.deselectFeature()}),0<t.newHeader.length&&t.newHeader.parent().get(0).feature.selectFeature()}}).sortable({axis:"y",handle:"h3",stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),$(this).accordion("refresh")}}),m=$('<div class="pharmit_pointsbuttons">').appendTo(x),$("<button>Add</button>").appendTo(m).button({text:!0,icons:{secondary:"ui-icon-circle-plus"}}).click(function(){new Feature(S,P,U,Feature.EXCLUSIVESHAPE)}),b.change(function(){"receptor"==this.value?($.each(P.children(),function(e,t){t.feature.hideFeature()}),g.hide(),x.hide(),y.show(),_.change(),$("#exshapehead").addClass("pharmit_oblique")):("points"==this.value?($.each(P.children(),function(e,t){t.feature.unhideFeature()}),g.hide(),y.hide(),x.show(),$("#exshapehead").addClass("pharmit_oblique")):($.each(P.children(),function(e,t){t.feature.hideFeature()}),$("#exshapehead").removeClass("pharmit_oblique"),g.show(),x.hide(),y.hide()),_.mesh&&S.removeMesh(_.mesh),_.mesh=null),b.selectmenu("refresh")}),b.change(),a.accordion({animate:!0,active:!1,collapsible:!0,heightStyle:"content"})}(y),function(e){var t=$("<div>").appendTo(e);$("<div>Filters</div>").appendTo(t).addClass("pharmit_heading");function a(){""!==$("#reduceorienttext").val()||""!==$("#reduceconfstext").val()||""!==$("#reducehitstext").val()?i.addClass("pharmit_filtermodified"):i.removeClass("pharmit_filtermodified")}var n=$("<div>").appendTo(t),i=$("<h3>Hit Reduction<br></h3>").appendTo(n),r=$("<div>").addClass("pharmit_hitreduction").appendTo(n),o=$("<table>").appendTo(r),s=$("<tr>").addClass("pharmit_filterrow").appendTo(o);$("<td>").append('<label title="Maximum number of orientations returned for each conformation" value="1" for="reduceorienttext">Max Hits per Conf:</label>').appendTo(s);var l=$("<td>").appendTo(s);$('<input id="reduceorienttext" name="max-orient">').appendTo(l).spinner({min:0,stop:a}).change(a),s=$("<tr>").addClass("pharmit_filterrow").appendTo(o),$("<td>").append('<label title="Maximum number of conformations returned for each compound" value="1" for="reduceconfstext">Max Hits per Mol:</label>').appendTo(s),l=$("<td>").appendTo(s),$('<input id="reduceconfstext" name="reduceConfs">').appendTo(l).spinner({min:0,stop:a}).change(a),s=$("<tr>").addClass("pharmit_filterrow").appendTo(o),$("<td>").append('<label title="Maximum number of hits returned" value="1" for="reducehitstext">Max Total Hits:</label>').appendTo(s),l=$("<td>").appendTo(s),$('<input id="reducehitstext" name="max-hits">').appendTo(l).spinner({min:0,stop:a}).change(a);function d(){var a=!0;$("[name]",h).each(function(e,t){""!==t.value&&(a=!1)}),a?c.removeClass("pharmit_filtermodified"):c.addClass("pharmit_filtermodified")}function p(e,t,a,n){var i=$("<tr>").addClass("pharmit_filterrow").appendTo(u),r=$("<td>").appendTo(i);$('<input name="min'+e+'">').appendTo(r).spinner({min:n,stop:d}).change(d),$("<td>").appendTo(i).append($('<label title="'+a+'" value="1" >&le;  '+t+" &le;</label>")),r=$("<td>").appendTo(i),$('<input name="max'+e+'">').appendTo(r).spinner({min:n,stop:d}).change(d)}var c=$("<h3>Hit Screening<br></h3>").appendTo(n),h=$("<div>").appendTo(n).addClass("pharmit_hitscreening"),u=$("<table>").appendTo(h);p("MolWeight","MolWeight","Minimum/maximum molecular weight (weights are approximate)",0),p("rotbonds","RotBonds","Minimum/maximum number of rotatable bonds",0),p("logp","LogP","Minimum/maximum partition coefficient as calculated by OpenBabel"),p("psa","PSA","Minimum/maximum polar surface area as calculated by OpenBabel"),p("aromatics","Aromatics","Minimum/maximum number of smallest aromatic rings",0),p("hba","HBA","Minimum/maximum number of hydrogen bond acceptors",0),p("hbd","HBD","Minimum/maximum number of hydrogen bond donors",0),n.accordion({animate:!0,active:!1,collapsible:!0,heightStyle:"content"})}(y),A=_,z="ShapeModeSelect",D=$("<div>").prependTo(A).addClass("pharmit_shapemodediv"),H=$('<button name="'+z+'" id="'+z+' value="filter">Pharmacophore Search -&gt; Shape Filter</button>').addClass("pharmit_styleselector").appendTo(D),q="filter",H.button(),H.change(function(){"search"==(q=this.value)?(H.button("option","label","Shape Search -&gt; Pharmacophore Filter"),$(".pharmit_shapefiltertext").hide(),$(".pharmit_shapesearchtext").show()):(q="filter",H.button("option","label","Pharmacophore Search -&gt; Shape Filter"),$(".pharmit_shapefiltertext").show(),$(".pharmit_shapesearchtext").hide()),H.button("refresh")}),H.val("filter"),H.change(),H.click(function(){"filter"==this.value?this.value="search":this.value="filter",H.change()});var E=$("<div>").appendTo(y);$("<div>Visualization</div>").appendTo(E).addClass("pharmit_heading");var j=$("<div>").appendTo(E).addClass("pharmit_vizdiv");S.appendViewerControls(j);var L=$("<div>").appendTo(l).addClass("pharmit_queryfooter"),O=$("<div>").appendTo(L).addClass("pharmit_bottomloaders").addClass("pharmit_nowrap");e.append(l);var I=$("<button>Load Session...</button>").button();$('<input type="file">').appendTo(O).fileinput(I).change(function(){a(this,f)}),$("<button>Save Session...</button>").appendTo(O).button().click(function(){Pharmit.inFormSubmit=!0;var e=Pharmit.server+'?cmd=savedata&type="text%2Fphjson"&fname="pharmit.json"',t=$("<form>",{action:e,method:"post"}),a=J(!1);t.append($("<input>",{name:"data",type:"hidden",value:JSON.stringify(a,null,4)})),t.appendTo(document.body),t.submit(),$(t).remove()}),S.setLeft(l.width()),X=$('<div class="pharmit_private_dialog" title="Access Private Library">Enter your access code: </div>').appendTo(y),$('<input type="text" id="privateid" class="pharmit_privatetext">').appendTo(X),X.dialog({autoOpen:!1,height:125,width:400,modal:!0,buttons:{Submit:function(){$.post(Pharmit.server,{cmd:"getsubsets",subset:"Private/"+$("#privateid").val()},null,"json").done(function(e){var t;e.error?alert(e.error):((t=$("#pharmitsearchbutton")).button("option","label","Search "+e.name),t.val(e.subdir))}).fail(function(){alert("Error contacting server.  Please inform "+Pharmit.email+" if this problem persists.")}),X.dialog("close")},Cancel:function(){X.dialog("close")}}})}}(),(Pharmit=Pharmit||{}).Results=function(e,a){var t,n=this.div=$("<div>").addClass("pharmit_results pharmit_overlay").appendTo(e),i=null,r=null;this.phquery=function(e,t){i.cancel(),r.cancel(),r.hide(),i.query(e,t),this.show()},this.shquery=function(e,t){r.cancel(),i.cancel(),i.hide(),r.query(e,t),this.show()},this.show=function(){n.show(),a.setRight(n.width())},this.close=function(){n.hide(),a.setRight(0)},this.mangleName=function(e){for(var t,a,n=e.split(" "),i="",r=0;r<n.length;r++){var o=n[r],s=(a=void 0,a=null,(a=(t=o).match(/PubChem-?(\d+)/))?"https://pubchem.ncbi.nlm.nih.gov/compound/"+a[1]:(a=t.match(/MolPort-?(\S+)/))?"https://www.molport.com/shop/moleculelink/about-this-molecule/"+a[1].replace(/-/g,""):(a=t.match(/^CHEMBL/))?"https://www.ebi.ac.uk/chembldb/index.php/compound/inspect/"+t:(a=t.match(/ChemDiv-?(\S+)/))?"http://chemistryondemand.com:8080/eShop/search_results.jsp?idnumber="+a[1]:(a=t.match(/ZINC(\d+)/))?"http://zinc15.docking.org/substances/"+a[1]:(a=t.match(/CSC(\d+)/))?"https://chem-space.com/"+t:(a=t.match(/^MCULE-/))?"https://mcule.com/"+t:(a=t.match(/(\S+-N)$/))?"https://ultimateapp.mcule.com/search/?t=exact&q="+t:null);i+=s?"<a target='_blank' href='"+s+"'>"+o+"</a><br>":o+"<br>"}return'<span data-powertip="'+i+'">'+n[0]+"</span>"};var o=$("<div>").appendTo(n).addClass("pharmit_rightclose"),s=$("<span>").addClass("ui-icon ui-icon-carat-1-e").appendTo(o);n.resizable({handles:"w",resize:function(e,t){a.setRight(t.size.width),$(this).css("left","")}}),n.disableSelection(),o.click(function(){var e,t;o.hasClass("pharmit_rightisclosed")?(o.removeClass("pharmit_rightisclosed"),s.removeClass("ui-icon-carat-1-w"),s.addClass("ui-icon-carat-1-e"),e=n.width(),n.css("width",""),t=n.width(),n.width(e),n.animate({width:t},{progress:function(){a.setRight(n.width())}}),n.resizable("option","disabled",!1)):(n.animate({width:0},{progress:function(){a.setRight(n.width())}}),o.addClass("pharmit_rightisclosed"),s.addClass("ui-icon-carat-1-w"),s.removeClass("ui-icon-carat-1-e"),n.resizable("option","disabled",!0))}),t=new Pharmit.MinResults(this,a),(i=new Pharmit.SearchResults(this,a,t)).hide(),(r=new Pharmit.SearchResults(this,a,t,"shape")).hide(),n.hide(),n.is(":visible")&&a.setRight(n.width()),$(window).on("beforeunload",function(){Pharmit.inFormSubmit?Pharmit.inFormSubmit=!1:i.cancel()})},(Pharmit=Pharmit||{}).SearchResults=function(e,r,a,n){function i(e){if(0===e.status)return{error:e.msg};for(var t=e.data,a=0;a<t.length;a++)t[a][1]=numeral(t[a][1]).format("0.000"),t[a][0]=m.mangleName(t[a][0]);return t}var o=null,s=null,l=null,d=null,p=null,c=null,h=null,u=null,m=e,f=null,v=null,b=new Date,g=0,y=0;$.fn.DataTable.ext.pager.numbers_length=5,this.query=function(e,t){l=$.extend({},e),f=t;var a={cmd:"startquery",json:JSON.stringify(l)};null!==s&&(a.oldqid=s),b=new Date,$.post(Pharmit.server,a,null,"json").done(function(e){var t;e.status?(s=e.qid,t=Math.floor((p.height()-120)/28),d.dataTable({searching:!1,pageLength:t,destroy:!0,lengthChange:!1,order:"shape"==n?[[1,"desc"]]:[[1,"asc"]],orderMulti:!1,columnDefs:[{targets:[0],className:"pharmit_namecol",searchable:!1,sortable:!1},{targets:[1],className:"pharmit_rmsdcol",searchable:!1},{targets:[2],className:"pharmit_masscol",searchable:!1},{targets:[3],className:"pharmit_bondscol",searchable:!1},{targets:[4],visible:!1}],language:{emptyTable:"<span class='pharmit_pulse'>Searching "+numeral(e.numMols).format("0,0")+" molecules and "+numeral(e.numConfs).format("0,0")+" conformers...</span>",infoFiltered:"",infoEmpty:"",info:"<span class='pharmit_pulse'>Searching...</span>"},serverSide:!0,processing:!1,ajax:{url:Pharmit.server,data:{cmd:"getdata",qid:s},dataSrc:i}})):(v(),m.close(),alert("Error: "+e.msg))}).fail(function(){v(),m.close(),alert("Error contacting server.  Please inform "+Pharmit.email+" if this problem persists.")}),o.show()},this.hide=function(){o.hide()},this.show=function(){o.show(),d.DataTable().ajax.reload()},v=this.cancel=function(){a.cancel(),clearTimeout(u),null!==s&&$.post(Pharmit.server,{cmd:"cancelquery",oldqid:s}),$.fn.DataTable.isDataTable(d)&&d.DataTable().clear(),s=null,c.button("option","disabled",!0),h.button("option","disabled",!0)};var o=$("<div>").appendTo(m.div).addClass("pharmit_rescontainer"),t=$("<div>").appendTo(o).addClass("pharmit_resheader"),w="Pharmacophore Results";"shape"==n&&(w="Aligned Shape Results");var T=$("<div>"+w+"</div>").appendTo(t).addClass("pharmit_heading").addClass("pharmit_rightheading"),_=$("<div>").addClass("pharmit_resclose").appendTo(T).click(function(){v(),m.close()}),p=($("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(_),$("<div>").appendTo(o).addClass("pharmit_resbody")),d=$('<table width="100%" class="display compact" cellspacing="0">').addClass("pharmit_phtable").appendTo(p),C=$("<tr>").appendTo($("<thead>").appendTo(d));$("<th>Name</th>").appendTo(C),"shape"==n?$("<th>Sim</th>").appendTo(C):$("<th>RMSD</th>").appendTo(C),$("<th>Mass</th>").appendTo(C),$("<th>RBnds</th>").appendTo(C),$("<th>mid</th>").appendTo(C),$("<tbody>").appendTo(d),d.on("xhr.dt",function(e,t,a){var n,i;a.finished?(n=d.DataTable().settings()[0].oLanguage,i=(new Date-b)/1e3,0===a.recordsTotal?n.emptyTable=n.sEmptyTable="No results found":(n.sInfo="<span title='Query took "+i+" seconds'>Showing _START_ to _END_ of _TOTAL_ hits",a.benchmark&&(n.sInfo+=". EF: "+numeral(a.benchmark.EF).format("0.0"),n.sInfo+=", F1: "+numeral(a.benchmark.F1).format("0.00")),n.sInfo+="</span>",c.button("option","disabled",!1),h.button("option","disabled",!1),h.one("click",function(){ga("send","event","save","pharmacophore",l.subset,a.recordsTotal)}))):0===a.status||(r.setResult(),clearTimeout(u),u=setTimeout(function(){0<s&&d.DataTable().ajax.reload()},1e3))}),d.on("draw.dt",function(){$(".pharmit_namecol span").powerTip({mouseOnToPopup:!0,placement:"s",smartPlacement:!0})}),$("tbody",d).on("click","tr",function(){var t=this,i=d.DataTable().row(t).data()[4];$(".pharmit_iterate_button").remove(),$(t).hasClass("selected")?($(t).removeClass("selected"),r.setResult()):(d.DataTable().$("tr.selected").removeClass("selected"),$(t).addClass("selected"),$.post(Pharmit.server,{cmd:"getmol",qid:s,loc:i}).done(function(n){var e;$(t).hasClass("selected")&&(r.setResult(n),(e=$('<div class="pharmit_iterate_button" title="Start new pharmit session around selected ligand">').appendTo($("td",t).last())).button({icons:{primary:"ui-icon-arrowthickstop-1-e"},text:!1}),e.tooltip({show:{delay:500}}),e.click(function(e){e.stopPropagation();var t=window.open("search.html"),a={ligand:n,ligandFormat:i+".sdf",receptor:f,recname:l.recname};new Message(JSON.stringify(a),t,"*")}))}))});var x=$("<div>").appendTo(o).addClass("pharmit_resfooter"),S=$("<div>").appendTo(x).addClass("pharmit_bottomloaders").addClass("pharmit_nowrap"),c=$("<button>Minimize</button>").appendTo(S).button({disabled:!0}).click(function(){o.hide();var e=d.DataTable().ajax.json().recordsTotal,t=$.extend({},l);t.receptor=f,a.minimize(s,t,e,function(){o.show(),d.DataTable().ajax.reload()})}),h=$("<button>Save...</button>").appendTo(S).button({disabled:!0}).click(function(){var e=Pharmit.server+"?cmd=saveres&qid="+s,t=$("<form>",{action:e,method:"post"});t.appendTo(document.body),Pharmit.inFormSubmit=!0,t.submit(),$(t).remove()});$(window).resize(function(){var e,t,a;0<s&&(e=p.height())!=g&&(g=e,e-=$("thead",d).height(),e-=$(".dataTables_info",p).height(),e-=$(".dataTables_paginate",p).height(),e-=24,t=$("tr.odd",d).first().height()+1,(a=Math.floor(e/t))!=y&&(d.DataTable().page.len(a),d.DataTable().draw(),y=a))})},function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&"object"==typeof module?module.exports=e:e(jQuery)}(function(He,Ne){"use strict";var e,t,Ee={beforeShow:n,move:n,change:n,show:n,hide:n,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},je=[],Le=!!/msie/i.exec(window.navigator.userAgent),Oe=((t=document.createElement("div").style).cssText="background-color:rgba(0,0,0,.5)",a(t.backgroundColor,"rgba")||a(t.backgroundColor,"hsla")),Ie="color"===(e=He("<input type='color' value='!' />")[0]).type&&"!"!==e.value,qe=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),Ve=function(){var e="";if(Le)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();function a(e,t){return!!~(""+e).indexOf(t)}function Be(e,t,a,n){for(var i=[],r=0;r<e.length;r++){var o,s,l,d,p=e[r];p?(s=(o=tinycolor(p)).toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light",s+=tinycolor.equals(t,p)?" sp-thumb-active":"",l=o.toString(n.preferredFormat||"rgb"),d=Oe?"background-color:"+o.toRgbString():"filter:"+o.toFilter(),i.push('<span title="'+l+'" data-color="'+o.toRgbString()+'" class="'+s+'"><span class="sp-thumb-inner" style="'+d+';" /></span>')):i.push(He("<div />").append(He('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",n.noColorSelectedText)).html())}return"<div class='sp-cf "+a+"'>"+i.join("")+"</div>"}function r(e,t){var a,n,i,r,o,s,l,p=(o=t,s=e,(l=He.extend({},Ee,o)).callbacks={move:We(l.move,s),change:We(l.change,s),show:We(l.show,s),hide:We(l.hide,s),beforeShow:We(l.beforeShow,s)},l),c=p.flat,d=p.showSelectionPalette,h=p.localStorageKey,u=p.theme,m=p.callbacks,f=(a=Ae,function(){var e=this,t=arguments;i&&clearTimeout(r),!i&&r||(r=setTimeout(function(){r=null,a.apply(e,t)},n))}),v=!(n=10),b=0,g=0,y=0,$=0,w=0,T=0,_=0,C=0,x=0,S=0,k=1,P=[],M=[],F={},R=p.selectionPalette.slice(0),A=p.maxSelectionSize,z="sp-dragging",D=null,H=e.ownerDocument,N=(H.body,He(e)),E=!1,j=He(Ve,H).addClass(u),L=j.find(".sp-picker-container"),O=j.find(".sp-color"),I=j.find(".sp-dragger"),q=j.find(".sp-hue"),V=j.find(".sp-slider"),B=j.find(".sp-alpha-inner"),U=j.find(".sp-alpha"),W=j.find(".sp-alpha-handle"),X=j.find(".sp-input"),J=j.find(".sp-palette"),G=j.find(".sp-initial"),Q=j.find(".sp-cancel"),Y=j.find(".sp-clear"),K=j.find(".sp-choose"),Z=j.find(".sp-palette-toggle"),ee=N.is("input"),te=ee&&Ie&&"color"===N.attr("type"),ae=ee&&!c,ne=ae?He(qe).addClass(u).addClass(p.className).addClass(p.replacerClassName):He([]),ie=ae?ne:N,re=ne.find(".sp-preview-inner"),oe=p.color||ee&&N.val(),se=!1,le=p.preferredFormat,de=le,pe=!p.showButtons||p.clickoutFiresChange,ce=!oe,he=p.allowEmpty&&!te;function ue(){if(p.showPaletteOnly&&(p.showPalette=!0),Z.text(p.showPaletteOnly?p.togglePaletteMoreText:p.togglePaletteLessText),p.palette){P=p.palette.slice(0),M=He.isArray(P[0])?P:[P],F={};for(var e=0;e<M.length;e++)for(var t=0;t<M[e].length;t++){var a=tinycolor(M[e][t]).toRgbString();F[a]=!0}}j.toggleClass("sp-flat",c),j.toggleClass("sp-input-disabled",!p.showInput),j.toggleClass("sp-alpha-enabled",p.showAlpha),j.toggleClass("sp-clear-enabled",he),j.toggleClass("sp-buttons-disabled",!p.showButtons),j.toggleClass("sp-palette-buttons-disabled",!p.togglePaletteOnly),j.toggleClass("sp-palette-disabled",!p.showPalette),j.toggleClass("sp-palette-only",p.showPaletteOnly),j.toggleClass("sp-initial-disabled",!p.showInitial),j.addClass(p.className).addClass(p.containerClassName),Ae()}function me(){if(h&&window.localStorage){try{var e=window.localStorage[h].split(",#");1<e.length&&(delete window.localStorage[h],He.each(e,function(e,t){fe(t)}))}catch(e){}try{R=window.localStorage[h].split(";")}catch(e){}}}function fe(e){if(d){var t=tinycolor(e).toRgbString();if(!F[t]&&-1===He.inArray(t,R))for(R.push(t);R.length>A;)R.shift();if(h&&window.localStorage)try{window.localStorage[h]=R.join(";")}catch(e){}}}function ve(){var a=ke(),e=He.map(M,function(e,t){return Be(e,a,"sp-palette-row sp-palette-row-"+t,p)});me(),R&&e.push(Be(function(){var e=[];if(p.showPalette)for(var t=0;t<R.length;t++){var a=tinycolor(R[t]).toRgbString();F[a]||e.push(R[t])}return e.reverse().slice(0,p.maxSelectionSize)}(),a,"sp-palette-row sp-palette-row-selection",p)),J.html(e.join(""))}function be(){var e,t;p.showInitial&&(e=se,t=ke(),G.html(Be([e,t],t,"sp-palette-row-initial",p)))}function ge(){(g<=0||b<=0||$<=0)&&Ae(),j.addClass(z),D=null,N.trigger("dragstart.spectrum",[ke()])}function ye(){j.removeClass(z),N.trigger("dragstop.spectrum",[ke()])}function $e(){var e,t=X.val();null!==t&&""!==t||!he?(e=tinycolor(t)).isValid()?(Se(e),Re(!0)):X.addClass("sp-validation-error"):(Se(null),Re(!0))}function we(){(v?Ce:Te)()}function Te(){var e=He.Event("beforeShow.spectrum");v?Ae():(N.trigger(e,[ke()]),!1===m.beforeShow(ke())||e.isDefaultPrevented()||(function(){for(var e=0;e<je.length;e++)je[e]&&je[e].hide()}(),v=!0,He(H).bind("click.spectrum",_e),He(window).bind("resize.spectrum",f),ne.addClass("sp-active"),j.removeClass("sp-hidden"),Ae(),Me(),se=ke(),be(),m.show(se),N.trigger("show.spectrum",[se])))}function _e(e){2!=e.button&&(pe?Re(!0):xe(),Ce())}function Ce(){v&&!c&&(v=!1,He(H).unbind("click.spectrum",_e),He(window).unbind("resize.spectrum",f),ne.removeClass("sp-active"),j.addClass("sp-hidden"),m.hide(ke()),N.trigger("hide.spectrum",[ke()]))}function xe(){Se(se,!0)}function Se(e,t){var a,n;tinycolor.equals(e,ke())?Me():(!e&&he?ce=!0:(ce=!1,n=(a=tinycolor(e)).toHsv(),C=n.h%360/360,x=n.s,S=n.v,k=n.a),Me(),a&&a.isValid()&&!t&&(de=le||a.getFormat()))}function ke(e){return e=e||{},he&&ce?null:tinycolor.fromRatio({h:C,s:x,v:S,a:Math.round(100*k)/100},{format:e.format||de})}function Pe(){Me(),m.move(ke()),N.trigger("move.spectrum",[ke()])}function Me(){X.removeClass("sp-validation-error"),Fe();var e=tinycolor.fromRatio({h:C,s:1,v:1});O.css("background-color",e.toHexString());var t=de;k<1&&(0!==k||"name"!==t)&&("hex"!==t&&"hex3"!==t&&"hex6"!==t&&"name"!==t||(t="rgb"));var a,n,i,r,o,s=ke({format:t}),l="";re.removeClass("sp-clear-display"),re.css("background-color","transparent"),!s&&he?re.addClass("sp-clear-display"):(a=s.toHexString(),n=s.toRgbString(),Oe||1===s.alpha?re.css("background-color",n):(re.css("background-color","transparent"),re.css("filter",s.toFilter())),p.showAlpha&&((i=s.toRgb()).a=0,o="linear-gradient(left, "+(r=tinycolor(i).toRgbString())+", "+a+")",Le?B.css("filter",tinycolor(r).toFilter({gradientType:1},a)):(B.css("background","-webkit-"+o),B.css("background","-moz-"+o),B.css("background","-ms-"+o),B.css("background","linear-gradient(to right, "+r+", "+a+")"))),l=s.toString(t)),p.showInput&&X.val(l),p.showPalette&&ve(),be()}function Fe(){var e,t,a,n,i=x,r=S;he&&ce?(W.hide(),V.hide(),I.hide()):(W.show(),V.show(),I.show(),e=i*b,t=g-r*g,e=Math.max(-y,Math.min(b-y,e-y)),t=Math.max(-y,Math.min(g-y,t-y)),I.css({top:t+"px",left:e+"px"}),a=k*w,W.css({left:a-T/2+"px"}),n=C*$,V.css({top:n-_+"px"}))}function Re(e){var t=ke(),a="";t&&(a=t.toString(de),fe(t)),ee&&N.val(a),e&&(m.change(t),N.trigger("change",[t]))}function Ae(){var e,t,a,n,i,r,o,s,l,d;b=O.width(),g=O.height(),y=I.height(),q.width(),$=q.height(),_=V.height(),w=U.width(),T=W.width(),c||(j.css("position","absolute"),p.offset?j.offset(p.offset):j.offset((t=ie,a=(e=j).outerWidth(),n=e.outerHeight(),i=t.outerHeight(),r=e[0].ownerDocument,o=r.documentElement,s=o.clientWidth+He(r).scrollLeft(),l=o.clientHeight+He(r).scrollTop(),(d=t.offset()).top+=i,d.left-=Math.min(d.left,d.left+a>s&&a<s?Math.abs(d.left+a-s):0),d.top-=Math.min(d.top,d.top+n>l&&n<l?Math.abs(+(n+i)):0),d))),Fe(),p.showPalette&&ve(),N.trigger("reflow.spectrum")}function ze(){Ce(),E=!0,N.attr("disabled",!0),ie.addClass("sp-disabled")}!function(){var e;function t(e){return e.data&&e.data.ignore?(Se(He(e.target).closest(".sp-thumb-el").data("color")),Pe()):(Se(He(e.target).closest(".sp-thumb-el").data("color")),Pe(),Re(!0),p.hideAfterPaletteSelect&&Ce()),!1}Le&&j.find("*:not(input)").attr("unselectable","on"),ue(),ae&&N.after(ne).hide(),he||Y.hide(),c?N.after(j).hide():(1!==(e="parent"===p.appendTo?N.parent():He(p.appendTo)).length&&(e=He("body")),e.append(j)),me(),ie.bind("click.spectrum touchstart.spectrum",function(e){E||we(),e.stopPropagation(),He(e.target).is("input")||e.preventDefault()}),!N.is(":disabled")&&!0!==p.disabled||ze(),j.click(Ue),X.change($e),X.bind("paste",function(){setTimeout($e,1)}),X.keydown(function(e){13==e.keyCode&&$e()}),Q.text(p.cancelText),Q.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),xe(),Ce()}),Y.attr("title",p.clearText),Y.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),ce=!0,Pe(),c&&Re(!0)}),K.text(p.chooseText),K.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),X.hasClass("sp-validation-error")||(Re(!0),Ce())}),Z.text(p.showPaletteOnly?p.togglePaletteMoreText:p.togglePaletteLessText),Z.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),p.showPaletteOnly=!p.showPaletteOnly,p.showPaletteOnly||c||j.css("left","-="+(L.outerWidth(!0)+5)),ue()}),Xe(U,function(e,t,a){k=e/w,ce=!1,a.shiftKey&&(k=Math.round(10*k)/10),Pe()},ge,ye),Xe(q,function(e,t){C=parseFloat(t/$),ce=!1,p.showAlpha||(k=1),Pe()},ge,ye),Xe(O,function(e,t,a){var n,i,r;a.shiftKey?D||(n=x*b,i=g-S*g,r=Math.abs(e-n)>Math.abs(t-i),D=r?"x":"y"):D=null;var o=!D||"y"===D;D&&"x"!==D||(x=parseFloat(e/b)),o&&(S=parseFloat((g-t)/g)),ce=!1,p.showAlpha||(k=1),Pe()},ge,ye),oe?(Se(oe),Me(),de=le||tinycolor(oe).format,fe(oe)):Me(),c&&Te();var a=Le?"mousedown.spectrum":"click.spectrum touchstart.spectrum";J.delegate(".sp-thumb-el",a,t),G.delegate(".sp-thumb-el:nth-child(1)",a,{ignore:!0},t)}();var De={show:Te,hide:Ce,toggle:we,reflow:Ae,option:function(e,t){return e===Ne?He.extend({},p):t===Ne?p[e]:(p[e]=t,void ue())},enable:function(){E=!1,N.attr("disabled",!1),ie.removeClass("sp-disabled")},disable:ze,offset:function(e){p.offset=e,Ae()},set:function(e){Se(e),Re()},get:ke,destroy:function(e){N.show(),ie.unbind("click.spectrum touchstart.spectrum"),j.remove(),ne.remove(),je[e]=null},container:j};return De.id=je.push(De)-1,De}function n(){}function Ue(e){e.stopPropagation()}function We(e,t){var a=Array.prototype.slice,n=a.call(arguments,2);return function(){return e.apply(t,n.concat(a.call(arguments)))}}function Xe(o,s,t,e){s=s||function(){},t=t||function(){},e=e||function(){};var l=document,d=!1,p={},c=0,h=0,u="ontouchstart"in window,a={};function m(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function n(e){if(d){if(Le&&l.documentMode<9&&!e.button)return f();var t=e.originalEvent&&e.originalEvent.touches,a=t?t[0].pageX:e.pageX,n=t?t[0].pageY:e.pageY,i=Math.max(0,Math.min(a-p.left,h)),r=Math.max(0,Math.min(n-p.top,c));u&&m(e),s.apply(o,[i,r,e])}}function f(){d&&(He(l).unbind(a),He(l.body).removeClass("sp-dragging"),e.apply(o,arguments)),d=!1}a.selectstart=m,a.ragstart=m,a["touchmove mousemove"]=n,a["touchend mouseup"]=f,He(o).bind("touchstart mousedown",function(e){(e.which?3==e.which:2==e.button)||d||!1!==t.apply(o,arguments)&&(d=!0,c=He(o).height(),h=He(o).width(),p=He(o).offset(),He(l).bind(a),He(l.body).addClass("sp-dragging"),u||n(e),m(e))})}var o="spectrum.id";He.fn.spectrum=function(a,e){if("string"!=typeof a)return this.spectrum("destroy").each(function(){var e=r(this,He.extend({},a,He(this).data()));He(this).data(o,e.id)});var n=this,i=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=je[He(this).data(o)];if(e){var t=e[a];if(!t)throw new Error("Spectrum: no such method: '"+a+"'");"get"==a?n=e.get():"container"==a?n=e.container:"option"==a?n=e.option.apply(e,i):"destroy"==a?(e.destroy(e.id),He(this).removeData(o)):t.apply(e,i)}}),n},He.fn.spectrum.load=!0,He.fn.spectrum.loadOpts={},He.fn.spectrum.draggable=Xe,He.fn.spectrum.defaults=Ee,He.spectrum={},He.spectrum.localization={},He.spectrum.palettes={},He.fn.spectrum.processNativeColorInputs=function(){Ie||He("input[type=color]").spectrum({preferredFormat:"hex6"})},function(){function c(e,t){if(t=t||{},(e=e||"")instanceof c)return e;if(!(this instanceof c))return new c(e,t);var a=function(e){var t={r:0,g:0,b:0},a=1,n=!1,i=!1;"string"==typeof e&&(e=function(e){e=e.replace(r,"").replace(o,"").toLowerCase();var t,a=!1;if(k[e])e=k[e],a=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};if(t=E.rgb.exec(e))return{r:t[1],g:t[2],b:t[3]};if(t=E.rgba.exec(e))return{r:t[1],g:t[2],b:t[3],a:t[4]};if(t=E.hsl.exec(e))return{h:t[1],s:t[2],l:t[3]};if(t=E.hsla.exec(e))return{h:t[1],s:t[2],l:t[3],a:t[4]};if(t=E.hsv.exec(e))return{h:t[1],s:t[2],v:t[3]};if(t=E.hsva.exec(e))return{h:t[1],s:t[2],v:t[3],a:t[4]};if(t=E.hex8.exec(e))return{a:function(e){return R(e)/255}(t[1]),r:R(t[2]),g:R(t[3]),b:R(t[4]),format:a?"name":"hex8"};if(t=E.hex6.exec(e))return{r:R(t[1]),g:R(t[2]),b:R(t[3]),format:a?"name":"hex"};if(t=E.hex3.exec(e))return{r:R(t[1]+""+t[1]),g:R(t[2]+""+t[2]),b:R(t[3]+""+t[3]),format:a?"name":"hex"};return!1}(e));"object"==typeof e&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(t=function(e,t,a){return{r:255*M(e,255),g:255*M(t,255),b:255*M(a,255)}}(e.r,e.g,e.b),n=!0,i="%"===String(e.r).substr(-1)?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=z(e.s),e.v=z(e.v),t=function(e,t,a){e=6*M(e,360),t=M(t,100),a=M(a,100);var n=d.floor(e),i=e-n,r=a*(1-t),o=a*(1-i*t),s=a*(1-(1-i)*t),l=n%6;return{r:255*[a,o,r,r,s,a][l],g:255*[s,a,a,o,r,r][l],b:255*[r,r,s,a,a,o][l]}}(e.h,e.s,e.v),n=!0,i="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=z(e.s),e.l=z(e.l),t=function(e,t,a){var n,i,r;function o(e,t,a){return a<0&&(a+=1),1<a&&--a,a<1/6?e+6*(t-e)*a:a<.5?t:a<2/3?e+(t-e)*(2/3-a)*6:e}{var s,l;e=M(e,360),t=M(t,100),a=M(a,100),0===t?n=i=r=a:(n=o(l=2*a-(s=a<.5?a*(1+t):a+t-a*t),s,e+1/3),i=o(l,s,e),r=o(l,s,e-1/3))}return{r:255*n,g:255*i,b:255*r}}(e.h,e.s,e.l),n=!0,i="hsl"),e.hasOwnProperty("a")&&(a=e.a));return a=P(a),{ok:n,format:e.format||i,r:p(255,h(t.r,0)),g:p(255,h(t.g,0)),b:p(255,h(t.b,0)),a:a}}(e);this._originalInput=e,this._r=a.r,this._g=a.g,this._b=a.b,this._a=a.a,this._roundA=s(100*this._a)/100,this._format=t.format||a.format,this._gradientType=t.gradientType,this._r<1&&(this._r=s(this._r)),this._g<1&&(this._g=s(this._g)),this._b<1&&(this._b=s(this._b)),this._ok=a.ok,this._tc_id=n++}var e=null,r=/^[\s,#]+/,o=/\s+$/,n=0,d=Math,s=d.round,p=d.min,h=d.max,t=d.random;function i(e,t,a){e=M(e,255),t=M(t,255),a=M(a,255);var n,i=h(e,t,a),r=p(e,t,a),o=(i+r)/2;if(i==r)n=l=0;else{var s=i-r,l=.5<o?s/(2-i-r):s/(i+r);switch(i){case e:n=(t-a)/s+(t<a?6:0);break;case t:n=(a-e)/s+2;break;case a:n=(e-t)/s+4}n/=6}return{h:n,s:l,l:o}}function l(e,t,a){e=M(e,255),t=M(t,255),a=M(a,255);var n,i=h(e,t,a),r=p(e,t,a),o=i,s=i-r,l=0===i?0:s/i;if(i==r)n=0;else{switch(i){case e:n=(t-a)/s+(t<a?6:0);break;case t:n=(a-e)/s+2;break;case a:n=(e-t)/s+4}n/=6}return{h:n,s:l,v:o}}function a(e,t,a,n){var i=[A(s(e).toString(16)),A(s(t).toString(16)),A(s(a).toString(16))];return n&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function u(e,t,a,n){var i;return[A((i=n,Math.round(255*parseFloat(i)).toString(16))),A(s(e).toString(16)),A(s(t).toString(16)),A(s(a).toString(16))].join("")}function m(e,t){t=0===t?0:t||10;var a=c(e).toHsl();return a.s-=t/100,a.s=F(a.s),c(a)}function f(e,t){t=0===t?0:t||10;var a=c(e).toHsl();return a.s+=t/100,a.s=F(a.s),c(a)}function v(e){return c(e).desaturate(100)}function b(e,t){t=0===t?0:t||10;var a=c(e).toHsl();return a.l+=t/100,a.l=F(a.l),c(a)}function g(e,t){t=0===t?0:t||10;var a=c(e).toRgb();return a.r=h(0,p(255,a.r-s(-t/100*255))),a.g=h(0,p(255,a.g-s(-t/100*255))),a.b=h(0,p(255,a.b-s(-t/100*255))),c(a)}function y(e,t){t=0===t?0:t||10;var a=c(e).toHsl();return a.l-=t/100,a.l=F(a.l),c(a)}function $(e,t){var a=c(e).toHsl(),n=(s(a.h)+t)%360;return a.h=n<0?360+n:n,c(a)}function w(e){var t=c(e).toHsl();return t.h=(t.h+180)%360,c(t)}function T(e){var t=c(e).toHsl(),a=t.h;return[c(e),c({h:(a+120)%360,s:t.s,l:t.l}),c({h:(a+240)%360,s:t.s,l:t.l})]}function _(e){var t=c(e).toHsl(),a=t.h;return[c(e),c({h:(a+90)%360,s:t.s,l:t.l}),c({h:(a+180)%360,s:t.s,l:t.l}),c({h:(a+270)%360,s:t.s,l:t.l})]}function C(e){var t=c(e).toHsl(),a=t.h;return[c(e),c({h:(a+72)%360,s:t.s,l:t.l}),c({h:(a+216)%360,s:t.s,l:t.l})]}function x(e,t,a){t=t||6,a=a||30;var n=c(e).toHsl(),i=360/a,r=[c(e)];for(n.h=(n.h-(i*t>>1)+720)%360;--t;)n.h=(n.h+i)%360,r.push(c(n));return r}function S(e,t){t=t||6;for(var a=c(e).toHsv(),n=a.h,i=a.s,r=a.v,o=[],s=1/t;t--;)o.push(c({h:n,s:i,v:r})),r=(r+s)%1;return o}c.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},setAlpha:function(e){return this._a=P(e),this._roundA=s(100*this._a)/100,this},toHsv:function(){var e=l(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=l(this._r,this._g,this._b),t=s(360*e.h),a=s(100*e.s),n=s(100*e.v);return 1==this._a?"hsv("+t+", "+a+"%, "+n+"%)":"hsva("+t+", "+a+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var e=i(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=i(this._r,this._g,this._b),t=s(360*e.h),a=s(100*e.s),n=s(100*e.l);return 1==this._a?"hsl("+t+", "+a+"%, "+n+"%)":"hsla("+t+", "+a+"%, "+n+"%, "+this._roundA+")"},toHex:function(e){return a(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return u(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:s(this._r),g:s(this._g),b:s(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+s(this._r)+", "+s(this._g)+", "+s(this._b)+")":"rgba("+s(this._r)+", "+s(this._g)+", "+s(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:s(100*M(this._r,255))+"%",g:s(100*M(this._g,255))+"%",b:s(100*M(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+s(100*M(this._r,255))+"%, "+s(100*M(this._g,255))+"%, "+s(100*M(this._b,255))+"%)":"rgba("+s(100*M(this._r,255))+"%, "+s(100*M(this._g,255))+"%, "+s(100*M(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&e[a(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+u(this._r,this._g,this._b,this._a),a=t,n=this._gradientType?"GradientType = 1, ":"";return e&&(a=c(e).toHex8String()),"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+t+",endColorstr="+a+")"},toString:function(e){var t=!!e;e=e||this._format;var a=!1,n=this._a<1&&0<=this._a;return t||!n||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"name"!==e?("rgb"===e&&(a=this.toRgbString()),"prgb"===e&&(a=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(a=this.toHexString()),"hex3"===e&&(a=this.toHexString(!0)),"hex8"===e&&(a=this.toHex8String()),"name"===e&&(a=this.toName()),"hsl"===e&&(a=this.toHslString()),"hsv"===e&&(a=this.toHsvString()),a||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},_applyModification:function(e,t){var a=e.apply(null,[this].concat([].slice.call(t)));return this._r=a._r,this._g=a._g,this._b=a._b,this.setAlpha(a._a),this},lighten:function(){return this._applyModification(b,arguments)},brighten:function(){return this._applyModification(g,arguments)},darken:function(){return this._applyModification(y,arguments)},desaturate:function(){return this._applyModification(m,arguments)},saturate:function(){return this._applyModification(f,arguments)},greyscale:function(){return this._applyModification(v,arguments)},spin:function(){return this._applyModification($,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(x,arguments)},complement:function(){return this._applyCombination(w,arguments)},monochromatic:function(){return this._applyCombination(S,arguments)},splitcomplement:function(){return this._applyCombination(C,arguments)},triad:function(){return this._applyCombination(T,arguments)},tetrad:function(){return this._applyCombination(_,arguments)}},c.fromRatio=function(e,t){if("object"==typeof e){var a={};for(var n in e)e.hasOwnProperty(n)&&(a[n]="a"===n?e[n]:z(e[n]));e=a}return c(e,t)},c.equals=function(e,t){return!(!e||!t)&&c(e).toRgbString()==c(t).toRgbString()},c.random=function(){return c.fromRatio({r:t(),g:t(),b:t()})},c.mix=function(e,t,a){a=0===a?0:a||50;var n=c(e).toRgb(),i=c(t).toRgb(),r=a/100,o=2*r-1,s=i.a-n.a,l=o*s==-1?o:(o+s)/(1+o*s),d=1-(l=(l+1)/2),p={r:i.r*l+n.r*d,g:i.g*l+n.g*d,b:i.b*l+n.b*d,a:i.a*r+n.a*(1-r)};return c(p)},c.readability=function(e,t){var a=c(e),n=c(t),i=a.toRgb(),r=n.toRgb(),o=a.getBrightness(),s=n.getBrightness(),l=Math.max(i.r,r.r)-Math.min(i.r,r.r)+Math.max(i.g,r.g)-Math.min(i.g,r.g)+Math.max(i.b,r.b)-Math.min(i.b,r.b);return{brightness:Math.abs(o-s),color:l}},c.isReadable=function(e,t){var a=c.readability(e,t);return 125<a.brightness&&500<a.color},c.mostReadable=function(e,t){for(var a=null,n=0,i=!1,r=0;r<t.length;r++){var o=c.readability(e,t[r]),s=125<o.brightness&&500<o.color,l=o.brightness/125*3+o.color/500;(s&&!i||s&&i&&n<l||!s&&!i&&n<l)&&(i=s,n=l,a=c(t[r]))}return a};var k=c.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function P(e){return e=parseFloat(e),(isNaN(e)||e<0||1<e)&&(e=1),e}function M(e,t){var a;"string"==typeof(a=e)&&-1!=a.indexOf(".")&&1===parseFloat(a)&&(e="100%");var n,i="string"==typeof(n=e)&&-1!=n.indexOf("%");return e=p(t,h(0,parseFloat(e))),i&&(e=parseInt(e*t,10)/100),d.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function F(e){return p(1,h(0,e))}function R(e){return parseInt(e,16)}function A(e){return 1==e.length?"0"+e:""+e}function z(e){return e<=1&&(e=100*e+"%"),e}e=c.hexNames=function(e){var t={};for(var a in e)e.hasOwnProperty(a)&&(t[e[a]]=a);return t}(k);var D,H,N,E=(H="[\\s|\\(]+("+(D="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+D+")[,|\\s]+("+D+")\\s*\\)?",N="[\\s|\\(]+("+D+")[,|\\s]+("+D+")[,|\\s]+("+D+")[,|\\s]+("+D+")\\s*\\)?",{rgb:new RegExp("rgb"+H),rgba:new RegExp("rgba"+N),hsl:new RegExp("hsl"+H),hsla:new RegExp("hsla"+N),hsv:new RegExp("hsv"+H),hsva:new RegExp("hsva"+N),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});window.tinycolor=c}(),He(function(){He.fn.spectrum.load&&He.fn.spectrum.processNativeColorInputs()})}),(Pharmit=Pharmit||{}).Viewer=function(){"use strict";return function(e){function r(e){if(!e)return"";var t=e.split(".");return t.length<=1?"":t.pop()}function p(e){var t=u[e],a=t.selectedStyle,n=t.styles[a],i=n.style,r=n.nonbond,o=t.model;o&&(o.setStyle({},i),o.setStyle({bonds:0},r)),v.render()}function c(a,e,t){var n=u[a],i=$("<tr>").appendTo(e).addClass("pharmit_styleselectrow"),r=a+"MolStyleSelect";$('<label for="'+r+'">'+a+":</label>").appendTo(i).addClass("pharmit_stylelabel").appendTo($("<td>").appendTo(i));var o=$("<td nowrap>").appendTo(i),s=$('<select name="'+r+'" id="'+r+'">').appendTo(o).addClass("pharmit_styleselector");$.each(n.styles,function(e,t){$('<option value="'+e+'">'+t.name+"</option>").appendTo(s)}),s.val(n.selectedstyle),s.selectmenu({width:"11em",appendTo:e,change:function(){s.change()},position:{my:"left top",at:"left bottom",collision:"flip"}}),s.selectmenu("widget").css("width","");var l=n.colorscheme;$.each(n.styles,function(e,t){$.each(t.style,function(e,t){t.colorscheme=l})}),s.change(function(){n.selectedStyle=this.value,s.selectmenu("refresh"),p(a)});var d=$('<input name="'+r+'color">').appendTo($("<td>").appendTo(i));d.val(n.defaultColor),d.change(function(){var e=this.value;d.spectrum("set",e);var t=parseInt(d.spectrum("get").toHex(),16);n.colorscheme.C=t,p(a)}),d.spectrum({showPalette:!0,preferredFormat:"hex",replacerClassName:"ui-state-default ui-corner-all",showPaletteOnly:!0,clickoutFiresChange:!0,palette:["#C8C8C8","gray","white","green","cyan","magenta","yellow","orange","purple","blue"],change:function(e){d.change()}}),s.change(),d.change(),s.selectmenu("refresh")}$3Dmol.elementColors;var a={left:0,right:0},h={Aromatic:"purple",HydrogenDonor:"0xf0f0f0",HydrogenAcceptor:"orange",Hydrophobic:"green",NegativeIon:"red",PositiveIon:"blue",ExclusionSphere:"grey",InclusionSphere:"yellow"},u={Ligand:{model:null,defaultColor:"#C8C8C8",colorscheme:$.extend({},$3Dmol.elementColors.defaultColors),selectedstyle:"stick",styles:{stick:{name:"Stick",style:{stick:{radius:.15}},nonbond:{sphere:{radius:.15}}},wire:{name:"Wire",style:{line:{linewidth:2}},nonbond:{sphere:{radius:.05}}},sphere:{name:"Sphere",style:{sphere:{}},nonbond:{sphere:{}}},none:{name:"None",style:{},nonbond:{}}}},Receptor:{model:null,defaultColor:"#C8C8C8",colorscheme:$.extend({},$3Dmol.elementColors.defaultColors),backbone:null,selectedstyle:"cartoonwire",styles:{stick:{name:"Stick",style:{stick:{radius:.1}},nonbond:{sphere:{radius:.1}}},wire:{name:"Wire",style:{line:{linewidth:3}},nonbond:{sphere:{radius:.05}}},sphere:{name:"Sphere",style:{sphere:{}},nonbond:{sphere:{}}},cartoon:{name:"Cartoon",style:{cartoon:{}},nonbond:{sphere:{radius:.1}}},cartoonwire:{name:"Cartoon+Wire",style:{cartoon:{},line:{linewidth:3}},nonbond:{sphere:{radius:.2}}},none:{name:"None",style:{},nonbond:{}}}},Results:{model:null,defaultColor:"gray",colorscheme:$.extend({},$3Dmol.elementColors.defaultColors),selectedstyle:"stick",styles:{stick:{name:"Stick",style:{stick:{radius:.25}},nonbond:{sphere:{radius:.25}}},wire:{name:"Wire",style:{line:{linewidth:4}},nonbond:{sphere:{radius:.1}}},sphere:{name:"Sphere",style:{sphere:{}},nonbond:{sphere:{}}},none:{name:"None",style:{},nonbond:{}}}}},m=null,f={map:{prop:"partialCharge",scheme:new $3Dmol.Gradient.RWB(-.8,.8)},opacity:.8},v=null,b=[];this.appendViewerControls=function(e){var t=$("<table>").appendTo(e);c("Ligand",t),c("Results",t),c("Receptor",t);var a=$("<div>").addClass("pharmit_backbonediv").appendTo(e);$('<label for="receptorbackbone">Receptor Backbone:</label>').appendTo(a);var n=$('<div id="receptorbackbone">').appendTo(a);$('<input type="radio" id="plainBackbone" name="receptorbackbone"><label for="plainBackbone">Plain</label>').appendTo(n).change(function(){var e;$(this).prop("checked")&&(delete(e=u.Receptor).styles.cartoon.style.cartoon.color,delete e.styles.cartoonwire.style.cartoon.color,p("Receptor")),n.buttonset("refresh")}).prop("checked",!0),$('<input type="radio" id="rainbowBackbone" name="receptorbackbone"><label for="rainbowBackbone">Rainbow</label>').appendTo(n).change(function(){var e;$(this).prop("checked")&&((e=u.Receptor).styles.cartoon.style.cartoon.color="spectrum",e.styles.cartoonwire.style.cartoon.color="spectrum",p("Receptor")),n.buttonset("refresh")}),n.buttonset();var i=$("<div>").addClass("pharmit_surfacetransparencydiv").appendTo(e);$('<label for="surfaceopacity">Receptor Surface Opacity:</label>').appendTo(i);var r=$("<div>").addClass("pharmit_surfacetransparencyslider").appendTo(i),o=$('<input type="hidden" name="surfaceopacity">').appendTo(i);o.val(.8);var s=$('<div id="surfaceopacity">').appendTo(r).slider({animate:"fast",step:.05,min:0,max:1,value:.8,change:function(e,t){o.val(t.value).change()}});o.change(function(){var e=o.val();f.opacity=e,null!==m&&v.setSurfaceMaterialStyle(m,f),s.slider("value")!=e&&s.slider("value",e),v.render()});var l=$("<div>").addClass("pharmit_backgroundcolordiv").appendTo(e);$('<label for="backgroundcolor">Background Color:</label>').appendTo(l);var d=$('<div id="backgroundcolor">').appendTo(l);$('<input type="radio" id="whiteBackground" name="backgroundcolor"><label for="whiteBackground">White</label>').appendTo(d).change(function(){$(this).prop("checked")&&v.setBackgroundColor("white"),d.buttonset("refresh")}).prop("checked",!0),$('<input type="radio" id="blackBackground" name="backgroundcolor"><label for="blackBackground">Black</label>').appendTo(d).change(function(){$(this).prop("checked")&&v.setBackgroundColor("black"),d.buttonset("refresh")}),d.buttonset()},this.setReceptor=function(e,t){var a,n,i=u.Receptor.model;i&&v.removeModel(i),(i=null)!==m&&v.removeSurface(m),m=null,e?(a=r(t),i=v.addModel(e,a),u.Receptor.model=i,p("Receptor"),v.mapAtomProperties($3Dmol.applyPartialCharges,{model:i}),n=v.addSurface($3Dmol.SurfaceType.VDW,f,{model:i,bonds:0,invert:!0}),m=n.surfid,v.zoomTo({})):v.render()},this.setLigand=function(e,t){var a,n=u.Ligand.model;n&&v.removeModel(n),n=null,e?(a=r(t),n=v.addModel(e,a),u.Ligand.model=n,p("Ligand"),v.zoomTo({model:n})):v.render()},this.setResult=function(e){var t=u.Results.model;t&&v.removeModel(t),e?(t=v.addModel(e,"sdf"),u.Results.model=t,p("Results"),v.zoomTo({model:t})):v.render()},this.setView=function(e){e?v.setView(e):v.zoomTo()},this.getView=function(){return v.getView()},this.addMesh=function(e,t){"exclusive"==t.kind?e.color="grey":"inclusive"==t.kind&&(e.color="yellow"),$.extend(e,t);var a=v.addCustom(e);return v.render(),a},this.updateMesh=function(e,t){e&&(e.updateStyle&&e.updateStyle(t),v.render())},this.removeMesh=function(e){v.removeShape(e),v.render()},this.hideMesh=function(e){},this.unhideMesh=function(e){},this.addFeature=function(e,t){var a,n,i,r,o,s,l,d,p={center:{x:e.x,y:e.y,z:e.z},radius:e.radius,color:h[e.name],wireframe:!0,linewidth:1.5,clickable:!0,callback:t},c={sphere:null,arrows:[],label:null};return c.sphere=v.addSphere(p),e.selected&&c.sphere.updateStyle({wireframe:!1}),e.hasvec&&e.vector_on&&e.svector&&(i=new $3Dmol.Vector3(e.svector.x,e.svector.y,e.svector.z),n=((a=e.radius+1)-.5)/a,s={start:r=(i=i.normalize()).clone().multiplyScalar(e.radius).add(e),end:o=i.clone().multiplyScalar(a).add(e),radius:.075,radiusRatio:2,mid:n,wireframe:!e.selected,color:h[e.name]},c.arrows.push(v.addArrow(s)),"Aromatic"==e.name&&(r=i.clone().multiplyScalar(-e.radius).add(e),o=i.clone().multiplyScalar(-a).add(e),s.start=r,s.end=o,c.arrows.push(v.addArrow(s)))),"Hydrophobic"!=e.name||":"!=(l=e.minsize+":"+e.maxsize)&&(d={position:{x:e.x,y:e.y,z:e.z},showBackground:!0,fontColor:"black",backgroundColor:h[e.name],backgroundOpacity:.5,alignment:$3Dmol.SpriteAlignment.center},c.label=v.addLabel(l,d)),v.render(),b.push(c),b.length-1},this.selectFeature=function(e){var t=b[e];t&&t.sphere&&(t.sphere.updateStyle({wireframe:!1}),$.each(t.arrows,function(e,t){t.updateStyle({wireframe:!1})}),v.render())},this.unselectFeature=function(e){var t=b[e];t&&t.sphere&&(t.sphere.updateStyle({wireframe:!0}),$.each(t.arrows,function(e,t){t.updateStyle({wireframe:!0})}),v.render())},this.removeFeature=function(e){var t=b[e];for(t&&(t.sphere&&v.removeShape(t.sphere),$.each(t.arrows,function(e,t){v.removeShape(t)}),t.label&&v.removeLabel(t.label),v.render()),delete b[e];0<b.length&&void 0===b[b.length-1];)b.pop()},this.setLeft=function(e){var t=e-a.left;a.left=e,v.translate(t/2,0)},this.setRight=function(e){var t=a.right-e;a.right=e,v.translate(t/2,0)};var t=null;this.disableRendering=function(){t=v.render,v.render=function(){}},this.enableRendering=function(){t&&(v.render=t),v.render()},(v=new $3Dmol.GLViewer(e)).setBackgroundColor("white")}}();