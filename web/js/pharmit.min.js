function Feature(e,t,a){var n=this;this.obj={},this.shape=null,this.selected=!1,this.updateViewer=function(){},this.container=$("<div>").appendTo(t).addClass("pharmit_featurediv"),this.container.get(0).feature=this,this.container.disableSelection();var i=$("<h3></h3>").appendTo(this.container);this.enabled=$("<div>").addClass("toggle toggle-light pharmit_togglediv").appendTo(i).toggles().on("toggle",function(e,t){t?(n.obj.enabled=!0,n.container.addClass("pharmit_enabledfeature")):(n.obj.enabled=!1,n.container.removeClass("pharmit_enabledfeature")),n.updateViewer()}).click(function(){return!1});var r=$("<div>").addClass("pharmit_featurenamediv").appendTo(i),o=$("<span>").addClass("pharmit_featurenameheading").appendTo(r),s=$("<div>").addClass("pharmit_featureclose").appendTo(i).click(function(){n.deleteFeature()}),l=($("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(s),$("<span>").appendTo(r).addClass("pharmit_featuresummary"));l.append($(document.createTextNode("("))),this.xsummary=$("<span>").appendTo(l),l.append($(document.createTextNode(","))),this.ysummary=$("<span>").appendTo(l),l.append($(document.createTextNode(","))),this.zsummary=$("<span>").appendTo(l),l.append($(document.createTextNode(") Radius "))),this.rsummary=$("<span>").appendTo(l);var d=$("<div>").appendTo(this.container),p=this.select=$('<select name="featurename">').addClass("pharmit_featureselect").appendTo(d);$.each(this.featureNames,function(e,t){$('<option value="'+t+'">'+t+"</option>").appendTo(p)}),p.change(function(){var e=this.value;n.obj.name=e,o.text(e),"Aromatic"==e||"HydrogenDonor"==e||"HydrogenAcceptor"==e?(n.orientdiv.show(),n.sizediv.hide(),n.obj.hasvec=!0):"Hydrophobic"==e?(n.orientdiv.hide(),n.sizediv.show(),n.obj.hasvec=!1):(n.orientdiv.hide(),n.sizediv.hide(),n.obj.hasvec=!1),n.updateViewer()}),p.selectmenu({width:"12em",change:function(){p.trigger("change")}});var c=$("<div>").appendTo(d).addClass("pharmit_locationdiv"),u=function(e,t){var a=function(){e.change()};return t.spin=t.stop=t.change=a,t},h=function(e){return Math.round(1e3*e)/1e3},m=$("<div>").appendTo(c).addClass("pharmit_coorddiv");$("<label>x:</label>").appendTo(m),this.x=$("<input>").appendTo(m).addClass("pharmit_coordinput").change(function(){var e=this.value=h(parseFloat(this.value));n.xsummary.text(numeral(e).format("0.[00]")),n.obj.x=h(e),n.updateViewer()}),this.x.spinner(u(n.x,{step:.1,numberFormat:"n"})),m=$("<div>").appendTo(c).addClass("pharmit_coorddiv"),$("<label>y:</label>").appendTo(m),this.y=$("<input>").appendTo(m).addClass("pharmit_coordinput"),this.y.spinner(u(n.y,{step:.1,numberFormat:"n"})).change(function(){var e=this.value=h(parseFloat(this.value));n.ysummary.text(numeral(e).format("0.[00]")),n.obj.y=h(e),n.updateViewer()}),m=$("<div>").appendTo(c).addClass("pharmit_coorddiv"),$("<label>z:</label>").appendTo(m),this.z=$("<input>").appendTo(m).addClass("pharmit_coordinput"),this.z.spinner(u(n.z,{step:.1,numberFormat:"n"})).change(function(){var e=this.value=h(parseFloat(this.value));n.zsummary.text(numeral(e).format("0.[00]")),n.obj.z=e,n.updateViewer()}),m=$("<div>").appendTo(c).addClass("pharmit_coorddiv"),$("<label>Radius:</label>").appendTo(m),this.radius=$("<input>").appendTo(m).addClass("pharmit_radiusinput"),this.radius.spinner(u(n.radius,{step:.1,numberFormat:"n"})).change(function(){n.rsummary.text(numeral(this.value).format("0.[00]")),n.obj.radius=this.value=h(this.value),n.updateViewer()});var f=this.orientdiv=$("<div>").appendTo(d).addClass("pharmit_orientdiv"),g=null,v=null,b=function(){var e=Math.round(parseFloat(v.val()))%360,t=Math.round(parseFloat(g.val()))%360;isNaN(e)&&(e=0),isNaN(t)&&(t=0),v.val(e),g.val(t),t=t*Math.PI/180,e=e*Math.PI/180,n.obj.svector={x:Math.sin(t)*Math.cos(e),y:Math.sin(t)*Math.sin(e),z:Math.cos(t)},n.updateViewer()};this.orientenabled=$('<input type="checkbox">').appendTo(f).change(function(){$(this).prop("checked")?(g.spinner("option","disabled",!1),v.spinner("option","disabled",!1),n.obj.vector_on=1):(g.spinner("option","disabled",!0),v.spinner("option","disabled",!0),n.obj.vector_on=0,b()),n.updateViewer()});var y=$("<span>").addClass("pharmit_nowrap").appendTo(f);$("<label>&theta;:</label>").appendTo(y),g=this.theta=$("<input>").appendTo(y).addClass("pharmit_orientinput"),this.theta.spinner(u(n.theta,{step:1,numberFormat:"n"})).change(b),y=$("<span>").addClass("pharmit_nowrap").appendTo(f),$("<label>&phi;:</label>").appendTo(y),v=this.phi=$("<input>").appendTo(y).addClass("pharmit_orientinput"),this.phi.spinner(u(n.theta,{step:1,numberFormat:"n"})).change(b),this.orientdiv.hide();var w=this.sizediv=$("<div>").appendTo(d).addClass("pharmit_sizediv");this.minsize=$("<input>").appendTo(w).addClass("pharmit_sizeinput"),this.minsize.spinner(u(n.minsize,{step:1,numberFormat:"n"})).change(function(){n.obj.minsize=this.value,n.updateViewer()}),$("<label> &le; #Atoms &le;</label>").appendTo(w).addClass("pharmit_nowrap"),this.maxsize=$("<input>").appendTo(w).addClass("pharmit_sizeinput"),this.maxsize.spinner(u(n.maxsize,{step:1,numberFormat:"n"})).change(function(){n.obj.maxsize=this.value,n.updateViewer()}),this.sizediv.hide(),this.setFeature(a),delete this.updateViewer,this.viewer=e,this.updateViewer(),t.accordion("refresh"),t.accordion("option","active",t.children().length-1)}function Message(e,t,a){function n(e){"ack2"==e.data&&(l=1)}function i(){l?(r.postMessage(s,o),o="",s="",r=null,l=0,window.removeEventListener("message",n)):r&&(r.postMessage("ack",o),setTimeout(i,250))}var r=t,o=a,s=e,l=0;window.addEventListener("message",n),t.postMessage("ack",a),setTimeout(i,250)}Feature.prototype.setFeature=function(e){if(this.select.val(e.name).trigger("change"),this.select.selectmenu("refresh"),this.x.val(e.x).trigger("change"),this.y.val(e.y).trigger("change"),this.z.val(e.z).trigger("change"),this.radius.val(e.radius).trigger("change"),this.enabled.toggles(e.enabled),this.obj.enabled=!!e.enabled,this.orientenabled.prop("checked",1==e.vector_on).trigger("change"),$.isNumeric(e.minsize)?this.minsize.val(e.minsize).trigger("change"):this.obj.minsize="",$.isNumeric(e.maxsize)?this.maxsize.val(e.maxsize).trigger("change"):this.obj.maxsize="",e.svector){var t=e.svector.x,a=e.svector.y,n=e.svector.z,i=180*Math.acos(n/Math.sqrt(t*t+a*a+n*n))/Math.PI,r=180*Math.atan2(a,t)/Math.PI;this.theta.val(i).trigger("change"),this.phi.val(r).trigger("change")}else this.obj.svector={x:1,y:0,z:0}},Feature.prototype.featureNames=["Aromatic","HydrogenDonor","HydrogenAcceptor","Hydrophobic","NegativeIon","PositiveIon","ExclusionSphere"],Feature.prototype.updateViewer=function(){if(null!==this.shape&&(this.viewer.removeFeature(this.shape),this.shape=null),this.obj.enabled){var e=this;this.shape=this.viewer.addFeature(this.obj,function(){e.selected?e.deselectFeature():e.selectFeature()})}},Feature.prototype.selectFeature=function(){this.viewer.selectFeature(this.shape),this.container.addClass("pharmit_selectedFeature"),this.selected=!0,this.obj.selected=!0},Feature.prototype.deselectFeature=function(){this.viewer.unselectFeature(this.shape),this.container.removeClass("pharmit_selectedFeature"),this.selected=!1,this.obj.selected=!1},Feature.prototype.deleteFeature=function(){null!==this.shape&&this.viewer.removeFeature(this.shape),this.container.feature=null,this.container.remove()};var Pharmit=Pharmit||{};!function(){function e(e){return a(t(n(e)))}function t(e){return r(o(i(e),8*e.length))}function a(e){for(var t,a=m?"0123456789ABCDEF":"0123456789abcdef",n="",i=0;i<e.length;i++)t=e.charCodeAt(i),n+=a.charAt(t>>>4&15)+a.charAt(15&t);return n}function n(e){for(var t,a,n="",i=-1;++i<e.length;)t=e.charCodeAt(i),a=i+1<e.length?e.charCodeAt(i+1):0,t>=55296&&56319>=t&&a>=56320&&57343>=a&&(t=65536+((1023&t)<<10)+(1023&a),i++),127>=t?n+=String.fromCharCode(t):2047>=t?n+=String.fromCharCode(192|t>>>6&31,128|63&t):65535>=t?n+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):2097151>=t&&(n+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return n}function i(e){for(var t=Array(e.length>>2),a=0;a<t.length;a++)t[a]=0;for(a=0;a<8*e.length;a+=8)t[a>>5]|=(255&e.charCodeAt(a/8))<<a%32;return t}function r(e){for(var t="",a=0;a<32*e.length;a+=8)t+=String.fromCharCode(e[a>>5]>>>a%32&255);return t}function o(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var a=1732584193,n=-271733879,i=-1732584194,r=271733878,o=0;o<e.length;o+=16){var s=a,h=n,m=i,f=r;a=l(a,n,i,r,e[o+0],7,-680876936),r=l(r,a,n,i,e[o+1],12,-389564586),i=l(i,r,a,n,e[o+2],17,606105819),n=l(n,i,r,a,e[o+3],22,-1044525330),a=l(a,n,i,r,e[o+4],7,-176418897),r=l(r,a,n,i,e[o+5],12,1200080426),i=l(i,r,a,n,e[o+6],17,-1473231341),n=l(n,i,r,a,e[o+7],22,-45705983),a=l(a,n,i,r,e[o+8],7,1770035416),r=l(r,a,n,i,e[o+9],12,-1958414417),i=l(i,r,a,n,e[o+10],17,-42063),n=l(n,i,r,a,e[o+11],22,-1990404162),a=l(a,n,i,r,e[o+12],7,1804603682),r=l(r,a,n,i,e[o+13],12,-40341101),i=l(i,r,a,n,e[o+14],17,-1502002290),n=l(n,i,r,a,e[o+15],22,1236535329),a=d(a,n,i,r,e[o+1],5,-165796510),r=d(r,a,n,i,e[o+6],9,-1069501632),i=d(i,r,a,n,e[o+11],14,643717713),n=d(n,i,r,a,e[o+0],20,-373897302),a=d(a,n,i,r,e[o+5],5,-701558691),r=d(r,a,n,i,e[o+10],9,38016083),i=d(i,r,a,n,e[o+15],14,-660478335),n=d(n,i,r,a,e[o+4],20,-405537848),a=d(a,n,i,r,e[o+9],5,568446438),r=d(r,a,n,i,e[o+14],9,-1019803690),i=d(i,r,a,n,e[o+3],14,-187363961),n=d(n,i,r,a,e[o+8],20,1163531501),a=d(a,n,i,r,e[o+13],5,-1444681467),r=d(r,a,n,i,e[o+2],9,-51403784),i=d(i,r,a,n,e[o+7],14,1735328473),n=d(n,i,r,a,e[o+12],20,-1926607734),a=p(a,n,i,r,e[o+5],4,-378558),r=p(r,a,n,i,e[o+8],11,-2022574463),i=p(i,r,a,n,e[o+11],16,1839030562),n=p(n,i,r,a,e[o+14],23,-35309556),a=p(a,n,i,r,e[o+1],4,-1530992060),r=p(r,a,n,i,e[o+4],11,1272893353),i=p(i,r,a,n,e[o+7],16,-155497632),n=p(n,i,r,a,e[o+10],23,-1094730640),a=p(a,n,i,r,e[o+13],4,681279174),r=p(r,a,n,i,e[o+0],11,-358537222),i=p(i,r,a,n,e[o+3],16,-722521979),n=p(n,i,r,a,e[o+6],23,76029189),a=p(a,n,i,r,e[o+9],4,-640364487),r=p(r,a,n,i,e[o+12],11,-421815835),i=p(i,r,a,n,e[o+15],16,530742520),n=p(n,i,r,a,e[o+2],23,-995338651),a=c(a,n,i,r,e[o+0],6,-198630844),r=c(r,a,n,i,e[o+7],10,1126891415),i=c(i,r,a,n,e[o+14],15,-1416354905),n=c(n,i,r,a,e[o+5],21,-57434055),a=c(a,n,i,r,e[o+12],6,1700485571),r=c(r,a,n,i,e[o+3],10,-1894986606),i=c(i,r,a,n,e[o+10],15,-1051523),n=c(n,i,r,a,e[o+1],21,-2054922799),a=c(a,n,i,r,e[o+8],6,1873313359),r=c(r,a,n,i,e[o+15],10,-30611744),i=c(i,r,a,n,e[o+6],15,-1560198380),n=c(n,i,r,a,e[o+13],21,1309151649),a=c(a,n,i,r,e[o+4],6,-145523070),r=c(r,a,n,i,e[o+11],10,-1120210379),i=c(i,r,a,n,e[o+2],15,718787259),n=c(n,i,r,a,e[o+9],21,-343485551),a=u(a,s),n=u(n,h),i=u(i,m),r=u(r,f)}return Array(a,n,i,r)}function s(e,t,a,n,i,r){return u(h(u(u(t,e),u(n,r)),i),a)}function l(e,t,a,n,i,r,o){return s(t&a|~t&n,e,t,i,r,o)}function d(e,t,a,n,i,r,o){return s(t&n|a&~n,e,t,i,r,o)}function p(e,t,a,n,i,r,o){return s(t^a^n,e,t,i,r,o)}function c(e,t,a,n,i,r,o){return s(a^(t|~n),e,t,i,r,o)}function u(e,t){var a=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(a>>16);return n<<16|65535&a}function h(e,t){return e<<t|e>>>32-t}var m=0;Pharmit.hex_md5=e}(),function(e){e.support.cssPseudoClasses=function(){try{var t=e("<input type='checkbox' checked/>").appendTo("body"),a=e('<style type="text/css" />').appendTo("head");a.text("input:checked {width: 200px; display: none}");var n="200px"==t.css("width");return t.remove(),a.remove(),n}catch(i){return!1}}(),e.fn.fileinput=function(t){var a=this;return t||(t='<button class="fileinput">Browse...</button>'),a.each(function(){var a=e(this);a.wrap('<div class="fileinput-wrapper" style=" position: relative; display: inline-block;" />'),a.parent().mousemove(function(t){var a,n,i=e(this);a=i.offset().left,n=i.offset().top,i.find("input").css({left:t.pageX-a-i.find("input[type=file]").width()+30,top:t.pageY-n-10})}),a.attr("tabindex","-1").css({filter:"alpha(opacity=0)","-moz-opacity":0,opacity:0,position:"absolute","z-index":-1}),a.before(t),a.prev().addClass("fileinput"),e.support.cssPseudoClasses?(a.prev(".fileinput").click(function(){a.click()}),a.prev(":submit.fileinput").click(function(e){e.preventDefault()})):(a.css({"z-index":"auto",cursor:"pointer"}),a.prev(".fileinput").css("z-index",-1),a.removeAttr("tabindex"),a.prev(".fileinput").attr("tabindex","-1"),a.hover(function(){e(this).prev(".fileinput").addClass("hover")},function(){e(this).prev(".fileinput").removeClass("hover")}).focusin(function(){e(this).prev(".fileinput").addClass("focus")}).focusout(function(){e(this).prev(".fileinput").removeClass("focus")}).mousedown(function(){e(this).prev(".fileinput").addClass("active")}).mouseup(function(){e(this).prev(".fileinput").removeClass("active")}))}),a}}(jQuery);var Pharmit=Pharmit||{};$(document).ready(function(){Pharmit.server="/fcgi-bin/pharmitserv.fcgi",Pharmit.email="dkoes+pharmit@pitt.edu";var e={};for(var t in window)e[t]=!0;$(document).tooltip(),Pharmit.inFormSubmit=!1,Pharmit.checkGlobals=function(){var t=[];for(var a in window)a in e||t.push(a);t.length>0&&console.log("Leaked global variables: ["+t.join(", ")+"]")};var a=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",a=new RegExp(t),n=a.exec(window.location.href);return null===n?null:n[1]},n=$("#pharmit").addClass("pharmit_main"),i=new Pharmit.Viewer(n),r=new Pharmit.Results(n,i),o=new Pharmit.Query(n,i,r);a("SESSION")&&$.get(decodeURI(a("SESSION")),function(e){o.loadSession(e)}),Pharmit.checkGlobals(),$("button, input[type='button'], input[type='submit']").button().bind("mouseup",function(){$(this).blur()});var s=function(e){if("ack"==e.data)e.source.postMessage("ack2","*");else if("ack2"==e.data);else try{var t=$.parseJSON(e.data);o.setLigandAndReceptor(t.ligand,t.ligandFormat,t.receptor,t.recname)}catch(a){alert("Communication error: "+a)}};window.addEventListener("message",s)});var Pharmit=Pharmit||{};Pharmit.MinResults=function(){function e(e,t){var a=null,n=null,i=null,r=null,o=null,s=null,l=null,d=null,p=0,c=null,u=null,h=function(t){if(0===t.status)return{error:t.msg};for(var a=t.data,n=0;n<a.length;n++)a[n][3]=numeral(a[n][3]).format("0.00"),a[n][4]=numeral(a[n][4]).format("0.000"),a[n][2]=e.mangleName(a[n][2]);return a},m=function(e){return e.cmd="getsminadata",e.qid=n,""!==l.val()&&(e.maxRMSD=l.val()),""!==s.val()&&(e.maxScore=s.val()),d.prop("checked")&&(e.unique=1),e},f=this.cancel=function(){clearTimeout(c),$.fn.DataTable.isDataTable(o)&&n>0&&(o.DataTable().clear(),$.post(Pharmit.server,{cmd:"cancelsmina",qid:n})),n=null,t.setResult(),i.button("option","disabled",!0),a.hide()};this.minimize=function(e,t,i,s){p=i,r=s,n=e,u=t;var l={cmd:"startsmina",qid:n,receptorid:t.receptorid,recname:t.recname};$(".pharmit_mincontainer .pharmit_resbody").css({opacity:0}),$.post(Pharmit.server,l,null,"json").done(function(e){if(e.status){sminaid=e.sminaid;var t=Math.floor((w.height()-100)/29);o.dataTable({searching:!1,pageLength:t,destroy:!0,lengthChange:!1,order:[[3,"asc"]],orderMulti:!1,columnDefs:[{targets:[0],visible:!1},{targets:[1],visible:!1},{targets:[2],className:"pharmit_minname",searchable:!1,sortable:!1},{targets:[3],className:"pharmit_minscore",searchable:!1},{targets:[4],className:"pharmit_minrmsd",searchable:!1}],language:{emptyTable:"Minimizing...",infoEmpty:" ",infoFiltered:"<br>(filtered from _MAX_ total hits)",info:"Minimizing..."},serverSide:!0,processing:!1,ajax:{url:Pharmit.server,data:m,dataSrc:h}}),o.show(),$(".pharmit_mincontainer .pharmit_resbody").css({opacity:100})}else f(),r&&r(),alert("Error: "+e.msg)}).fail(function(){f(),r&&r(),alert("Error contacting minimization server.  Please inform "+Pharmit.email+" if this problem persists.")}),a.show()};var g=function(){Pharmit.inFormSubmit=!0;var e=Pharmit.server+"?cmd=savesmina&qid="+n;""!==l.val()&&(e+="&maxRMSD="+l.val()),""!==s.val()&&(e+="&maxScore="+s.val()),d.prop("checked")&&(e+="&unique=1");var t=o.DataTable().order();e+="&order[0][column]="+t[0][0],e+="&order[0][dir]="+t[0][1];var a=$("<form>",{action:e,method:"post"});a.appendTo(document.body),a.submit(),$(a).remove()};a=$("<div>").appendTo(e.div).addClass("pharmit_rescontainer pharmit_mincontainer");var v=$("<div>").appendTo(a).addClass("pharmit_resheader"),b=$("<div>Minimization Results</div>").appendTo(v).addClass("pharmit_heading").addClass("pharmit_rightheading"),y=$("<div>").addClass("pharmit_resclose").appendTo(b).click(function(){f(),r&&r()}),w=($("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(y),$("<div>").appendTo(a).addClass("pharmit_resbody"));o=$('<table width="100%" class="display compact" cellspacing="0">').addClass("pharmit_mintable").appendTo(w);var T=$("<tr>").appendTo($("<thead>").appendTo(o));$("<th>mid</th>").appendTo(T),$("<th>origpos</th>").appendTo(T),$("<th>Name</th>").appendTo(T),$('<th title="Computed using the AutoDock Vina scoring function">Score</th>').appendTo(T),$('<th title="The minimized RMSD, the heavy atom difference between the pharmacophore aligned pose and the minimized pose.  Small values imply a closer agreement to the query pharmacophore.">mRMSD</th>').appendTo(T),$("<tbody>").appendTo(o),o.on("xhr.dt",function(e,a,r){var s=o.DataTable().settings()[0].oLanguage;r.finished?(i.button("option","disabled",!1),s.sInfo="Showing _START_ to _END_ of _TOTAL_ entries"):0===r.status?alert(r.msg):(t.setResult(),s.sInfo=numeral(r.recordsTotal).format("0,0")+"/"+numeral(p).format("0,0"),clearTimeout(c),c=setTimeout(function(){$.fn.DataTable.isDataTable(o)&&n>0&&o.DataTable().ajax.reload()},1e3))}),o.on("draw.dt",function(){$(".pharmit_namecol span").powerTip({mouseOnToPopup:!0,placement:"s",smartPlacement:!0})}),$("tbody",o).on("click","tr",function(){var e=o.DataTable().row(this).data()[0],a=this;$(".pharmit_iterate_button").remove(),$(this).hasClass("selected")?($(this).removeClass("selected"),t.setResult()):(o.DataTable().$("tr.selected").removeClass("selected"),$(this).addClass("selected"),$.post(Pharmit.server,{cmd:"getsminamol",qid:n,molid:e}).done(function(n){$(a).hasClass("selected")&&t.setResult(n);var i=$('<div class="pharmit_iterate_button" title="Start new pharmit session around selected ligand">').appendTo($("td",a).last());i.button({icons:{primary:"ui-icon-arrowthickstop-1-e"},text:!1}),i.tooltip({show:{delay:500}}),i.click(function(t){t.stopPropagation();{var a=window.open("search.html"),i={ligand:n,ligandFormat:e+".sdf",receptor:u.receptor,recname:u.recname};new Message(JSON.stringify(i),a,"*")}})}))});var _=$("<div>").appendTo(a).addClass("pharmit_resfooter"),C=$("<div>").appendTo(_).addClass("pharmit_minparams").disableSelection(),x=$("<table>").appendTo(C),S=$("<tr>").appendTo(x).addClass("pharmit_paramrow");$("<td>").appendTo(S).append($("<label>Max Score</label>"));var k=$("<td>").appendTo(S);s=$('<input name="sminamaxscore">').appendTo(k).addClass("pharmit_sminainput").spinner(),d=$('<input type="checkbox" name="sminaunique">'),$("<td>").appendTo(S).addClass("pharmit_checkcell").append(d),$("<td>").appendTo(S).append($("<label>Single<br>conformer</label>")),S=$("<tr>").appendTo(x).addClass("pharmit_paramrow"),$("<td>").appendTo(S).append($("<label>Max mRMSD</label>")),k=$("<td>").appendTo(S),l=$('<input name="sminamaxrmsd">').appendTo(k).addClass("pharmit_sminainput").spinner(),k=$("<td colspan=2>").appendTo(S).addClass("pharmit_applycell"),$("<button>Apply</button>").appendTo(k).button().click(function(){o.DataTable().ajax.reload()});var P=$("<div>").appendTo(_).addClass("pharmit_minbottom");i=$("<button>Save...</button>").appendTo(P).button().click(g),a.hide();var M=0,R=0;$(window).resize(function(){if(n>0){var e=w.height();if(e!=M){M=e,e-=$("thead",o).height(),e-=$(".dataTables_info",w).height(),e-=$(".dataTables_paginate",w).height(),e-=20;var t=$("tr.odd",o).first().height()+1,a=Math.floor(e/t);a!=R&&(o.DataTable().page.len(a),o.DataTable().draw(),R=a)}}})}return e}();var Pharmit=Pharmit||{};Pharmit.PhResults=function(){function e(e,t,a){var n=null,i=null,r=null,o=null,s=null,l=null,d=null,p=null,c=e,u=null,h=function(e){if(0===e.status)return{error:e.msg};for(var t=e.data,a=0;a<t.length;a++)t[a][1]=numeral(t[a][1]).format("0.000"),t[a][0]=c.mangleName(t[a][0]);return t},m=0,f=0,g=function(){if(i>0){var e=s.height();if(e!=m){m=e,e-=$("thead",o).height(),e-=$(".dataTables_info",s).height(),e-=$(".dataTables_paginate",s).height(),e-=24;var t=$("tr.odd",o).first().height()+1,a=Math.floor(e/t);a!=f&&(o.DataTable().page.len(a),o.DataTable().draw(),f=a)}}};$.fn.DataTable.ext.pager.numbers_length=5,this.query=function(e){r=$.extend({},e),u=r.receptor,delete r.receptor,delete r.ligand;var t={cmd:"startquery",json:JSON.stringify(r)};null!==i&&(t.oldqid=i),$.post(Pharmit.server,t,null,"json").done(function(e){if(e.status){i=e.qid;var t=Math.floor((s.height()-120)/28);o.dataTable({searching:!1,pageLength:t,destroy:!0,lengthChange:!1,order:[[1,"asc"]],orderMulti:!1,columnDefs:[{targets:[0],className:"pharmit_namecol",searchable:!1,sortable:!1},{targets:[1],className:"pharmit_rmsdcol",searchable:!1},{targets:[2],className:"pharmit_masscol",searchable:!1},{targets:[3],className:"pharmit_bondscol",searchable:!1},{targets:[4],visible:!1}],language:{emptyTable:"Searching "+numeral(e.numMols).format("0,0")+" molecules and "+numeral(e.numConfs).format("0,0")+" conformers...",infoFiltered:"",infoEmpty:"",info:"<span class='pharmit_pulse'>Searching...</span>"},serverSide:!0,processing:!1,ajax:{url:Pharmit.server,data:{cmd:"getdata",qid:i},dataSrc:h}})}else v(),c.close(),alert("Error: "+e.msg)}).fail(function(){v(),c.close(),alert("Error contacting server.  Please inform "+Pharmit.email+" if this problem persists.")}),n.show()};var v=this.cancel=function(){a.cancel(),clearTimeout(p),null!==i&&$.post(Pharmit.server,{cmd:"cancelquery",oldqid:i}),$.fn.DataTable.isDataTable(o)&&o.DataTable().clear(),i=null,l.button("option","disabled",!0),d.button("option","disabled",!0)},b=function(){var e=Pharmit.server+"?cmd=saveres&qid="+i,t=$("<form>",{action:e,method:"post"});t.appendTo(document.body),Pharmit.inFormSubmit=!0,t.submit(),$(t).remove()},y=function(){n.hide();var e=o.DataTable().ajax.json().recordsTotal,t=$.extend({},r);t.receptor=u,a.minimize(i,t,e,function(){n.show()})};n=$("<div>").appendTo(c.div).addClass("pharmit_rescontainer");{var w=$("<div>").appendTo(n).addClass("pharmit_resheader"),T=$("<div>Pharmacophore Results</div>").appendTo(w).addClass("pharmit_heading").addClass("pharmit_rightheading"),_=$("<div>").addClass("pharmit_resclose").appendTo(T).click(function(){v(),c.close()});$("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(_)}s=$("<div>").appendTo(n).addClass("pharmit_resbody"),o=$('<table width="100%" class="display compact" cellspacing="0">').addClass("pharmit_phtable").appendTo(s);var C=$("<tr>").appendTo($("<thead>").appendTo(o));$("<th>Name</th>").appendTo(C),$("<th>RMSD</th>").appendTo(C),$("<th>Mass</th>").appendTo(C),$("<th>RBnds</th>").appendTo(C),$("<th>mid</th>").appendTo(C),$("<tbody>").appendTo(o),o.on("xhr.dt",function(e,a,n){if(n.finished){var r=o.DataTable().settings()[0].oLanguage;0===n.recordsTotal?r.emptyTable=r.sEmptyTable="No results found":(r.sInfo="Showing _START_ to _END_ of _TOTAL_ hits",l.button("option","disabled",!1),d.button("option","disabled",!1))}else 0===n.status||(t.setResult(),clearTimeout(p),p=setTimeout(function(){i>0&&o.DataTable().ajax.reload()},1e3))}),o.on("draw.dt",function(){$(".pharmit_namecol span").powerTip({mouseOnToPopup:!0,placement:"s",smartPlacement:!0})}),$("tbody",o).on("click","tr",function(){var e=this,a=o.DataTable().row(e).data()[4];$(".pharmit_iterate_button").remove(),$(e).hasClass("selected")?($(e).removeClass("selected"),t.setResult()):(o.DataTable().$("tr.selected").removeClass("selected"),$(e).addClass("selected"),$.post(Pharmit.server,{cmd:"getmol",qid:i,loc:a}).done(function(n){if($(e).hasClass("selected")){t.setResult(n);var i=$('<div class="pharmit_iterate_button" title="Start new pharmit session around selected ligand">').appendTo($("td",e).last());i.button({icons:{primary:"ui-icon-arrowthickstop-1-e"},text:!1}),i.tooltip({show:{delay:500}}),i.click(function(e){e.stopPropagation();{var t=window.open("search.html"),i={ligand:n,ligandFormat:a+".sdf",receptor:u,recname:r.recname};new Message(JSON.stringify(i),t,"*")}})}}))});var x=$("<div>").appendTo(n).addClass("pharmit_resfooter"),S=$("<div>").appendTo(x).addClass("pharmit_bottomloaders").addClass("pharmit_nowrap");l=$("<button>Minimize</button>").appendTo(S).button({disabled:!0}).click(y),d=$("<button>Save...</button>").appendTo(S).button({disabled:!0}).click(b),$(window).resize(g)}return e}();var Pharmit=Pharmit||{};Pharmit.Query=function(){function e(e,o,s){var l=$("<div>").addClass("pharmit_query pharmit_overlay"),d=null,p=null,c=null,u=null,h=null,m=null,f=null,g=function(){var e=C();e.receptor&&e.reckey&&delete e.receptor,delete e.ligand,s.phquery(e)},v=function(e,t){if(e.files.length>0){var a=e.files[0],n=new FileReader;n.onload=function(e){t(e.target.result,a.name)},n.readAsText(a),$(e).val("")}},b=function(e){(new Date).getTime();o.disableRendering(),d.detach();var t=d.children();$.each(t,function(e,t){t.feature.deleteFeature()}),d.empty(),e&&$.each(e,function(e,t){new Feature(o,d,t)}),d.accordion("option","active",!1),d.accordion("refresh"),p.after(d),o.enableRendering();(new Date).getTime()},y=function(e,t){m=null,f=null;var n={cmd:"getpharma",ligand:e,ligandname:t};u&&(h?(n.reckey=h,n.recname=u):(n.receptor=c,n.recname=u)),$.post(Pharmit.server,n,null,"json").done(function(n){n.status?(b(n.points),n.mol?(f=t,m=e,r(t,"mol2")&&a.test(e)&&(e=e.replace(a,"")),o.setLigand(e,t)):o.setView()):alert("Error: "+n.msg)}).fail(function(e,t){alert("parsererror"==t?"Didn't understand the the server resonse.  If you can reproduce this error, please send your input files to "+Pharmit.email+".":"Error contacting server.  Please inform "+Pharmit.email+" if this problem persists.")})},w=function(e,t){if(e&&t){c=e,u=t,o.setReceptor(e,t),h=null;var a=Pharmit.hex_md5(c);$.post(Pharmit.server,{cmd:"setreceptor",key:a,receptor:c}).done(function(){h=a})}};this.setLigandAndReceptor=function(e,t,a,n){a&&w(a,n),y(e,t)};var T=function(){var e=d.children().detach();e.sort(function(e,t){var a=e.feature.obj,n=t.feature.obj;return a.enabled!=n.enabled?n.enabled-a.enabled:a.name!=n.name?a.name.localeCompare(n.name):a.radius-n.radius}),d.append(e)},_=this.loadSession=function(e){var t=e;"string"==typeof e&&(t=$.parseJSON(e)),b(t.points),$.each(t,function(e,t){var a=$("input[name="+e+"]");a.length&&a.val(t).change()}),w(t.receptor,t.recname),o.setReceptor(c,u),t.sdf?(m=decodeURIComponent(t.sdf),f=m.match(/^@<TRIPOS>MOLECULE/)?".mol2":m.match(/^HETATM/)||m.match(/^ATOM/)?".pdb":m.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/)?".sdf":".xyz"):(m=t.ligand,f=t.ligandFormat),o.setLigand(m,f),t.backgroundcolor&&$("#"+t.backgroundcolor).prop("checked",!0).change(),o.setView(t.view)},C=function(){var e={};return e.points=[],$.each(d.children(),function(t,a){e.points.push(a.feature.obj)}),$.each($("[name]",l),function(t,a){var n=a.name;if(n){var i=a.value;$.isNumeric(a.value)&&(i=Number(a.value)),e[n]=i}}),e.backgroundcolor="whiteBackground",$("#blackBackground").prop("checked")&&(e.backgroundcolor="blackBackground"),e.ligand=m,e.ligandFormat=f,e.receptor=c,e.recname=u,e.receptorid=h,e.view=o.getView(),e},x=function(){Pharmit.inFormSubmit=!0;var e=Pharmit.server+'?cmd=savedata&type="text%2Fphjson"&fname="pharmit.json"',t=$("<form>",{action:e,method:"post"}),a=C();t.append($("<input>",{name:"data",type:"hidden",value:JSON.stringify(a,null,4)})),t.appendTo(document.body),t.submit(),$(t).remove()},S=function(e){return $("<div/>").text(e).html()},k=function(e,t){var a=t.standard,r=$("<div>").addClass("pharmit_searchdiv"),o=$('<button id="pharmitsearchbutton" name="subset">Search '+a[0].name+"</button>").appendTo(r).button(),s=$("<button>Select subset to search</button>").appendTo(r).button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}});s.tooltip().tooltip("disable"),o.val(a[0].subdir),r.buttonset();var l,d,p,c=$("<ul>").appendTo($("body")).addClass("pharmit_floatmenu"),u=[];for(l=0,n=a.length;l<n;l++)d=a[l],p=S(d.name),d.html&&(p=d.html),u[l]="<li value="+l+' class="pharmit_subsetmenu">'+p+"<br>",u[l]+='<span class="pharmit_subsetcnts">'+numeral(d.numConfs).format("0,0")+" conformers of "+numeral(d.numMols).format("0,0")+" molecules</span>",u[l]+='<span class="pharmit_subsettime">Updated: '+d.updated+"</span>",u[l]+="</li>","molport"==d.subdir&&(o.button("option","label","Search "+d.name),o.val(d.subdir));c.append(u),c.append($("<li> </li>"));var h=$('<li class="pharmit_contributed">Contributed Libraries</li>'),m=$("<ul>").appendTo(h),f=[],v=t["public"];for(l=0,n=v.length;l<n;l++){d=v[l],p=S(d.name);var b="";d.description&&(b=" title='"+S(d.description)+"' "),f[l]="<li value="+a.length+b+' class="pharmit_subsetmenu">'+p+"<br>",a.push(d),f[l]+='<span class="pharmit_subsetcnts">'+numeral(d.numConfs).format("0,0")+" conformers of "+numeral(d.numMols).format("0,0")+" molecules</span>",f[l]+='<span class="pharmit_subsettime">Created: '+d.updated+"</span>",f[l]+="</li>"}m.append(f),c.append(h),c.append($("<li> </li>")),$('<li class="pharmit_private">Access Private Library</li>').appendTo(c).click(function(){i.dialog("open")}),c.hide().menu().on("menuselect",function(e,t){var n=a[t.item.val()];o.button("option","label","Search "+n.name),o.val(n.subdir)}),o.click(g),s.click(function(){var e=c.show().position({my:"left top",at:"left buttom",of:this});return $(document).one("click",function(){e.hide()}),!1}),e.prepend(r)},P=$("<div>").appendTo(l).addClass("pharmit_leftclose"),M=$("<span>").addClass("ui-icon ui-icon-carat-1-w").appendTo(P);l.resizable({handles:"e",resize:function(e,t){o.setLeft(t.size.width)}}),l.disableSelection(),P.click(function(){if(P.hasClass("pharmit_leftisclosed")){P.removeClass("pharmit_leftisclosed"),M.removeClass("ui-icon-carat-1-e"),M.addClass("ui-icon-carat-1-w");var e=l.width();l.css("width","");var t=l.width();l.width(e),l.animate({width:t},{progress:function(){o.setLeft(l.width())}}),l.resizable("option","disabled",!1)}else l.animate({width:0},{progress:function(){o.setLeft(l.width())}}),P.addClass("pharmit_leftisclosed"),M.addClass("ui-icon-carat-1-e"),M.removeClass("ui-icon-carat-1-w"),l.resizable("option","disabled",!0)});var R=$("<div>").appendTo(l).addClass("pharmit_queryheader");$.post(Pharmit.server,{cmd:"getsubsets"},null,"json").done(function(e){k(R,e)}).fail(function(){k(R,{standard:[{name:"Error"}],"public":[]}),alert("Error contacting server.  Please inform "+Pharmit.email+" if this problem persists.")});var F=$("<div>").appendTo(R).addClass("pharmit_loaderdiv").addClass("pharmit_nowrap"),A=$("<button>Load Receptor...</button>").button(),z="Pharmacophore features can be provided as pharmacophore query formats (MOE, LigBuilder, LigandScout, Pharmer) or automatically extracted from ligand structures (sdf, pdf, mol2, xyz). If a receptor is loaded, only interacting features will be enabled.",D=$('<button title="'+z+'">Load Features...</button>').button();e.append(l);$('<input type="file">').appendTo(F).fileinput(A).change(function(){v(this,w)}),$('<input type="file">').appendTo(F).fileinput(D).change(function(){v(this,y)});l.detach();var N=$("<div>").appendTo(l).addClass("pharmit_querybody"),H=$("<div>").appendTo(N);p=$("<div>Pharmacophore</div>").appendTo(H).addClass("pharmit_heading"),d=$("<div>").appendTo(H),d.accordion({header:"> div > h3",animate:!0,active:!1,collapsible:!0,heightStyle:"content",beforeActivate:function(e,t){var a=null,n=d.children();$.each(n,function(e,t){t.feature.deselectFeature()}),t.newHeader.length>0&&(a=t.newHeader.parent(),a.get(0).feature.selectFeature())}}).sortable({axis:"y",handle:"h3",stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),$(this).accordion("refresh")}});var j=$("<div>").appendTo(H).addClass("pharmit_featurebuttons"),O=($("<button>Add</button>").appendTo(j).button({text:!0,icons:{secondary:"ui-icon-circle-plus"}}).click(function(){new Feature(o,d,t)}),$("<button>Sort</button>").appendTo(j).button({text:!0,icons:{secondary:"ui-icon ui-icon-carat-2-n-s"}}).click(T),$("<div>").appendTo(N));
$("<div>Shape</div>").appendTo(O).addClass("pharmit_heading");var L=$("<div>").appendTo(O).addClass("pharmit_shapemodediv"),E=$("<table>").appendTo(L).addClass("pharmit_shapemodetable"),q=$("<tr>").appendTo(E).addClass("pharmit_styleselectrow pharmit_shapeselectrow"),I="ShapeModeSelect";$('<label for="'+I+'">Mode:</label>').addClass("pharmit_stylelabel").appendTo($("<td>")).appendTo($("<td>").appendTo(q));var V=$("<td nowrap>").appendTo(q),B=$('<select name="'+I+'" id="'+I+'">').addClass("pharmit_styleselector").appendTo(V);$('<option value="filter">Filter Pharmacophore</option>').appendTo(B),$('<option value="search">Shape Search</option>').appendTo(B),B.val("filter"),B.selectmenu({width:"11em",appendTo:O,change:function(){},position:{my:"left top",at:"left bottom",collision:"flip"}}),B.selectmenu("widget").css("width","");var W=$("<div>").appendTo(O).addClass("pharmit_shapeconstraints"),J=($("<h3>Inclusive Shape<br></h3>").appendTo(W),$("<div>").addClass("pharmit_inclusiveshape").appendTo(W)),G=null,U=$("<div>").appendTo(J),X=$('<select name="inselect" id="inselect">').addClass("pharmit_shapeselector").appendTo(U);$('<option value="none">None</option>').appendTo(X),$('<option value="ligand">Ligand</option>').appendTo(X),$('<option value="points">Interaction Points</option>').appendTo(X),X.val("none"),X.selectmenu({width:"11em",appendTo:U,change:function(){},position:{my:"left top",at:"left bottom",collision:"flip"}});var K=$('<div id="none-indiv">').appendTo(J);$("<span>No inclusive shape will be used to filter pharmacophore matches.</span>").appendTo(K).addClass("pharmit_shapedesc pharmit_shapefiltertext"),$("<span>No inclusive shape will be used for shape screening.</span>").appendTo(K).addClass("pharmit_shapedesc pharmit_shapesearchtext");var Q=$('<div id="ligand-indiv">').appendTo(J);$("<span>At least one heavy atom in a pharmacophore aligned pose must fall within the inclusive shape.</span>").appendTo(Q).addClass("pharmit_shapedesc pharmit_shapefiltertext"),$("<span>The entirety of the inclusive shape must be contained within the aligned hit.</span>").appendTo(Q).addClass("pharmit_shapedesc pharmit_shapesearchtext");var Y=$("<table>").appendTo(Q),Z=$("<tr>").appendTo(Y);$("<td>").append('<label title="Depth in Angstroms to reduce surface of ligand inclusive shape by." value = "1" for="inltolerance">Tolerance:</label>').appendTo(Z),G=$("<td>").appendTo(Z).addClass("pharmit_shapecell"),$('<input id="inltolerance" name="inltolerance">').appendTo(G).spinner();var et=$('<div id="points-indiv">').appendTo(J);$("<span>At least one heavy atom center of a pharmacophore aligned pose must fall within <b>each</b> interaction point.</span>").appendTo(et).addClass("pharmit_shapedesc pharmit_shapefiltertext"),$("<span>The entirety of the interaction point shapes must be contained within the aligned hit.</span>").appendTo(et).addClass("pharmit_shapedesc pharmit_shapesearchtext");var tt=($("<table>").appendTo(et),$('<div class="pharmit_pointsbuttons">').appendTo(et)),at=($("<button>Add</button>").appendTo(tt).button({text:!0,icons:{secondary:"ui-icon-circle-plus"}}).click(function(){}),$("<h3>Exclusive Shape<br></h3>").appendTo(W),$("<div>").addClass("pharmit_exclusiveshape").appendTo(W)),nt=$("<div>").appendTo(at),it=$('<select name="exselect" id="exselect">').addClass("pharmit_shapeselector").appendTo(nt);$('<option value="none">None</option>').appendTo(it),$('<option value="receptor">Receptor</option>').appendTo(it),it.val("none"),it.selectmenu({width:"11em",appendTo:nt,change:function(){},position:{my:"left top",at:"left bottom",collision:"flip"}});var rt=$("<div>").appendTo(at).addClass("pharmit_shapedesc");rt.text("Hits that have heavy atom centers within the exclusive shape in their pharmacophore aligned pose will be filtered out.");var ot=$("<div>").appendTo(at).addClass("pharmit_shapedesc");ot.text("Aligned hits will not overlap any portion of the exclusive shape.");var st=$("<table>").appendTo(at),lt=$("<tr>").appendTo(st);$("<td>").append('<label title="Depth in Angstroms to reduce surface of receptor exclusive shape by." value = "1" for="extolerance">Tolerance:</label>').appendTo(lt),G=$("<td>").appendTo(lt).addClass("pharmit_shapecell"),$('<input id="extolerance" name="extolerance">').appendTo(G).spinner(),W.accordion({animate:!0,active:!1,collapsible:!0,heightStyle:"content"});var dt=$("<div>").appendTo(N);$("<div>Filters</div>").appendTo(dt).addClass("pharmit_heading");var pt=$("<div>").appendTo(dt),ct=$("<h3>Hit Reduction<br></h3>").appendTo(pt),ut=$("<div>").addClass("pharmit_hitreduction").appendTo(pt),ht=$("<table>").appendTo(ut),mt=function(){""!==$("#reduceorienttext").val()||""!==$("#reduceconfstext").val()||""!==$("#reducehitstext").val()?ct.addClass("pharmit_filtermodified"):ct.removeClass("pharmit_filtermodified")},ft=$("<tr>").addClass("pharmit_filterrow").appendTo(ht);$("<td>").append('<label title="Maximum number of orientations returned for each conformation" value="1" for="reduceorienttext">Max Hits per Conf:</label>').appendTo(ft),G=$("<td>").appendTo(ft),$('<input id="reduceorienttext" name="max-orient">').appendTo(G).spinner({min:0,stop:mt}).change(mt),ft=$("<tr>").addClass("pharmit_filterrow").appendTo(ht),$("<td>").append('<label title="Maximum number of conformations returned for each compound" value="1" for="reduceconfstext">Max Hits per Mol:</label>').appendTo(ft),G=$("<td>").appendTo(ft),$('<input id="reduceconfstext" name="reduceConfs">').appendTo(G).spinner({min:0,stop:mt}).change(mt),ft=$("<tr>").addClass("pharmit_filterrow").appendTo(ht),$("<td>").append('<label title="Maximum number of hits returned" value="1" for="reducehitstext">Max Total Hits:</label>').appendTo(ft),G=$("<td>").appendTo(ft),$('<input id="reducehitstext" name="max-hits">').appendTo(G).spinner({min:0,stop:mt}).change(mt);var gt=$("<h3>Hit Screening<br></h3>").appendTo(pt),vt=$("<div>").appendTo(pt).addClass("pharmit_hitscreening"),bt=$("<table>").appendTo(vt),yt=function(){var e=!0;$("[name]",vt).each(function(t,a){""!==a.value&&(e=!1)}),e?gt.removeClass("pharmit_filtermodified"):gt.addClass("pharmit_filtermodified")},wt=function(e,t,a,n){var i=$("<tr>").addClass("pharmit_filterrow").appendTo(bt),r=$("<td>").appendTo(i);$('<input name="min'+e+'">').appendTo(r).spinner({min:n,stop:yt}).change(yt),$("<td>").appendTo(i).append($('<label title="'+a+'" value="1" >&le;  '+t+" &le;</label>")),r=$("<td>").appendTo(i),$('<input name="max'+e+'">').appendTo(r).spinner({min:n,stop:yt}).change(yt)};wt("MolWeight","MolWeight","Minimum/maximum molecular weight (weights are approximate)",0),wt("rotbonds","RotBonds","Minimum/maximum number of rotatable bonds",0),wt("logp","LogP","Minimum/maximum partition coefficient as calculated by OpenBabel"),wt("psa","PSA","Minimum/maximum polar surface area as calculated by OpenBabel"),wt("aromatics","Aromatics","Minimum/maximum number of smallest aromatic rings",0),wt("hba","HBA","Minimum/maximum number of hydrogen bond acceptors",0),wt("hbd","HBD","Minimum/maximum number of hydrogen bond donors",0),pt.accordion({animate:!0,active:!1,collapsible:!0,heightStyle:"content"});var $t=$("<div>").appendTo(N);$("<div>Visualization</div>").appendTo($t).addClass("pharmit_heading");var Tt=$("<div>").appendTo($t).addClass("pharmit_vizdiv");o.appendViewerControls(Tt);var _t=$("<div>").appendTo(l).addClass("pharmit_queryfooter"),Ct=$("<div>").appendTo(_t).addClass("pharmit_bottomloaders").addClass("pharmit_nowrap");e.append(l);{var xt=$("<button>Load Session...</button>").button();$('<input type="file">').appendTo(Ct).fileinput(xt).change(function(){v(this,_)}),$("<button>Save Session...</button>").appendTo(Ct).button().click(x)}o.setLeft(l.width()),i=$('<div class="pharmit_private_dialog" title="Access Private Library">Enter your access code: </div>').appendTo(N),$('<input type="text" id="privateid" class="pharmit_privatetext">').appendTo(i),i.dialog({autoOpen:!1,height:125,width:400,modal:!0,buttons:{Submit:function(){$.post(Pharmit.server,{cmd:"getsubsets",subset:"Private/"+$("#privateid").val()},null,"json").done(function(e){if(e.error)alert(e.error);else{var t=$("#pharmitsearchbutton");t.button("option","label","Search "+e.name),t.val(e.subdir)}}).fail(function(){alert("Error contacting server.  Please inform "+Pharmit.email+" if this problem persists.")}),i.dialog("close")},Cancel:function(){i.dialog("close")}}})}var t={name:"Hydrophobic",x:0,y:0,z:0,radius:1,enabled:!0,vector_on:0,minsize:"",maxsize:"",svector:null,hasvec:!1},a=/@<TRIPOS>MOLECULE[^@]*?@<TRIPOS>ATOM\n(\s*\d+\s*(ACC|DON|CAT|ANI|HYD|AR).*)*\n@<TRIPOS>BOND\n/g,i=null,r=function(e,t){return-1!==e.indexOf(t,e.length-t.length)};return e}();var Pharmit=Pharmit||{};Pharmit.Results=function(){function e(e,t){var a=this.div=$("<div>").addClass("pharmit_results pharmit_overlay").appendTo(e),n=null,i=null;this.phquery=function(e){n.cancel(),n.query(e),this.show()},this.show=function(){a.show(),t.setRight(a.width())},this.close=function(){a.hide(),t.setRight(0)};var r=function(e){var t=null;return(t=e.match(/PubChem-?(\d+)/))?"https://pubchem.ncbi.nlm.nih.gov/compound/"+t[1]:(t=e.match(/MolPort-?(\S+)/))?"https://www.molport.com/shop/moleculelink/about-this-molecule/"+t[1].replace(/-/g,""):(t=e.match(/CHEMBL/))?"https://www.ebi.ac.uk/chembldb/index.php/compound/inspect/"+e:(t=e.match(/ChemDiv-?(\S+)/))?"http://chemistryondemand.com:8080/eShop/search_results.jsp?idnumber="+t[1]:null};this.mangleName=function(e){for(var t=e.split(" "),a="",n=0;n<t.length;n++){var i=t[n],o=r(i);a+=o?"<a target='_blank' href='"+o+"'>"+i+"</a><br>":i+"<br>"}var s='<span data-powertip="'+a+'">'+t[0]+"</span>";return s};var o=$("<div>").appendTo(a).addClass("pharmit_rightclose"),s=$("<span>").addClass("ui-icon ui-icon-carat-1-e").appendTo(o);a.resizable({handles:"w",resize:function(e,a){t.setRight(a.size.width),$(this).css("left","")}}),a.disableSelection(),o.click(function(){if(o.hasClass("pharmit_rightisclosed")){o.removeClass("pharmit_rightisclosed"),s.removeClass("ui-icon-carat-1-w"),s.addClass("ui-icon-carat-1-e");var e=a.width();a.css("width","");var n=a.width();a.width(e),a.animate({width:n},{progress:function(){t.setRight(a.width())}}),a.resizable("option","disabled",!1)}else a.animate({width:0},{progress:function(){t.setRight(a.width())}}),o.addClass("pharmit_rightisclosed"),s.addClass("ui-icon-carat-1-w"),s.removeClass("ui-icon-carat-1-e"),a.resizable("option","disabled",!0)}),i=new Pharmit.MinResults(this,t),n=new Pharmit.PhResults(this,t,i),a.hide(),a.is(":visible")&&t.setRight(a.width()),$(window).on("beforeunload",function(){Pharmit.inFormSubmit?Pharmit.inFormSubmit=!1:n.cancel()})}return e}(),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&"object"==typeof module?module.exports=e:e(jQuery)}(function(e,t){"use strict";function a(t,a,n,i){for(var r=[],o=0;o<t.length;o++){var s=t[o];if(s){var l=tinycolor(s),d=l.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";d+=tinycolor.equals(a,s)?" sp-thumb-active":"";var p=l.toString(i.preferredFormat||"rgb"),c=f?"background-color:"+l.toRgbString():"filter:"+l.toFilter();r.push('<span title="'+p+'" data-color="'+l.toRgbString()+'" class="'+d+'"><span class="sp-thumb-inner" style="'+c+';" /></span>')}else{var u="sp-clear-display";r.push(e("<div />").append(e('<span data-color="" style="background-color:transparent;" class="'+u+'"></span>').attr("title",i.noColorSelectedText)).html())}}return"<div class='sp-cf "+n+"'>"+r.join("")+"</div>"}function n(){for(var e=0;e<h.length;e++)h[e]&&h[e].hide()}function i(t,a){var n=e.extend({},u,t);return n.callbacks={move:d(n.move,a),change:d(n.change,a),show:d(n.show,a),hide:d(n.hide,a),beforeShow:d(n.beforeShow,a)},n}function r(r,s){function d(){if(W.showPaletteOnly&&(W.showPalette=!0),Ht.text(W.showPaletteOnly?W.togglePaletteMoreText:W.togglePaletteLessText),W.palette){ct=W.palette.slice(0),ut=e.isArray(ct[0])?ct:[ct],ht={};for(var t=0;t<ut.length;t++)for(var a=0;a<ut[t].length;a++){var n=tinycolor(ut[t][a]).toRgbString();ht[n]=!0}}$t.toggleClass("sp-flat",J),$t.toggleClass("sp-input-disabled",!W.showInput),$t.toggleClass("sp-alpha-enabled",W.showAlpha),$t.toggleClass("sp-clear-enabled",Xt),$t.toggleClass("sp-buttons-disabled",!W.showButtons),$t.toggleClass("sp-palette-buttons-disabled",!W.togglePaletteOnly),$t.toggleClass("sp-palette-disabled",!W.showPalette),$t.toggleClass("sp-palette-only",W.showPaletteOnly),$t.toggleClass("sp-initial-disabled",!W.showInitial),$t.addClass(W.className).addClass(W.containerClassName),L()}function u(){function t(t){return t.data&&t.data.ignore?(A(e(t.target).closest(".sp-thumb-el").data("color")),N()):(A(e(t.target).closest(".sp-thumb-el").data("color")),N(),O(!0),W.hideAfterPaletteSelect&&R()),!1}if(m&&$t.find("*:not(input)").attr("unselectable","on"),d(),Lt&&yt.after(Et).hide(),Xt||Dt.hide(),J)yt.after($t).hide();else{var a="parent"===W.appendTo?yt.parent():e(W.appendTo);1!==a.length&&(a=e("body")),a.append($t)}y(),qt.bind("click.spectrum touchstart.spectrum",function(t){wt||k(),t.stopPropagation(),e(t.target).is("input")||t.preventDefault()}),(yt.is(":disabled")||W.disabled===!0)&&V(),$t.click(l),Rt.change(S),Rt.bind("paste",function(){setTimeout(S,1)}),Rt.keydown(function(e){13==e.keyCode&&S()}),zt.text(W.cancelText),zt.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),F(),R()}),Dt.attr("title",W.clearText),Dt.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),Ut=!0,N(),J&&O(!0)}),Nt.text(W.chooseText),Nt.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),D()&&(O(!0),R())}),Ht.text(W.showPaletteOnly?W.togglePaletteMoreText:W.togglePaletteLessText),Ht.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),W.showPaletteOnly=!W.showPaletteOnly,W.showPaletteOnly||J||$t.css("left","-="+(Tt.outerWidth(!0)+5)),d()}),p(Pt,function(e,t,a){pt=e/it,Ut=!1,a.shiftKey&&(pt=Math.round(10*pt)/10),N()},C,x),p(xt,function(e,t){st=parseFloat(t/at),Ut=!1,W.showAlpha||(pt=1),N()},C,x),p(_t,function(e,t,a){if(a.shiftKey){if(!vt){var n=lt*Z,i=et-dt*et,r=Math.abs(e-n)>Math.abs(t-i);vt=r?"x":"y"}}else vt=null;var o=!vt||"x"===vt,s=!vt||"y"===vt;o&&(lt=parseFloat(e/Z)),s&&(dt=parseFloat((et-t)/et)),Ut=!1,W.showAlpha||(pt=1),N()},C,x),Vt?(A(Vt),H(),Jt=Wt||tinycolor(Vt).format,w(Vt)):H(),J&&P();var n=m?"mousedown.spectrum":"click.spectrum touchstart.spectrum";Ft.delegate(".sp-thumb-el",n,t),At.delegate(".sp-thumb-el:nth-child(1)",n,{ignore:!0},t)}function y(){if(U&&window.localStorage){try{var t=window.localStorage[U].split(",#");t.length>1&&(delete window.localStorage[U],e.each(t,function(e,t){w(t)}))}catch(a){}try{mt=window.localStorage[U].split(";")}catch(a){}}}function w(t){if(G){var a=tinycolor(t).toRgbString();if(!ht[a]&&-1===e.inArray(a,mt))for(mt.push(a);mt.length>ft;)mt.shift();if(U&&window.localStorage)try{window.localStorage[U]=mt.join(";")}catch(n){}}}function $(){var e=[];if(W.showPalette)for(var t=0;t<mt.length;t++){var a=tinycolor(mt[t]).toRgbString();ht[a]||e.push(mt[t])}return e.reverse().slice(0,W.maxSelectionSize)}function T(){var t=z(),n=e.map(ut,function(e,n){return a(e,t,"sp-palette-row sp-palette-row-"+n,W)});y(),mt&&n.push(a($(),t,"sp-palette-row sp-palette-row-selection",W)),Ft.html(n.join(""))}function _(){if(W.showInitial){var e=Bt,t=z();At.html(a([e,t],t,"sp-palette-row-initial",W))}}function C(){(0>=et||0>=Z||0>=at)&&L(),$t.addClass(gt),vt=null,yt.trigger("dragstart.spectrum",[z()])}function x(){$t.removeClass(gt),yt.trigger("dragstop.spectrum",[z()])}function S(){var e=Rt.val();if(null!==e&&""!==e||!Xt){var t=tinycolor(e);t.isValid()?(A(t),O(!0)):Rt.addClass("sp-validation-error")}else A(null),O(!0)}function k(){Y?R():P()}function P(){var t=e.Event("beforeShow.spectrum");return Y?void L():(yt.trigger(t,[z()]),void(K.beforeShow(z())===!1||t.isDefaultPrevented()||(n(),Y=!0,e(bt).bind("click.spectrum",M),e(window).bind("resize.spectrum",Q),Et.addClass("sp-active"),$t.removeClass("sp-hidden"),L(),H(),Bt=z(),_(),K.show(Bt),yt.trigger("show.spectrum",[Bt]))))}function M(e){2!=e.button&&(Gt?O(!0):F(),R())}function R(){Y&&!J&&(Y=!1,e(bt).unbind("click.spectrum",M),e(window).unbind("resize.spectrum",Q),Et.removeClass("sp-active"),$t.addClass("sp-hidden"),K.hide(z()),yt.trigger("hide.spectrum",[z()]))}function F(){A(Bt,!0)}function A(e,t){if(tinycolor.equals(e,z()))return void H();var a,n;!e&&Xt?Ut=!0:(Ut=!1,a=tinycolor(e),n=a.toHsv(),st=n.h%360/360,lt=n.s,dt=n.v,pt=n.a),H(),a&&a.isValid()&&!t&&(Jt=Wt||a.getFormat())}function z(e){return e=e||{},Xt&&Ut?null:tinycolor.fromRatio({h:st,s:lt,v:dt,a:Math.round(100*pt)/100},{format:e.format||Jt})}function D(){return!Rt.hasClass("sp-validation-error")}function N(){H(),K.move(z()),yt.trigger("move.spectrum",[z()])}function H(){Rt.removeClass("sp-validation-error"),j();var e=tinycolor.fromRatio({h:st,s:1,v:1});_t.css("background-color",e.toHexString());var t=Jt;1>pt&&(0!==pt||"name"!==t)&&("hex"===t||"hex3"===t||"hex6"===t||"name"===t)&&(t="rgb");var a=z({format:t}),n="";if(It.removeClass("sp-clear-display"),It.css("background-color","transparent"),!a&&Xt)It.addClass("sp-clear-display");else{var i=a.toHexString(),r=a.toRgbString();if(f||1===a.alpha?It.css("background-color",r):(It.css("background-color","transparent"),It.css("filter",a.toFilter())),W.showAlpha){var o=a.toRgb();o.a=0;var s=tinycolor(o).toRgbString(),l="linear-gradient(left, "+s+", "+i+")";m?kt.css("filter",tinycolor(s).toFilter({gradientType:1},i)):(kt.css("background","-webkit-"+l),kt.css("background","-moz-"+l),kt.css("background","-ms-"+l),kt.css("background","linear-gradient(to right, "+s+", "+i+")"))}n=a.toString(t)}W.showInput&&Rt.val(n),W.showPalette&&T(),_()}function j(){var e=lt,t=dt;if(Xt&&Ut)Mt.hide(),St.hide(),Ct.hide();else{Mt.show(),St.show(),Ct.show();var a=e*Z,n=et-t*et;a=Math.max(-tt,Math.min(Z-tt,a-tt)),n=Math.max(-tt,Math.min(et-tt,n-tt)),Ct.css({top:n+"px",left:a+"px"});var i=pt*it;Mt.css({left:i-rt/2+"px"});var r=st*at;St.css({top:r-ot+"px"})}}function O(e){var t=z(),a="",n=!0;t&&(a=t.toString(Jt),w(t)),jt&&yt.val(a),e&&n&&(K.change(t),yt.trigger("change",[t]))}function L(){Z=_t.width(),et=_t.height(),tt=Ct.height(),nt=xt.width(),at=xt.height(),ot=St.height(),it=Pt.width(),rt=Mt.width(),J||($t.css("position","absolute"),$t.offset(W.offset?W.offset:o($t,qt))),j(),W.showPalette&&T(),yt.trigger("reflow.spectrum")}function E(){yt.show(),qt.unbind("click.spectrum touchstart.spectrum"),$t.remove(),Et.remove(),h[Kt.id]=null}function q(a,n){return a===t?e.extend({},W):n===t?W[a]:(W[a]=n,void d())}function I(){wt=!1,yt.attr("disabled",!1),qt.removeClass("sp-disabled")}function V(){R(),wt=!0,yt.attr("disabled",!0),qt.addClass("sp-disabled")}function B(e){W.offset=e,L()}var W=i(s,r),J=W.flat,G=W.showSelectionPalette,U=W.localStorageKey,X=W.theme,K=W.callbacks,Q=c(L,10),Y=!1,Z=0,et=0,tt=0,at=0,nt=0,it=0,rt=0,ot=0,st=0,lt=0,dt=0,pt=1,ct=[],ut=[],ht={},mt=W.selectionPalette.slice(0),ft=W.maxSelectionSize,gt="sp-dragging",vt=null,bt=r.ownerDocument,yt=(bt.body,e(r)),wt=!1,$t=e(b,bt).addClass(X),Tt=$t.find(".sp-picker-container"),_t=$t.find(".sp-color"),Ct=$t.find(".sp-dragger"),xt=$t.find(".sp-hue"),St=$t.find(".sp-slider"),kt=$t.find(".sp-alpha-inner"),Pt=$t.find(".sp-alpha"),Mt=$t.find(".sp-alpha-handle"),Rt=$t.find(".sp-input"),Ft=$t.find(".sp-palette"),At=$t.find(".sp-initial"),zt=$t.find(".sp-cancel"),Dt=$t.find(".sp-clear"),Nt=$t.find(".sp-choose"),Ht=$t.find(".sp-palette-toggle"),jt=yt.is("input"),Ot=jt&&g&&"color"===yt.attr("type"),Lt=jt&&!J,Et=Lt?e(v).addClass(X).addClass(W.className).addClass(W.replacerClassName):e([]),qt=Lt?Et:yt,It=Et.find(".sp-preview-inner"),Vt=W.color||jt&&yt.val(),Bt=!1,Wt=W.preferredFormat,Jt=Wt,Gt=!W.showButtons||W.clickoutFiresChange,Ut=!Vt,Xt=W.allowEmpty&&!Ot;u();var Kt={show:P,hide:R,toggle:k,reflow:L,option:q,enable:I,disable:V,offset:B,set:function(e){A(e),O()},get:z,destroy:E,container:$t};return Kt.id=h.push(Kt)-1,Kt}function o(t,a){var n=0,i=t.outerWidth(),r=t.outerHeight(),o=a.outerHeight(),s=t[0].ownerDocument,l=s.documentElement,d=l.clientWidth+e(s).scrollLeft(),p=l.clientHeight+e(s).scrollTop(),c=a.offset();return c.top+=o,c.left-=Math.min(c.left,c.left+i>d&&d>i?Math.abs(c.left+i-d):0),c.top-=Math.min(c.top,c.top+r>p&&p>r?Math.abs(r+o-n):n),c}function s(){}function l(e){e.stopPropagation()}function d(e,t){var a=Array.prototype.slice,n=a.call(arguments,2);return function(){return e.apply(t,n.concat(a.call(arguments)))}}function p(t,a,n,i){function r(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function o(e){if(p){if(m&&d.documentMode<9&&!e.button)return l();var n=e.originalEvent&&e.originalEvent.touches,i=n?n[0].pageX:e.pageX,o=n?n[0].pageY:e.pageY,s=Math.max(0,Math.min(i-c.left,h)),g=Math.max(0,Math.min(o-c.top,u));f&&r(e),a.apply(t,[s,g,e])}}function s(a){var i=a.which?3==a.which:2==a.button;i||p||n.apply(t,arguments)!==!1&&(p=!0,u=e(t).height(),h=e(t).width(),c=e(t).offset(),e(d).bind(g),e(d.body).addClass("sp-dragging"),f||o(a),r(a))}function l(){p&&(e(d).unbind(g),e(d.body).removeClass("sp-dragging"),i.apply(t,arguments)),p=!1}a=a||function(){},n=n||function(){},i=i||function(){};var d=document,p=!1,c={},u=0,h=0,f="ontouchstart"in window,g={};g.selectstart=r,g.ragstart=r,g["touchmove mousemove"]=o,g["touchend mouseup"]=l,e(t).bind("touchstart mousedown",s)}function c(e,t,a){var n;return function(){var i=this,r=arguments,o=function(){n=null,e.apply(i,r)};a&&clearTimeout(n),(a||!n)&&(n=setTimeout(o,t))}}var u={beforeShow:s,move:s,change:s,show:s,hide:s,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},h=[],m=!!/msie/i.exec(window.navigator.userAgent),f=function(){function e(e,t){return!!~(""+e).indexOf(t)}var t=document.createElement("div"),a=t.style;return a.cssText="background-color:rgba(0,0,0,.5)",e(a.backgroundColor,"rgba")||e(a.backgroundColor,"hsla")}(),g=function(){var t=e("<input type='color' value='!' />")[0];return"color"===t.type&&"!"!==t.value}(),v=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),b=function(){var e="";if(m)for(var t=1;6>=t;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),y="spectrum.id";e.fn.spectrum=function(t){if("string"==typeof t){var a=this,n=Array.prototype.slice.call(arguments,1);return this.each(function(){var i=h[e(this).data(y)];if(i){var r=i[t];if(!r)throw new Error("Spectrum: no such method: '"+t+"'");"get"==t?a=i.get():"container"==t?a=i.container:"option"==t?a=i.option.apply(i,n):"destroy"==t?(i.destroy(),e(this).removeData(y)):r.apply(i,n)}}),a}return this.spectrum("destroy").each(function(){var a=e.extend({},t,e(this).data()),n=r(this,a);e(this).data(y,n.id)})},e.fn.spectrum.load=!0,e.fn.spectrum.loadOpts={},e.fn.spectrum.draggable=p,e.fn.spectrum.defaults=u,e.spectrum={},e.spectrum.localization={},e.spectrum.palettes={},e.fn.spectrum.processNativeColorInputs=function(){g||e("input[type=color]").spectrum({preferredFormat:"hex6"})},function(){function e(e){var a={r:0,g:0,b:0},i=1,o=!1,s=!1;return"string"==typeof e&&(e=A(e)),"object"==typeof e&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(a=t(e.r,e.g,e.b),o=!0,s="%"===String(e.r).substr(-1)?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=M(e.s),e.v=M(e.v),a=r(e.h,e.s,e.v),o=!0,s="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=M(e.s),e.l=M(e.l),a=n(e.h,e.s,e.l),o=!0,s="hsl"),e.hasOwnProperty("a")&&(i=e.a)),i=T(i),{ok:o,format:e.format||s,r:O(255,L(a.r,0)),g:O(255,L(a.g,0)),b:O(255,L(a.b,0)),a:i}}function t(e,t,a){return{r:255*_(e,255),g:255*_(t,255),b:255*_(a,255)}}function a(e,t,a){e=_(e,255),t=_(t,255),a=_(a,255);var n,i,r=L(e,t,a),o=O(e,t,a),s=(r+o)/2;if(r==o)n=i=0;else{var l=r-o;switch(i=s>.5?l/(2-r-o):l/(r+o),r){case e:n=(t-a)/l+(a>t?6:0);break;case t:n=(a-e)/l+2;break;case a:n=(e-t)/l+4}n/=6}return{h:n,s:i,l:s}}function n(e,t,a){function n(e,t,a){return 0>a&&(a+=1),a>1&&(a-=1),1/6>a?e+6*(t-e)*a:.5>a?t:2/3>a?e+(t-e)*(2/3-a)*6:e}var i,r,o;if(e=_(e,360),t=_(t,100),a=_(a,100),0===t)i=r=o=a;else{var s=.5>a?a*(1+t):a+t-a*t,l=2*a-s;i=n(l,s,e+1/3),r=n(l,s,e),o=n(l,s,e-1/3)}return{r:255*i,g:255*r,b:255*o}}function i(e,t,a){e=_(e,255),t=_(t,255),a=_(a,255);var n,i,r=L(e,t,a),o=O(e,t,a),s=r,l=r-o;if(i=0===r?0:l/r,r==o)n=0;else{switch(r){case e:n=(t-a)/l+(a>t?6:0);break;case t:n=(a-e)/l+2;break;case a:n=(e-t)/l+4}n/=6}return{h:n,s:i,v:s}}function r(e,t,a){e=6*_(e,360),t=_(t,100),a=_(a,100);var n=H.floor(e),i=e-n,r=a*(1-t),o=a*(1-i*t),s=a*(1-(1-i)*t),l=n%6,d=[a,o,r,r,s,a][l],p=[s,a,a,o,r,r][l],c=[r,r,s,a,a,o][l];return{r:255*d,g:255*p,b:255*c}}function o(e,t,a,n){var i=[P(j(e).toString(16)),P(j(t).toString(16)),P(j(a).toString(16))];return n&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function s(e,t,a,n){var i=[P(R(n)),P(j(e).toString(16)),P(j(t).toString(16)),P(j(a).toString(16))];return i.join("")}function l(e,t){t=0===t?0:t||10;var a=q(e).toHsl();return a.s-=t/100,a.s=C(a.s),q(a)}function d(e,t){t=0===t?0:t||10;var a=q(e).toHsl();return a.s+=t/100,a.s=C(a.s),q(a)}function p(e){return q(e).desaturate(100)}function c(e,t){t=0===t?0:t||10;var a=q(e).toHsl();return a.l+=t/100,a.l=C(a.l),q(a)}function u(e,t){t=0===t?0:t||10;var a=q(e).toRgb();return a.r=L(0,O(255,a.r-j(255*-(t/100)))),a.g=L(0,O(255,a.g-j(255*-(t/100)))),a.b=L(0,O(255,a.b-j(255*-(t/100)))),q(a)}function h(e,t){t=0===t?0:t||10;var a=q(e).toHsl();return a.l-=t/100,a.l=C(a.l),q(a)}function m(e,t){var a=q(e).toHsl(),n=(j(a.h)+t)%360;return a.h=0>n?360+n:n,q(a)}function f(e){var t=q(e).toHsl();return t.h=(t.h+180)%360,q(t)}function g(e){var t=q(e).toHsl(),a=t.h;return[q(e),q({h:(a+120)%360,s:t.s,l:t.l}),q({h:(a+240)%360,s:t.s,l:t.l})]}function v(e){var t=q(e).toHsl(),a=t.h;return[q(e),q({h:(a+90)%360,s:t.s,l:t.l}),q({h:(a+180)%360,s:t.s,l:t.l}),q({h:(a+270)%360,s:t.s,l:t.l})]}function b(e){var t=q(e).toHsl(),a=t.h;return[q(e),q({h:(a+72)%360,s:t.s,l:t.l}),q({h:(a+216)%360,s:t.s,l:t.l})]}function y(e,t,a){t=t||6,a=a||30;var n=q(e).toHsl(),i=360/a,r=[q(e)];for(n.h=(n.h-(i*t>>1)+720)%360;--t;)n.h=(n.h+i)%360,r.push(q(n));return r}function w(e,t){t=t||6;for(var a=q(e).toHsv(),n=a.h,i=a.s,r=a.v,o=[],s=1/t;t--;)o.push(q({h:n,s:i,v:r})),r=(r+s)%1;return o}function $(e){var t={};for(var a in e)e.hasOwnProperty(a)&&(t[e[a]]=a);return t}function T(e){return e=parseFloat(e),(isNaN(e)||0>e||e>1)&&(e=1),e}function _(e,t){S(e)&&(e="100%");var a=k(e);return e=O(t,L(0,parseFloat(e))),a&&(e=parseInt(e*t,10)/100),H.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function C(e){return O(1,L(0,e))}function x(e){return parseInt(e,16)}function S(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)}function k(e){return"string"==typeof e&&-1!=e.indexOf("%")}function P(e){return 1==e.length?"0"+e:""+e}function M(e){return 1>=e&&(e=100*e+"%"),e}function R(e){return Math.round(255*parseFloat(e)).toString(16)}function F(e){return x(e)/255}function A(e){e=e.replace(z,"").replace(D,"").toLowerCase();var t=!1;if(I[e])e=I[e],t=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};var a;return(a=B.rgb.exec(e))?{r:a[1],g:a[2],b:a[3]}:(a=B.rgba.exec(e))?{r:a[1],g:a[2],b:a[3],a:a[4]}:(a=B.hsl.exec(e))?{h:a[1],s:a[2],l:a[3]}:(a=B.hsla.exec(e))?{h:a[1],s:a[2],l:a[3],a:a[4]}:(a=B.hsv.exec(e))?{h:a[1],s:a[2],v:a[3]}:(a=B.hsva.exec(e))?{h:a[1],s:a[2],v:a[3],a:a[4]}:(a=B.hex8.exec(e))?{a:F(a[1]),r:x(a[2]),g:x(a[3]),b:x(a[4]),format:t?"name":"hex8"}:(a=B.hex6.exec(e))?{r:x(a[1]),g:x(a[2]),b:x(a[3]),format:t?"name":"hex"}:(a=B.hex3.exec(e))?{r:x(a[1]+""+a[1]),g:x(a[2]+""+a[2]),b:x(a[3]+""+a[3]),format:t?"name":"hex"}:!1}var z=/^[\s,#]+/,D=/\s+$/,N=0,H=Math,j=H.round,O=H.min,L=H.max,E=H.random,q=function W(t,a){if(t=t?t:"",a=a||{},t instanceof W)return t;if(!(this instanceof W))return new W(t,a);var n=e(t);this._originalInput=t,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=j(100*this._a)/100,this._format=a.format||n.format,this._gradientType=a.gradientType,this._r<1&&(this._r=j(this._r)),this._g<1&&(this._g=j(this._g)),this._b<1&&(this._b=j(this._b)),this._ok=n.ok,this._tc_id=N++};q.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},setAlpha:function(e){return this._a=T(e),this._roundA=j(100*this._a)/100,this},toHsv:function(){var e=i(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=i(this._r,this._g,this._b),t=j(360*e.h),a=j(100*e.s),n=j(100*e.v);return 1==this._a?"hsv("+t+", "+a+"%, "+n+"%)":"hsva("+t+", "+a+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var e=a(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=a(this._r,this._g,this._b),t=j(360*e.h),n=j(100*e.s),i=j(100*e.l);return 1==this._a?"hsl("+t+", "+n+"%, "+i+"%)":"hsla("+t+", "+n+"%, "+i+"%, "+this._roundA+")"},toHex:function(e){return o(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return s(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:j(this._r),g:j(this._g),b:j(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+j(this._r)+", "+j(this._g)+", "+j(this._b)+")":"rgba("+j(this._r)+", "+j(this._g)+", "+j(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:j(100*_(this._r,255))+"%",g:j(100*_(this._g,255))+"%",b:j(100*_(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+j(100*_(this._r,255))+"%, "+j(100*_(this._g,255))+"%, "+j(100*_(this._b,255))+"%)":"rgba("+j(100*_(this._r,255))+"%, "+j(100*_(this._g,255))+"%, "+j(100*_(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":this._a<1?!1:V[o(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+s(this._r,this._g,this._b,this._a),a=t,n=this._gradientType?"GradientType = 1, ":"";
if(e){var i=q(e);a=i.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+t+",endColorstr="+a+")"},toString:function(e){var t=!!e;e=e||this._format;var a=!1,n=this._a<1&&this._a>=0,i=!t&&n&&("hex"===e||"hex6"===e||"hex3"===e||"name"===e);return i?"name"===e&&0===this._a?this.toName():this.toRgbString():("rgb"===e&&(a=this.toRgbString()),"prgb"===e&&(a=this.toPercentageRgbString()),("hex"===e||"hex6"===e)&&(a=this.toHexString()),"hex3"===e&&(a=this.toHexString(!0)),"hex8"===e&&(a=this.toHex8String()),"name"===e&&(a=this.toName()),"hsl"===e&&(a=this.toHslString()),"hsv"===e&&(a=this.toHsvString()),a||this.toHexString())},_applyModification:function(e,t){var a=e.apply(null,[this].concat([].slice.call(t)));return this._r=a._r,this._g=a._g,this._b=a._b,this.setAlpha(a._a),this},lighten:function(){return this._applyModification(c,arguments)},brighten:function(){return this._applyModification(u,arguments)},darken:function(){return this._applyModification(h,arguments)},desaturate:function(){return this._applyModification(l,arguments)},saturate:function(){return this._applyModification(d,arguments)},greyscale:function(){return this._applyModification(p,arguments)},spin:function(){return this._applyModification(m,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(y,arguments)},complement:function(){return this._applyCombination(f,arguments)},monochromatic:function(){return this._applyCombination(w,arguments)},splitcomplement:function(){return this._applyCombination(b,arguments)},triad:function(){return this._applyCombination(g,arguments)},tetrad:function(){return this._applyCombination(v,arguments)}},q.fromRatio=function(e,t){if("object"==typeof e){var a={};for(var n in e)e.hasOwnProperty(n)&&(a[n]="a"===n?e[n]:M(e[n]));e=a}return q(e,t)},q.equals=function(e,t){return e&&t?q(e).toRgbString()==q(t).toRgbString():!1},q.random=function(){return q.fromRatio({r:E(),g:E(),b:E()})},q.mix=function(e,t,a){a=0===a?0:a||50;var n,i=q(e).toRgb(),r=q(t).toRgb(),o=a/100,s=2*o-1,l=r.a-i.a;n=s*l==-1?s:(s+l)/(1+s*l),n=(n+1)/2;var d=1-n,p={r:r.r*n+i.r*d,g:r.g*n+i.g*d,b:r.b*n+i.b*d,a:r.a*o+i.a*(1-o)};return q(p)},q.readability=function(e,t){var a=q(e),n=q(t),i=a.toRgb(),r=n.toRgb(),o=a.getBrightness(),s=n.getBrightness(),l=Math.max(i.r,r.r)-Math.min(i.r,r.r)+Math.max(i.g,r.g)-Math.min(i.g,r.g)+Math.max(i.b,r.b)-Math.min(i.b,r.b);return{brightness:Math.abs(o-s),color:l}},q.isReadable=function(e,t){var a=q.readability(e,t);return a.brightness>125&&a.color>500},q.mostReadable=function(e,t){for(var a=null,n=0,i=!1,r=0;r<t.length;r++){var o=q.readability(e,t[r]),s=o.brightness>125&&o.color>500,l=3*(o.brightness/125)+o.color/500;(s&&!i||s&&i&&l>n||!s&&!i&&l>n)&&(i=s,n=l,a=q(t[r]))}return a};var I=q.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},V=q.hexNames=$(I),B=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",a="(?:"+t+")|(?:"+e+")",n="[\\s|\\(]+("+a+")[,|\\s]+("+a+")[,|\\s]+("+a+")\\s*\\)?",i="[\\s|\\(]+("+a+")[,|\\s]+("+a+")[,|\\s]+("+a+")[,|\\s]+("+a+")\\s*\\)?";return{rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+i),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();window.tinycolor=q}(),e(function(){e.fn.spectrum.load&&e.fn.spectrum.processNativeColorInputs()})});var Pharmit=Pharmit||{};Pharmit.Viewer=function(){"use strict";function e(e){var t=($3Dmol.elementColors,{left:0,right:0}),a={Aromatic:"purple",HydrogenDonor:"0xf0f0f0",HydrogenAcceptor:"orange",Hydrophobic:"green",NegativeIon:"red",PositiveIon:"blue",ExclusionSphere:"grey"},n={Ligand:{model:null,defaultColor:"#C8C8C8",colorscheme:$.extend({},$3Dmol.elementColors.defaultColors),selectedstyle:"stick",styles:{stick:{name:"Stick",style:{stick:{radius:.15}},nonbond:{sphere:{radius:.15}}},wire:{name:"Wire",style:{line:{linewidth:2}},nonbond:{sphere:{radius:.05}}},sphere:{name:"Sphere",style:{sphere:{}},nonbond:{sphere:{}}},none:{name:"None",style:{},nonbond:{}}}},Receptor:{model:null,defaultColor:"#C8C8C8",colorscheme:$.extend({},$3Dmol.elementColors.defaultColors),selectedstyle:"cartoonwire",styles:{stick:{name:"Stick",style:{stick:{radius:.1}},nonbond:{sphere:{radius:.1}}},wire:{name:"Wire",style:{line:{linewidth:3}},nonbond:{sphere:{radius:.05}}},sphere:{name:"Sphere",style:{sphere:{}},nonbond:{sphere:{}}},cartoon:{name:"Cartoon",style:{cartoon:{}},nonbond:{sphere:{radius:.1}}},cartoonwire:{name:"Cartoon+Wire",style:{cartoon:{},line:{linewidth:3}},nonbond:{sphere:{radius:.2}}},none:{name:"None",style:{},nonbond:{}}}},Results:{model:null,defaultColor:"gray",colorscheme:$.extend({},$3Dmol.elementColors.defaultColors),selectedstyle:"stick",styles:{stick:{name:"Stick",style:{stick:{radius:.25}},nonbond:{sphere:{radius:.25}}},wire:{name:"Wire",style:{line:{linewidth:4}},nonbond:{sphere:{radius:.1}}},sphere:{name:"Sphere",style:{sphere:{}},nonbond:{sphere:{}}},none:{name:"None",style:{},nonbond:{}}}}},i=null,r={map:{prop:"partialCharge",scheme:new $3Dmol.Gradient.RWB(-.8,.8)},opacity:.8},o=null,s=[],l=function(e){if(!e)return"";var t=e.split(".");return t.length<=1?"":t.pop()},d=function(e){var t=n[e],a=t.selectedStyle,i=t.styles[a],r=i.style,s=i.nonbond,l=t.model;l&&(l.setStyle({},r),l.setStyle({bonds:0},s)),o.render()},p=function(e,t){var a=n[e],i=$("<tr>").appendTo(t).addClass("pharmit_styleselectrow"),r=e+"MolStyleSelect";$('<label for="'+r+'">'+e+":</label>").appendTo(i).addClass("pharmit_stylelabel").appendTo($("<td>").appendTo(i));var o=$("<td nowrap>").appendTo(i),s=$('<select name="'+r+'" id="'+r+'">').appendTo(o).addClass("pharmit_styleselector");$.each(a.styles,function(e,t){$('<option value="'+e+'">'+t.name+"</option>").appendTo(s)}),s.val(a.selectedstyle),s.selectmenu({width:"11em",appendTo:t,change:function(){s.change()},position:{my:"left top",at:"left bottom",collision:"flip"}}),s.selectmenu("widget").css("width","");var l=a.colorscheme;$.each(a.styles,function(e,t){$.each(t.style,function(e,t){t.colorscheme=l})}),s.change(function(){a.selectedStyle=this.value,d(e)});var p=$('<input name="'+r+'color">').appendTo($("<td>").appendTo(i));p.val(a.defaultColor),p.change(function(){var t=this.value;p.spectrum("set",t);var n=parseInt(p.spectrum("get").toHex(),16);a.colorscheme.C=n,d(e)}),p.spectrum({showPalette:!0,preferredFormat:"hex",replacerClassName:"ui-state-default ui-corner-all",showPaletteOnly:!0,clickoutFiresChange:!0,palette:["#C8C8C8","gray","white","green","cyan","magenta","yellow","orange","purple","blue"],change:function(){p.change()}}),s.change(),p.change(),s.selectmenu("refresh")};this.appendViewerControls=function(e){var t=$("<table>").appendTo(e);p("Ligand",t,null),p("Results",t,null),p("Receptor",t,null);var a=$("<div>").addClass("pharmit_surfacetransparencydiv").appendTo(e);$('<label for="surfaceopacity">Receptor Surface Opacity:</label>').appendTo(a);var n=$("<div>").addClass("pharmit_surfacetransparencyslider").appendTo(a),s=$('<input type="hidden" name="surfaceopacity">').appendTo(a),l=.8;s.val(l);var d=$('<div id="surfaceopacity">').appendTo(n).slider({animate:"fast",step:.05,min:0,max:1,value:l,change:function(e,t){s.val(t.value).change()}});s.change(function(){var e=s.val();r.opacity=e,null!==i&&o.setSurfaceMaterialStyle(i,r),d.slider("value")!=e&&d.slider("value",e),o.render()});var c=$("<div>").addClass("pharmit_backgroundcolordiv").appendTo(e);$('<label for="backgroundcolor">Background Color:</label>').appendTo(c);var u=$('<div id="backgroundcolor">').appendTo(c);$('<input type="radio" id="whiteBackground" name="backgroundcolor"><label for="whiteBackground">White</label>').appendTo(u).change(function(){$(this).prop("checked")&&o.setBackgroundColor("white"),u.buttonset("refresh")}).prop("checked",!0),$('<input type="radio" id="blackBackground" name="backgroundcolor"><label for="blackBackground">Black</label>').appendTo(u).change(function(){$(this).prop("checked")&&o.setBackgroundColor("black"),u.buttonset("refresh")}),u.buttonset()};this.setReceptor=function(e,t){var a=n.Receptor.model;if(a&&o.removeModel(a),a=null,null!==i&&o.removeSurface(i),i=null,e){var s=l(t);a=o.addModel(e,s),n.Receptor.model=a,d("Receptor"),o.mapAtomProperties($3Dmol.applyPartialCharges,{model:a}),i=o.addSurface($3Dmol.SurfaceType.VDW,r,{model:a,bonds:0,invert:!0}),o.zoomTo({})}else o.render()},this.setLigand=function(e,t){var a=n.Ligand.model;if(a&&o.removeModel(a),a=null,e){var i=l(t);a=o.addModel(e,i),n.Ligand.model=a,d("Ligand"),o.zoomTo({model:a})}else o.render()},this.setResult=function(e){var t=n.Results.model;t&&o.removeModel(t),e?(t=o.addModel(e,"sdf"),n.Results.model=t,d("Results"),o.zoomTo({model:t})):o.render()},this.setView=function(e){e?o.setView(e):o.zoomTo()},this.getView=function(){return o.getView()},this.addFeature=function(e,t){var n={center:{x:e.x,y:e.y,z:e.z},radius:e.radius,color:a[e.name],wireframe:!0,linewidth:1.5,clickable:!0,callback:t},i={sphere:null,arrows:[],label:null};if(i.sphere=o.addSphere(n),e.selected&&i.sphere.updateStyle({wireframe:!1}),e.hasvec&&e.vector_on&&e.svector){var r=new $3Dmol.Vector3(e.svector.x,e.svector.y,e.svector.z),l=e.radius+1,d=(l-.5)/l;r=r.normalize();var p=r.clone().multiplyScalar(e.radius).add(e),c=r.clone().multiplyScalar(l).add(e),u={start:p,end:c,radius:.075,radiusRatio:2,mid:d,wireframe:!e.selected,color:a[e.name]};i.arrows.push(o.addArrow(u)),"Aromatic"==e.name&&(p=r.clone().multiplyScalar(-e.radius).add(e),c=r.clone().multiplyScalar(-l).add(e),u.start=p,u.end=c,i.arrows.push(o.addArrow(u)))}if("Hydrophobic"==e.name){var h=e.minsize+":"+e.maxsize;if(":"!=h){var m={position:{x:e.x,y:e.y,z:e.z},showBackground:!0,fontColor:"black",backgroundColor:a[e.name],backgroundOpacity:.5,alignment:$3Dmol.SpriteAlignment.center};i.label=o.addLabel(h,m)}}return o.render(),s.push(i),s.length-1},this.selectFeature=function(e){var t=s[e];t&&t.sphere&&(t.sphere.updateStyle({wireframe:!1}),$.each(t.arrows,function(e,t){t.updateStyle({wireframe:!1})}),o.render())},this.unselectFeature=function(e){var t=s[e];t&&t.sphere&&(t.sphere.updateStyle({wireframe:!0}),$.each(t.arrows,function(e,t){t.updateStyle({wireframe:!0})}),o.render())},this.removeFeature=function(e){var t=s[e];for(t&&(t.sphere&&o.removeShape(t.sphere),$.each(t.arrows,function(e,t){o.removeShape(t)}),t.label&&o.removeLabel(t.label),o.render()),delete s[e];s.length>0&&"undefined"==typeof s[s.length-1];)s.pop()},this.setLeft=function(e){var a=e-t.left;t.left=e,o.translate(a/2,0)},this.setRight=function(e){var a=t.right-e;t.right=e,o.translate(a/2,0)};var c=null;this.disableRendering=function(){c=o.render,o.render=function(){}},this.enableRendering=function(){c&&(o.render=c),o.render()},o=new $3Dmol.GLViewer(e),o.setBackgroundColor("white")}return e}();