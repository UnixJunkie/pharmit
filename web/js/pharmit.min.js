function Feature(e,a,t){var n=this;this.obj={},this.shape=null,this.selected=!1,this.updateViewer=function(){},this.container=$("<div>").appendTo(a).addClass("pharmit_featurediv"),this.container.get(0).feature=this,this.container.disableSelection();var i=$("<h3></h3>").appendTo(this.container);this.enabled=$("<div>").addClass("toggle toggle-light pharmit_togglediv").appendTo(i).toggles().on("toggle",function(e,a){a?(n.obj.enabled=!0,n.container.addClass("pharmit_enabledfeature")):(n.obj.enabled=!1,n.container.removeClass("pharmit_enabledfeature")),n.updateViewer()}).click(function(){return!1});var r=$("<div>").addClass("pharmit_featurenamediv").appendTo(i),o=$("<span>").addClass("pharmit_featurenameheading").appendTo(r),s=$("<div>").addClass("pharmit_featureclose").appendTo(i).click(function(){n.deleteFeature()}),d=($("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(s),$("<span>").appendTo(r).addClass("pharmit_featuresummary"));d.append($(document.createTextNode("("))),this.xsummary=$("<span>").appendTo(d),d.append($(document.createTextNode(","))),this.ysummary=$("<span>").appendTo(d),d.append($(document.createTextNode(","))),this.zsummary=$("<span>").appendTo(d),d.append($(document.createTextNode(") Radius "))),this.rsummary=$("<span>").appendTo(d);var l=$("<div>").appendTo(this.container),p=this.select=$('<select name="featurename">').addClass("pharmit_featureselect").appendTo(l);$.each(this.featureNames,function(e,a){$('<option value="'+a+'">'+a+"</option>").appendTo(p)}),p.change(function(){var e=this.value;n.obj.name=e,o.text(e),"Aromatic"==e||"HydrogenDonor"==e||"HydrogenAcceptor"==e?(n.orientdiv.show(),n.sizediv.hide(),n.obj.hasvec=!0):"Hydrophobic"==e?(n.orientdiv.hide(),n.sizediv.show(),n.obj.hasvec=!1):(n.orientdiv.hide(),n.sizediv.hide(),n.obj.hasvec=!1),n.updateViewer()}),p.selectmenu({width:"12em",change:function(){p.trigger("change")}});var c=$("<div>").appendTo(l).addClass("pharmit_locationdiv"),u=function(e,a){var t=function(){e.change()};return a.spin=a.stop=a.change=t,a},h=function(e){return Math.round(1e3*e)/1e3},m=$("<div>").appendTo(c).addClass("pharmit_coorddiv");$("<label>x:</label>").appendTo(m),this.x=$("<input>").appendTo(m).addClass("pharmit_coordinput").change(function(){var e=this.value=h(parseFloat(this.value));n.xsummary.text(numeral(e).format("0.[00]")),n.obj.x=h(e),n.updateViewer()}),this.x.spinner(u(n.x,{step:.1,numberFormat:"n"})),m=$("<div>").appendTo(c).addClass("pharmit_coorddiv"),$("<label>y:</label>").appendTo(m),this.y=$("<input>").appendTo(m).addClass("pharmit_coordinput"),this.y.spinner(u(n.y,{step:.1,numberFormat:"n"})).change(function(){var e=this.value=h(parseFloat(this.value));n.ysummary.text(numeral(e).format("0.[00]")),n.obj.y=h(e),n.updateViewer()}),m=$("<div>").appendTo(c).addClass("pharmit_coorddiv"),$("<label>z:</label>").appendTo(m),this.z=$("<input>").appendTo(m).addClass("pharmit_coordinput"),this.z.spinner(u(n.z,{step:.1,numberFormat:"n"})).change(function(){var e=this.value=h(parseFloat(this.value));n.zsummary.text(numeral(e).format("0.[00]")),n.obj.z=e,n.updateViewer()}),m=$("<div>").appendTo(c).addClass("pharmit_coorddiv"),$("<label>Radius:</label>").appendTo(m),this.radius=$("<input>").appendTo(m).addClass("pharmit_radiusinput"),this.radius.spinner(u(n.radius,{step:.1,numberFormat:"n"})).change(function(){n.rsummary.text(numeral(this.value).format("0.[00]")),n.obj.radius=this.value=h(this.value),n.updateViewer()});var f=this.orientdiv=$("<div>").appendTo(l).addClass("pharmit_orientdiv"),v=null,b=null,g=function(){var e=Math.round(parseFloat(b.val()))%360,a=Math.round(parseFloat(v.val()))%360;isNaN(e)&&(e=0),isNaN(a)&&(a=0),b.val(e),v.val(a),a=a*Math.PI/180,e=e*Math.PI/180,n.obj.svector={x:Math.sin(a)*Math.cos(e),y:Math.sin(a)*Math.sin(e),z:Math.cos(a)},n.updateViewer()};this.orientenabled=$('<input type="checkbox">').appendTo(f).change(function(){$(this).prop("checked")?(v.spinner("option","disabled",!1),b.spinner("option","disabled",!1),n.obj.vector_on=1):(v.spinner("option","disabled",!0),b.spinner("option","disabled",!0),n.obj.vector_on=0,g()),n.updateViewer()});var T=$("<span>").addClass("pharmit_nowrap").appendTo(f);$("<label>&theta;:</label>").appendTo(T),v=this.theta=$("<input>").appendTo(T).addClass("pharmit_orientinput"),this.theta.spinner(u(n.theta,{step:1,numberFormat:"n"})).change(g),T=$("<span>").addClass("pharmit_nowrap").appendTo(f),$("<label>&phi;:</label>").appendTo(T),b=this.phi=$("<input>").appendTo(T).addClass("pharmit_orientinput"),this.phi.spinner(u(n.theta,{step:1,numberFormat:"n"})).change(g),this.orientdiv.hide();var y=this.sizediv=$("<div>").appendTo(l).addClass("pharmit_sizediv");this.minsize=$("<input>").appendTo(y).addClass("pharmit_sizeinput"),this.minsize.spinner(u(n.minsize,{step:1,numberFormat:"n"})).change(function(){n.obj.minsize=this.value,n.updateViewer()}),$("<label> &le; #Atoms &le;</label>").appendTo(y).addClass("pharmit_nowrap"),this.maxsize=$("<input>").appendTo(y).addClass("pharmit_sizeinput"),this.maxsize.spinner(u(n.maxsize,{step:1,numberFormat:"n"})).change(function(){n.obj.maxsize=this.value,n.updateViewer()}),this.sizediv.hide(),this.setFeature(t),delete this.updateViewer,this.viewer=e,this.updateViewer(),a.accordion("refresh"),a.accordion("option","active",a.children().length-1)}Feature.prototype.setFeature=function(e){if(this.select.val(e.name).trigger("change"),this.select.selectmenu("refresh"),this.x.val(e.x).trigger("change"),this.y.val(e.y).trigger("change"),this.z.val(e.z).trigger("change"),this.radius.val(e.radius).trigger("change"),this.enabled.toggles(e.enabled),this.obj.enabled=!!e.enabled,this.orientenabled.prop("checked",1==e.vector_on).trigger("change"),$.isNumeric(e.minsize)?this.minsize.val(e.minsize).trigger("change"):this.obj.minsize="",$.isNumeric(e.maxsize)?this.maxsize.val(e.maxsize).trigger("change"):this.obj.maxsize="",e.svector){var a=e.svector.x,t=e.svector.y,n=e.svector.z,i=180*Math.acos(n/Math.sqrt(a*a+t*t+n*n))/Math.PI,r=180*Math.atan2(t,a)/Math.PI;this.theta.val(i).trigger("change"),this.phi.val(r).trigger("change")}else this.obj.svector={x:1,y:0,z:0}},Feature.prototype.featureNames=["Aromatic","HydrogenDonor","HydrogenAcceptor","Hydrophobic","NegativeIon","PositiveIon","ExclusionSphere"],Feature.prototype.updateViewer=function(){if(null!==this.shape&&this.viewer.removeFeature(this.shape),this.obj.enabled){var e=this;this.shape=this.viewer.addFeature(this.obj,function(){e.selected?e.deselectFeature():e.selectFeature()})}},Feature.prototype.selectFeature=function(){this.viewer.selectFeature(this.shape),this.container.addClass("pharmit_selectedFeature"),this.selected=!0,this.obj.selected=!0},Feature.prototype.deselectFeature=function(){this.viewer.unselectFeature(this.shape),this.container.removeClass("pharmit_selectedFeature"),this.selected=!1,this.obj.selected=!1},Feature.prototype.deleteFeature=function(){null!==this.shape&&this.viewer.removeFeature(this.shape),this.container.feature=null,this.container.remove()};var Pharmit=Pharmit||{};!function(){function e(e){return t(a(n(e)))}function a(e){return r(o(i(e),8*e.length))}function t(e){for(var a,t=m?"0123456789ABCDEF":"0123456789abcdef",n="",i=0;i<e.length;i++)a=e.charCodeAt(i),n+=t.charAt(a>>>4&15)+t.charAt(15&a);return n}function n(e){for(var a,t,n="",i=-1;++i<e.length;)a=e.charCodeAt(i),t=i+1<e.length?e.charCodeAt(i+1):0,a>=55296&&56319>=a&&t>=56320&&57343>=t&&(a=65536+((1023&a)<<10)+(1023&t),i++),127>=a?n+=String.fromCharCode(a):2047>=a?n+=String.fromCharCode(192|a>>>6&31,128|63&a):65535>=a?n+=String.fromCharCode(224|a>>>12&15,128|a>>>6&63,128|63&a):2097151>=a&&(n+=String.fromCharCode(240|a>>>18&7,128|a>>>12&63,128|a>>>6&63,128|63&a));return n}function i(e){for(var a=Array(e.length>>2),t=0;t<a.length;t++)a[t]=0;for(t=0;t<8*e.length;t+=8)a[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return a}function r(e){for(var a="",t=0;t<32*e.length;t+=8)a+=String.fromCharCode(e[t>>5]>>>t%32&255);return a}function o(e,a){e[a>>5]|=128<<a%32,e[(a+64>>>9<<4)+14]=a;for(var t=1732584193,n=-271733879,i=-1732584194,r=271733878,o=0;o<e.length;o+=16){var s=t,h=n,m=i,f=r;t=d(t,n,i,r,e[o+0],7,-680876936),r=d(r,t,n,i,e[o+1],12,-389564586),i=d(i,r,t,n,e[o+2],17,606105819),n=d(n,i,r,t,e[o+3],22,-1044525330),t=d(t,n,i,r,e[o+4],7,-176418897),r=d(r,t,n,i,e[o+5],12,1200080426),i=d(i,r,t,n,e[o+6],17,-1473231341),n=d(n,i,r,t,e[o+7],22,-45705983),t=d(t,n,i,r,e[o+8],7,1770035416),r=d(r,t,n,i,e[o+9],12,-1958414417),i=d(i,r,t,n,e[o+10],17,-42063),n=d(n,i,r,t,e[o+11],22,-1990404162),t=d(t,n,i,r,e[o+12],7,1804603682),r=d(r,t,n,i,e[o+13],12,-40341101),i=d(i,r,t,n,e[o+14],17,-1502002290),n=d(n,i,r,t,e[o+15],22,1236535329),t=l(t,n,i,r,e[o+1],5,-165796510),r=l(r,t,n,i,e[o+6],9,-1069501632),i=l(i,r,t,n,e[o+11],14,643717713),n=l(n,i,r,t,e[o+0],20,-373897302),t=l(t,n,i,r,e[o+5],5,-701558691),r=l(r,t,n,i,e[o+10],9,38016083),i=l(i,r,t,n,e[o+15],14,-660478335),n=l(n,i,r,t,e[o+4],20,-405537848),t=l(t,n,i,r,e[o+9],5,568446438),r=l(r,t,n,i,e[o+14],9,-1019803690),i=l(i,r,t,n,e[o+3],14,-187363961),n=l(n,i,r,t,e[o+8],20,1163531501),t=l(t,n,i,r,e[o+13],5,-1444681467),r=l(r,t,n,i,e[o+2],9,-51403784),i=l(i,r,t,n,e[o+7],14,1735328473),n=l(n,i,r,t,e[o+12],20,-1926607734),t=p(t,n,i,r,e[o+5],4,-378558),r=p(r,t,n,i,e[o+8],11,-2022574463),i=p(i,r,t,n,e[o+11],16,1839030562),n=p(n,i,r,t,e[o+14],23,-35309556),t=p(t,n,i,r,e[o+1],4,-1530992060),r=p(r,t,n,i,e[o+4],11,1272893353),i=p(i,r,t,n,e[o+7],16,-155497632),n=p(n,i,r,t,e[o+10],23,-1094730640),t=p(t,n,i,r,e[o+13],4,681279174),r=p(r,t,n,i,e[o+0],11,-358537222),i=p(i,r,t,n,e[o+3],16,-722521979),n=p(n,i,r,t,e[o+6],23,76029189),t=p(t,n,i,r,e[o+9],4,-640364487),r=p(r,t,n,i,e[o+12],11,-421815835),i=p(i,r,t,n,e[o+15],16,530742520),n=p(n,i,r,t,e[o+2],23,-995338651),t=c(t,n,i,r,e[o+0],6,-198630844),r=c(r,t,n,i,e[o+7],10,1126891415),i=c(i,r,t,n,e[o+14],15,-1416354905),n=c(n,i,r,t,e[o+5],21,-57434055),t=c(t,n,i,r,e[o+12],6,1700485571),r=c(r,t,n,i,e[o+3],10,-1894986606),i=c(i,r,t,n,e[o+10],15,-1051523),n=c(n,i,r,t,e[o+1],21,-2054922799),t=c(t,n,i,r,e[o+8],6,1873313359),r=c(r,t,n,i,e[o+15],10,-30611744),i=c(i,r,t,n,e[o+6],15,-1560198380),n=c(n,i,r,t,e[o+13],21,1309151649),t=c(t,n,i,r,e[o+4],6,-145523070),r=c(r,t,n,i,e[o+11],10,-1120210379),i=c(i,r,t,n,e[o+2],15,718787259),n=c(n,i,r,t,e[o+9],21,-343485551),t=u(t,s),n=u(n,h),i=u(i,m),r=u(r,f)}return Array(t,n,i,r)}function s(e,a,t,n,i,r){return u(h(u(u(a,e),u(n,r)),i),t)}function d(e,a,t,n,i,r,o){return s(a&t|~a&n,e,a,i,r,o)}function l(e,a,t,n,i,r,o){return s(a&n|t&~n,e,a,i,r,o)}function p(e,a,t,n,i,r,o){return s(a^t^n,e,a,i,r,o)}function c(e,a,t,n,i,r,o){return s(t^(a|~n),e,a,i,r,o)}function u(e,a){var t=(65535&e)+(65535&a),n=(e>>16)+(a>>16)+(t>>16);return n<<16|65535&t}function h(e,a){return e<<a|e>>>32-a}var m=0;Pharmit.hex_md5=e}(),function(e){e.support.cssPseudoClasses=function(){try{var a=e("<input type='checkbox' checked/>").appendTo("body"),t=e('<style type="text/css" />').appendTo("head");t.text("input:checked {width: 200px; display: none}");var n="200px"==a.css("width");return a.remove(),t.remove(),n}catch(i){return!1}}(),e.fn.fileinput=function(a){var t=this;return a||(a='<button class="fileinput">Browse...</button>'),t.each(function(){var t=e(this);t.wrap('<div class="fileinput-wrapper" style=" position: relative; display: inline-block;" />'),t.parent().mousemove(function(a){var t,n,i=e(this);t=i.offset().left,n=i.offset().top,i.find("input").css({left:a.pageX-t-i.find("input[type=file]").width()+30,top:a.pageY-n-10})}),t.attr("tabindex","-1").css({filter:"alpha(opacity=0)","-moz-opacity":0,opacity:0,position:"absolute","z-index":-1}),t.before(a),t.prev().addClass("fileinput"),e.support.cssPseudoClasses?(t.prev(".fileinput").click(function(){t.click()}),t.prev(":submit.fileinput").click(function(e){e.preventDefault()})):(t.css({"z-index":"auto",cursor:"pointer"}),t.prev(".fileinput").css("z-index",-1),t.removeAttr("tabindex"),t.prev(".fileinput").attr("tabindex","-1"),t.hover(function(){e(this).prev(".fileinput").addClass("hover")},function(){e(this).prev(".fileinput").removeClass("hover")}).focusin(function(){e(this).prev(".fileinput").addClass("focus")}).focusout(function(){e(this).prev(".fileinput").removeClass("focus")}).mousedown(function(){e(this).prev(".fileinput").addClass("active")}).mouseup(function(){e(this).prev(".fileinput").removeClass("active")}))}),t}}(jQuery);var Pharmit=Pharmit||{};$(document).ready(function(){var e={};for(var a in window)e[a]=!0;Pharmit.checkGlobals=function(){var a=[];for(var t in window)t in e||a.push(t);a.length>0&&console.log("Leaked global variables: ["+a.join(", ")+"]")};var t=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+e+"=([^&#]*)",t=new RegExp(a),n=t.exec(window.location.href);return null===n?null:n[1]};Pharmit.server="/fcgi-bin/pharmitserv.fcgi",Pharmit.email="dkoes+pharmit@pitt.edu";var n=$("#pharmit").addClass("pharmit_main"),i=new Pharmit.Viewer(n),r=new Pharmit.Results(n,i),o=new Pharmit.Query(n,i,r);t("SESSION")&&$.get(decodeURI(t("SESSION")),function(e){o.loadSession(e)}),Pharmit.checkGlobals(),$("button, input[type='button'], input[type='submit']").button().bind("mouseup",function(){$(this).blur()})});var Pharmit=Pharmit||{};Pharmit.MinResults=function(){function e(e,a){{var t=null,n=null,i=null,r=function(e){if(0===e.status)return{error:e.msg};for(var a=e.data,t=0;t<a.length;t++)a[t][3]=numeral(a[t][3]).format("0.00"),a[t][4]=numeral(a[t][4]).format("0.000");return a};this.cancel=function(){$.fn.DataTable.isDataTable(m)&&m.DataTable().destroy(),n.button("option","disabled",!0),t.hide()}}this.minimize=function(e,o,s){i=s;var d={cmd:"startsmina",qid:e,receptorid:o.receptorid,recname:o.recname};$.post(Pharmit.server,d,null,"json").done(function(t){if(t.status){sminaid=t.sminaid;var i=Math.floor((c.height()-85)/28);m.dataTable({searching:!1,pageLength:i,destroy:!0,lengthChange:!1,order:[[1,"asc"]],orderMulti:!1,columnDefs:[{targets:[0],visible:!1},{targets:[1],visible:!1},{targets:[2],className:"pharmit_minname",searchable:!1,sortable:!1},{targets:[3],className:"pharmit_minscore",searchable:!1},{targets:[4],className:"pharmit_minrmsd",searchable:!1}],language:{emptyTable:"Nada, zip, zilcho",infoFiltered:"",infoEmpty:"",info:"Minimizing..."},serverSide:!0,processing:!0,ajax:{url:Pharmit.server,data:{cmd:"getsminadata",qid:e},dataSrc:r}}),m.on("xhr.dt",function(e,t,i){i.finished?n.button("option","disabled",!1):0===i.status?alert(i.msg):(a.setResult(),setTimeout(function(){m.DataTable().ajax.reload()},1e3))}),$("tbody",m).on("click","tr",function(){var t=m.DataTable().row(this).data()[0],n=this;$(this).hasClass("selected")?($(this).removeClass("selected"),a.setResult()):(m.DataTable().$("tr.selected").removeClass("selected"),$(this).addClass("selected"),$.post(Pharmit.server,{cmd:"getsminamol",qid:e,molid:t}).done(function(e){$(n).hasClass("selected")&&a.setResult(e)}))})}else alert("Error: "+t.msg)}).fail(function(){alert("Error contacting minimization server.  Please inform "+Pharmit.email+" if this problem persists.")}),t.show()};var o=function(){},s=function(){};t=$("<div>").appendTo(e.div).addClass("pharmit_rescontainer");var d=$("<div>").appendTo(t).addClass("pharmit_resheader"),l=$("<div>Minimization Results</div>").appendTo(d).addClass("pharmit_heading").addClass("pharmit_rightheading"),p=$("<div>").addClass("pharmit_resclose").appendTo(l).click(function(){t.hide(),i&&i()}),c=($("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(p),$("<div>").appendTo(t).addClass("pharmit_resbody")),u=$("<div>").appendTo(t).addClass("pharmit_resfooter"),h=$("<div>").appendTo(u).addClass("pharmit_minparams").disableSelection(),m=$("<table>").appendTo(h),f=$("<tr>").appendTo(m).addClass("pharmit_paramrow");$("<td>").appendTo(f).append($("<label>Max Score</label>"));var v=$("<td>").appendTo(f);$('<input name="sminamaxscore">').appendTo(v).addClass("pharmit_sminainput").spinner(),$("<td>").appendTo(f).addClass("pharmit_checkcell").append($('<input type="checkbox" name="sminaunique">')),$("<td>").appendTo(f).append($("<label>Single<br>conformer</label>")),f=$("<tr>").appendTo(m).addClass("pharmit_paramrow"),$("<td>").appendTo(f).append($("<label>Max mRMSD</label>")),v=$("<td>").appendTo(f),$('<input name="sminamaxrmsd">').appendTo(v).addClass("pharmit_sminainput").spinner(),v=$("<td colspan=2>").appendTo(f).addClass("pharmit_applycell"),$("<button>Apply</button>").appendTo(v).button().click(s);var b=$("<div>").appendTo(u).addClass("pharmit_minbottom");n=$("<button>Save...</button>").appendTo(b).button().click(o),t.hide()}return e}();var Pharmit=Pharmit||{};Pharmit.PhResults=function(){function e(e,a,t){var n=null,i=null,r=null,o=null,s=null,d=null,l=null,p=function(e){if(0===e.status)return{error:e.msg};for(var a=e.data,t=0;t<a.length;t++)a[t][1]=numeral(a[t][1]).format("0.000");return a},c=0,u=0,h=20,m=function(){if($.fn.DataTable.isDataTable(o)){var e=s.height();if(e!=c){c=e,e-=$("thead",o).height(),e-=$(".dataTables_info",s).height(),e-=$(".dataTables_paginate",s).height(),e-=h;var a=$("tr.odd",o).first().height()+1,t=Math.floor(e/a);t!=u&&(o.DataTable().page.len(t),o.DataTable().draw())}}};$.fn.DataTable.ext.pager.numbers_length=5,this.query=function(e){r=$.extend({},e),delete r.receptor,delete r.ligand;var t={cmd:"startquery",json:JSON.stringify(r)};null!==i&&(t.oldqid=i),$.post(Pharmit.server,t,null,"json").done(function(e){if(e.status){i=e.qid;var t=Math.floor((s.height()-85)/28);o.dataTable({searching:!1,pageLength:t,destroy:!0,lengthChange:!1,order:[[1,"asc"]],orderMulti:!1,columnDefs:[{targets:[0],className:"pharmit_namecol",searchable:!1,sortable:!1},{targets:[1],className:"pharmit_rmsdcol",searchable:!1},{targets:[2],className:"pharmit_masscol",searchable:!1},{targets:[3],className:"pharmit_bondscol",searchable:!1},{targets:[4],visible:!1}],language:{emptyTable:"Searching "+numeral(e.numMols).format("0,0")+" molecules and "+numeral(e.numConfs).format("0,0")+" conformers...",infoFiltered:"",infoEmpty:"",info:"Searching..."},serverSide:!0,processing:!0,ajax:{url:Pharmit.server,data:{cmd:"getdata",qid:i},dataSrc:p}}),o.on("xhr.dt",function(e,t,n){if(n.finished){var i=o.DataTable().settings()[0].oLanguage;0===n.recordsTotal?i.emptyTable=i.sEmptyTable="No results found":(i.sInfo="Showing _START_ to _END_ of _TOTAL_ entries",d.button("option","disabled",!1),l.button("option","disabled",!1))}else 0===n.status?alert(n.msg):(a.setResult(),setTimeout(function(){o.DataTable().ajax.reload()},1e3))}),$("tbody",o).on("click","tr",function(){var e=this,t=o.DataTable().row(e).data()[4];$(e).hasClass("selected")?($(e).removeClass("selected"),a.setResult()):(o.DataTable().$("tr.selected").removeClass("selected"),$(e).addClass("selected"),$.post(Pharmit.server,{cmd:"getmol",qid:i,loc:t}).done(function(t){$(e).hasClass("selected")&&a.setResult(t)}))})}else alert("Error: "+e.msg)}).fail(function(){alert("Error contacting server.  Please inform "+Pharmit.email+" if this problem persists.")}),n.show()};var f=this.cancel=function(){null!==i&&$.post(Pharmit.server,{cmd:"cancelquery",oldqid:i}),$.fn.DataTable.isDataTable(o)&&o.DataTable().destroy(),d.button("option","disabled",!0),l.button("option","disabled",!0),t.cancel()},v=function(){var e=Pharmit.server+"?cmd=saveres&qid="+i,a=$("<form>",{action:e,method:"post"});a.appendTo(document.body),a.submit(),$(a).remove()},b=function(){n.hide(),t.minimize(i,r,function(){n.show()})};n=$("<div>").appendTo(e.div).addClass("pharmit_rescontainer");{var g=$("<div>").appendTo(n).addClass("pharmit_resheader"),T=$("<div>Pharmacophore Results</div>").appendTo(g).addClass("pharmit_heading").addClass("pharmit_rightheading"),y=$("<div>").addClass("pharmit_resclose").appendTo(T).click(function(){f(),e.close()});$("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(y)}s=$("<div>").appendTo(n).addClass("pharmit_resbody"),o=$('<table width="100%" class="display compact" cellspacing="0">').addClass("pharmit_phtable").appendTo(s);var C=$("<tr>").appendTo($("<thead>").appendTo(o));$("<th>Name</th>").appendTo(C),$("<th>RMSD</th>").appendTo(C),$("<th>Mass</th>").appendTo(C),$("<th>RBnds</th>").appendTo(C),$("<th>mid</th>").appendTo(C),$("<tbody>").appendTo(o);var w=$("<div>").appendTo(n).addClass("pharmit_resfooter"),_=$("<div>").appendTo(w).addClass("pharmit_bottomloaders").addClass("pharmit_nowrap");d=$("<button>Minimize</button>").appendTo(_).button({disabled:!0}).click(b),l=$("<button>Save...</button>").appendTo(_).button({disabled:!0}).click(v),$(window).resize(m)}return e}();var Pharmit=Pharmit||{};Pharmit.Query=function(){function e(e,t,n){var i=$("<div>").addClass("pharmit_query pharmit_overlay"),r=null,o=null,s=null,d=null,l=null,p=null,c=null,u=function(){var e=T();e.receptor&&e.reckey&&delete e.receptor,delete e.ligand,n.phquery(e)},h=function(e,a){if(e.files.length>0){var t=e.files[0],n=new FileReader;n.onload=function(e){a(e.target.result,t.name)},n.readAsText(t),$(e).val("")}},m=function(e){var a=(new Date).getTime();t.disableRendering(),r.detach();var n=r.children();$.each(n,function(e,a){a.feature.deleteFeature()}),r.empty(),e&&$.each(e,function(e,a){new Feature(t,r,a)}),r.accordion("option","active",!1),r.accordion("refresh"),o.after(r),t.enableRendering();var i=(new Date).getTime(),s=i-a;console.log("setFeatures time: "+s)},f=function(e,a){p=null,c=null;var n={cmd:"getpharma",ligand:e,ligandname:a};d&&(l?(n.reckey=l,n.recname=d):(n.receptor=s,n.recname=d)),$.post(Pharmit.server,n,null,"json").done(function(n){n.status?(n.mol&&(c=a,p=e,t.setLigand(e,a)),m(n.points)):alert("Error: "+n.msg)}).fail(function(){alert("Error contacting server.  Please inform "+Pharmit.email+" if this problem persists.")})},v=function(e,a){if(e&&a){s=e,d=a,t.setReceptor(e,a),l=null;var n=Pharmit.hex_md5(s);$.post(Pharmit.server,{cmd:"setreceptor",key:n,receptor:s}).done(function(){l=n})}},b=function(){var e=r.children().detach();e.sort(function(e,a){var t=e.feature.obj,n=a.feature.obj;return t.enabled!=n.enabled?n.enabled-t.enabled:t.name!=n.name?t.name.localeCompare(n.name):t.radius-n.radius}),r.append(e)},g=this.loadSession=function(e){var a=e;"string"==typeof e&&(a=$.parseJSON(e)),m(a.points),$.each(a,function(e,a){var t=$("input[name="+e+"]");t.length&&t.val(a).change()}),v(a.receptor,a.recname),t.setReceptor(s,d),a.sdf?(p=decodeURIComponent(a.sdf),c=p.match(/^@<TRIPOS>MOLECULE/)?".mol2":p.match(/^HETATM/)||p.match(/^ATOM/)?".pdb":p.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/)?".sdf":".xyz"):(p=a.ligand,c=a.ligandFormat),t.setLigand(p,c),a.backgroundcolor&&$("#"+a.backgroundcolor).prop("checked",!0).change(),t.setView(a.view)},T=function(){var e={};return e.points=[],$.each(r.children(),function(a,t){e.points.push(t.feature.obj)}),$.each($("[name]",i),function(a,t){t.name&&(e[t.name]=t.value)}),e.backgroundcolor="whiteBackground",$("#blackBackground").prop("checked")&&(e.backgroundcolor="blackBackground"),e.ligand=p,e.ligandFormat=c,e.receptor=s,e.recname=d,e.receptorid=l,e},y=function(){var e=Pharmit.server+'?cmd=savedata&type="text%2Fphjson"&fname="pharmit.json"',a=$("<form>",{action:e,method:"post"}),t=T();a.append($("<input>",{name:"data",type:"hidden",value:JSON.stringify(t,null,4)})),a.appendTo(document.body),a.submit(),$(a).remove()},C=function(e,a){var t=$("<div>").addClass("pharmit_searchdiv"),n=$("<button>Search "+a[0]+"</button>").appendTo(t).button(),i=$("<button>Select subset to search</button>").appendTo(t).button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}});t.buttonset();for(var r=$("<ul>").appendTo($("body")).addClass("pharmit_floatmenu"),o=[],s=0,d=a.length;d>s;s++)o[s]="<li>"+a[s]+"</li>";r.append(o),r.hide().menu().on("menuselect",function(e,a){n.button("option","label","Search "+a.item.text())}),n.click(u),i.click(function(){var e=r.show().position({my:"left top",at:"left buttom",of:this});return $(document).one("click",function(){e.hide()}),!1}),e.prepend(t)},w=$("<div>").appendTo(i).addClass("pharmit_leftclose"),_=$("<span>").addClass("ui-icon ui-icon-carat-1-w").appendTo(w);i.resizable({handles:"e",resize:function(e,a){t.setLeft(a.size.width)}}),i.disableSelection(),w.click(function(){if(w.hasClass("pharmit_leftisclosed")){w.removeClass("pharmit_leftisclosed"),_.removeClass("ui-icon-carat-1-e"),_.addClass("ui-icon-carat-1-w");var e=i.width();i.css("width","");var a=i.width();i.width(e),i.animate({width:a},{progress:function(){t.setLeft(i.width())}}),i.resizable("option","disabled",!1)}else i.animate({width:0},{progress:function(){t.setLeft(i.width())}}),w.addClass("pharmit_leftisclosed"),_.addClass("ui-icon-carat-1-e"),_.removeClass("ui-icon-carat-1-w"),i.resizable("option","disabled",!0)});var x=$("<div>").appendTo(i).addClass("pharmit_queryheader");C(x,["MolPort","ZINC"]);var k=$("<div>").appendTo(x).addClass("pharmit_loaderdiv").addClass("pharmit_nowrap"),S=$("<button>Load Receptor...</button>").button(),z=$("<button>Load Features...</button>").button();e.append(i);$('<input type="file">').appendTo(k).fileinput(S).change(function(){h(this,v)}),$('<input type="file">').appendTo(k).fileinput(z).change(function(){h(this,f)});i.detach();var P=$("<div>").appendTo(i).addClass("pharmit_querybody"),F=$("<div>").appendTo(P);o=$("<div>Pharmacophore</div>").appendTo(F).addClass("pharmit_heading"),r=$("<div>").appendTo(F),r.accordion({header:"> div > h3",animate:!0,active:!1,collapsible:!0,heightStyle:"content",beforeActivate:function(e,a){var t=null,n=r.children();$.each(n,function(e,a){a.feature.deselectFeature()}),a.newHeader.length>0&&(t=a.newHeader.parent(),t.get(0).feature.selectFeature())}}).sortable({axis:"y",handle:"h3",stop:function(e,a){a.item.children("h3").triggerHandler("focusout"),$(this).accordion("refresh")}});var R=$("<div>").appendTo(F).addClass("pharmit_featurebuttons"),M=($("<button>Add</button>").appendTo(R).button({text:!0,icons:{secondary:"ui-icon-circle-plus"}}).click(function(){new Feature(t,r,a)}),$("<button>Sort</button>").appendTo(R).button({text:!0,icons:{secondary:"ui-icon ui-icon-carat-2-n-s"}}).click(b),$("<div>").appendTo(P));$("<div>Filters</div>").appendTo(M).addClass("pharmit_heading");var D=$("<div>").appendTo(M),j=$("<h3>Hit Reduction<br></h3>").appendTo(D),N=($("<span>").appendTo(j).addClass("pharmit_headingsummary"),$("<div>").addClass("pharmit_hitreduction").appendTo(D)),A=$("<table>").appendTo(N),V=$("<tr>").addClass("pharmit_filterrow").appendTo(A);$("<td>").append('<label title="Maximum number of orientations returned for each conformation" value="1" for="reduceorienttext">Max Hits per Conf:</label>').appendTo(V);var L=$("<td>").appendTo(V);$('<input id="reduceorienttext" name="max-orient">').appendTo(L).spinner(),V=$("<tr>").addClass("pharmit_filterrow").appendTo(A),$("<td>").append('<label title="Maximum number of conformations returned for each compound" value="1" for="reduceconfstext">Max Hits per Mol:</label>').appendTo(V),L=$("<td>").appendTo(V),$('<input id="reduceconfstext" name="reduceConfs">').appendTo(L).spinner(),V=$("<tr>").addClass("pharmit_filterrow").appendTo(A),$("<td>").append('<label title="Maximum number of hits returned" value="1" for="reducehitstext">Max Total Hits:</label>').appendTo(V),L=$("<td>").appendTo(V),$('<input id="reducehitstext" name="max-hits">').appendTo(L).spinner(),j=$("<h3>Hit Screening<br></h3>").appendTo(D);var q=($("<span>").appendTo(j).addClass("pharmit_headingsummary"),$("<div>").appendTo(D).addClass("pharmit_hitscreening")),H=$("<table>").appendTo(q);V=$("<tr>").addClass("pharmit_filterrow").appendTo(H),L=$("<td>").appendTo(V),$('<input id="minmolweight" name="minMolWeight">').appendTo(L).spinner(),$("<td>").appendTo(V).append($('<label title="Minimum/maximum molecular weight (weights are approximate)" value="1" for="maxmolweight">&le;  MolWeight &le;</label>')),L=$("<td>").appendTo(V),$('<input id="maxmolweight" name=maxMolWeight>').appendTo(L).spinner(),V=$("<tr>").addClass("pharmit_filterrow").appendTo(H),L=$("<td>").appendTo(V),$('<input id="minnrot" name="minrotbonds">').appendTo(L).spinner(),$("<td>").appendTo(V).append($('<label title="Minimum/maximum number of rotatable bonds" value="1" for="maxnrot"> &le;  RotBonds &le;</label>')),L=$("<td>").appendTo(V),$('<input id="maxnrot" name="maxrotbonds">').appendTo(L).spinner(),D.accordion({animate:!0,active:!1,collapsible:!0,heightStyle:"content"});var E=$("<div>").appendTo(P);$("<div>Visualization</div>").appendTo(E).addClass("pharmit_heading");var B=$("<div>").appendTo(E).addClass("pharmit_vizdiv");t.appendViewerControls(B);var I=$("<div>").appendTo(i).addClass("pharmit_queryfooter"),O=$("<div>").appendTo(I).addClass("pharmit_bottomloaders").addClass("pharmit_nowrap");e.append(i);{var W=$("<button>Load Session...</button>").button();$('<input type="file">').appendTo(O).fileinput(W).change(function(){h(this,g)}),$("<button>Save Session...</button>").appendTo(O).button().click(y)}t.setLeft(i.width())}var a={name:"Hydrophobic",x:0,y:0,z:0,radius:1,enabled:!0,vector_on:0,minsize:"",maxsize:"",svector:null,hasvec:!1};return e}();var Pharmit=Pharmit||{};Pharmit.Results=function(){function e(e,a){var t=this.div=$("<div>").addClass("pharmit_results pharmit_overlay").appendTo(e),n=null,i=null;this.phquery=function(e){n.cancel(),n.query(e),this.show()},this.show=function(){t.show(),a.setRight(t.width())},this.close=function(){t.hide(),a.setRight(0)};var r=$("<div>").appendTo(t).addClass("pharmit_rightclose"),o=$("<span>").addClass("ui-icon ui-icon-carat-1-e").appendTo(r);t.resizable({handles:"w",resize:function(e,t){a.setRight(t.size.width),$(this).css("left","")}}),t.disableSelection(),r.click(function(){if(r.hasClass("pharmit_rightisclosed")){r.removeClass("pharmit_rightisclosed"),o.removeClass("ui-icon-carat-1-w"),o.addClass("ui-icon-carat-1-e");var e=t.width();t.css("width","");var n=t.width();t.width(e),t.animate({width:n},{progress:function(){a.setRight(t.width())}}),t.resizable("option","disabled",!1)}else t.animate({width:0},{progress:function(){a.setRight(t.width())}}),r.addClass("pharmit_rightisclosed"),o.addClass("ui-icon-carat-1-w"),o.removeClass("ui-icon-carat-1-e"),t.resizable("option","disabled",!0)}),i=new Pharmit.MinResults(this,a),n=new Pharmit.PhResults(this,a,i),t.hide(),t.is(":visible")&&a.setRight(t.width())}return e}();var Pharmit=Pharmit||{};Pharmit.Viewer=function(){"use strict";function e(e){var a=($3Dmol.elementColors,{left:0,right:0}),t={Aromatic:"purple",HydrogenDonor:"0xf0f0f0",HydrogenAcceptor:"orange",Hydrophobic:"green",NegativeIon:"red",PositiveIon:"blue",ExclusionSphere:"grey"},n={Ligand:{model:null,defaultColor:"#C8C8C8",colorscheme:$.extend({},$3Dmol.elementColors.defaultColors),selectedstyle:"stick",styles:{stick:{name:"Stick",style:{stick:{radius:.15}},nonbond:{sphere:{radius:.15}}},wire:{name:"Wire",style:{line:{linewidth:2}},nonbond:{sphere:{radius:.05}}},sphere:{name:"Sphere",style:{sphere:{}},nonbond:{sphere:{}}},none:{name:"None",style:{},nonbond:{}}}},Receptor:{model:null,defaultColor:"#C8C8C8",colorscheme:$.extend({},$3Dmol.elementColors.defaultColors),selectedstyle:"cartoonwire",styles:{stick:{name:"Stick",style:{stick:{radius:.1}},nonbond:{sphere:{radius:.1}}},wire:{name:"Wire",style:{line:{linewidth:3}},nonbond:{sphere:{radius:.05}}},sphere:{name:"Sphere",style:{sphere:{}},nonbond:{sphere:{}}},cartoon:{name:"Cartoon",style:{cartoon:{}},nonbond:{sphere:{radius:.1}}},cartoonwire:{name:"Cartoon+Wire",style:{cartoon:{},line:{linewidth:3}},nonbond:{sphere:{radius:.2}}},none:{name:"None",style:{},nonbond:{}}}},Results:{model:null,defaultColor:"gray",colorscheme:$.extend({},$3Dmol.elementColors.defaultColors),selectedstyle:"stick",styles:{stick:{name:"Stick",style:{stick:{radius:.25}},nonbond:{sphere:{radius:.25}}},wire:{name:"Wire",style:{line:{linewidth:4}},nonbond:{sphere:{radius:.1}}},sphere:{name:"Sphere",style:{sphere:{}},nonbond:{sphere:{}}},none:{name:"None",style:{},nonbond:{}}}}},i=null,r={map:{prop:"partialCharge",scheme:new $3Dmol.Gradient.RWB(-.8,.8)},opacity:.8},o=null,s=[],d=function(e){if(!e)return"";var a=e.split(".");return a.length<=1?"":a.pop()},l=function(e){var a=n[e],t=a.selectedStyle,i=a.styles[t],r=i.style,s=i.nonbond,d=a.model;
d&&(d.setStyle({},r),d.setStyle({bonds:0},s)),o.render()},p=function(e,a){var t=n[e],i=$("<tr>").appendTo(a).addClass("pharmit_styleselectrow"),r=e+"MolStyleSelect";$('<label for="'+r+'">'+e+":</label>").appendTo(i).addClass("pharmit_stylelabel").appendTo($("<td>").appendTo(i));var o=$("<td nowrap>").appendTo(i),s=$('<select name="'+r+'" id="'+r+'">').appendTo(o).addClass("pharmit_styleselector");$.each(t.styles,function(e,a){$('<option value="'+e+'">'+a.name+"</option>").appendTo(s)}),s.val(t.selectedstyle),s.selectmenu({width:"11em",appendTo:a,change:function(){s.change()},position:{my:"left top",at:"left bottom",collision:"flip"}}),s.selectmenu("widget").css("width","");var d=t.colorscheme;$.each(t.styles,function(e,a){$.each(a.style,function(e,a){a.colorscheme=d})}),s.change(function(){t.selectedStyle=this.value,l(e)});var p=$('<input name="'+r+'color">').appendTo($("<td>").appendTo(i));p.val(t.defaultColor),p.change(function(){var a=this.value;p.spectrum("set",a);var n=parseInt(p.spectrum("get").toHex(),16);t.colorscheme.C=n,l(e)}),p.spectrum({showPalette:!0,color:t.defaultcolor,preferredFormat:"hex",replacerClassName:"ui-state-default ui-corner-all",showPaletteOnly:!0,clickoutFiresChange:!0,palette:["#C8C8C8","gray","white","green","cyan","magenta","yellow","orange","purple","blue"],change:function(){p.change()}}),s.change(),p.change(),s.selectmenu("refresh")};this.appendViewerControls=function(e){var a=$("<table>").appendTo(e);p("Ligand",a,null),p("Results",a,null),p("Receptor",a,null);var t=$("<div>").addClass("pharmit_surfacetransparencydiv").appendTo(e);$('<label for="surfaceopacity">Receptor Surface Opacity:</label>').appendTo(t);var n=$("<div>").addClass("pharmit_surfacetransparencyslider").appendTo(t);$('<div id="surfaceopacity" name="surfaceopacity">').appendTo(n).slider({animate:"fast",step:.05,min:0,max:1,value:.8,change:function(e,a){r.opacity=a.value,null!==i&&o.setSurfaceMaterialStyle(i,r),o.render()}});var s=$("<div>").addClass("pharmit_backgroundcolordiv").appendTo(e);$('<label for="backgroundcolor">Background Color:</label>').appendTo(s);var d=$('<div id="backgroundcolor">').appendTo(s);$('<input type="radio" id="whiteBackground" name="backgroundcolor"><label for="whiteBackground">White</label>').appendTo(d).change(function(){$(this).prop("checked")&&o.setBackgroundColor("white"),d.buttonset("refresh")}).prop("checked",!0),$('<input type="radio" id="blackBackground" name="backgroundcolor"><label for="blackBackground">Black</label>').appendTo(d).change(function(){$(this).prop("checked")&&o.setBackgroundColor("black"),d.buttonset("refresh")}),d.buttonset()};this.setReceptor=function(e,a){var t=n.Receptor.model;if(t&&o.removeModel(t),t=null,null!==i&&o.removeSurface(i),i=null,e){var s=d(a);t=o.addModel(e,s),n.Receptor.model=t,l("Receptor"),o.mapAtomProperties($3Dmol.applyPartialCharges,{model:t}),i=o.addSurface($3Dmol.SurfaceType.VDW,r,{model:t},{bonds:0,invert:!0}),o.zoomTo({})}else o.render()},this.setLigand=function(e,a){var t=n.Ligand.model;if(t&&o.removeModel(t),t=null,e){var i=d(a);t=o.addModel(e,i),n.Ligand.model=t,l("Ligand"),o.zoomTo({model:t})}else o.render()},this.setResult=function(e){var a=n.Results.model;a&&o.removeModel(a),e?(a=o.addModel(e,"sdf"),n.Results.model=a,l("Results"),o.zoomTo({model:a})):o.render()},this.setView=function(e){e&&o.setView(e)},this.getView=function(){return o.getView()},this.addFeature=function(e,a){var n={center:{x:e.x,y:e.y,z:e.z},radius:e.radius,color:t[e.name],wireframe:!0,linewidth:1.5,clickable:!0,callback:a},i={sphere:null,arrows:[],label:null};if(i.sphere=o.addSphere(n),e.selected&&i.sphere.updateStyle({wireframe:!1}),e.hasvec&&e.vector_on&&e.svector){var r=new $3Dmol.Vector3(e.svector.x,e.svector.y,e.svector.z),d=e.radius+1,l=(d-.5)/d;r=r.normalize();var p=r.clone().multiplyScalar(e.radius).add(e),c=r.clone().multiplyScalar(d).add(e),u={start:p,end:c,radius:.075,radiusRatio:2,mid:l,wireframe:!e.selected,color:t[e.name]};i.arrows.push(o.addArrow(u)),"Aromatic"==e.name&&(p=r.clone().multiplyScalar(-e.radius).add(e),c=r.clone().multiplyScalar(-d).add(e),u.start=p,u.end=c,i.arrows.push(o.addArrow(u)))}if("Hydrophobic"==e.name){var h=e.minsize+":"+e.maxsize;if(":"!=h){var m={position:{x:e.x,y:e.y,z:e.z},showBackground:!0,fontColor:"black",backgroundColor:t[e.name],backgroundOpacity:.5,alignment:$3Dmol.SpriteAlignment.center};i.label=o.addLabel(h,m)}}return o.render(),s.push(i),s.length-1},this.selectFeature=function(e){var a=s[e];a&&a.sphere&&(a.sphere.updateStyle({wireframe:!1}),$.each(a.arrows,function(e,a){a.updateStyle({wireframe:!1})}),o.render())},this.unselectFeature=function(e){var a=s[e];a&&a.sphere&&(a.sphere.updateStyle({wireframe:!0}),$.each(a.arrows,function(e,a){a.updateStyle({wireframe:!0})}),o.render())},this.removeFeature=function(e){var a=s[e];for(a&&(a.sphere&&o.removeShape(a.sphere),$.each(a.arrows,function(e,a){o.removeShape(a)}),a.label&&o.removeLabel(a.label),o.render()),delete s[e];s.length>0&&"undefined"==typeof s[s.length-1];)s.pop()},this.setLeft=function(e){var t=e-a.left;a.left=e,o.translate(t/2,0)},this.setRight=function(e){var t=a.right-e;a.right=e,o.translate(t/2,0)};var c=null;this.disableRendering=function(){c=o.render,o.render=function(){}},this.enableRendering=function(){c&&(o.render=c),o.render()},o=new $3Dmol.GLViewer(e),o.setBackgroundColor("white")}return e}();