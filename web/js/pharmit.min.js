function Feature(e,t,a,n){var i=null;i=n==Feature.INCLUSIVESHAPE?["InclusionSphere"]:n==Feature.EXCLUSIVESHAPE?["ExclusionSphere"]:["Aromatic","HydrogenDonor","HydrogenAcceptor","Hydrophobic","NegativeIon","PositiveIon"];var r=this;this.obj={},this.shape=null,this.selected=!1,this.updateViewer=function(){},this.container=$("<div>").appendTo(t).addClass("pharmit_featurediv"),this.container.get(0).feature=this,this.container.disableSelection();var o=$("<h3></h3>").appendTo(this.container);this.enabled=$("<div>").addClass("toggle toggle-light pharmit_togglediv").appendTo(o).toggles().on("toggle",function(e,t){t?(r.obj.enabled=!0,r.container.addClass("pharmit_enabledfeature")):(r.obj.enabled=!1,r.container.removeClass("pharmit_enabledfeature")),r.updateViewer()}).click(function(){return!1});var s=$("<div>").addClass("pharmit_featurenamediv").appendTo(o),l=$("<span>").addClass("pharmit_featurenameheading").appendTo(s),d=$("<div>").addClass("pharmit_featureclose").appendTo(o).click(function(){r.deleteFeature()}),p=($("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(d),$("<span>").appendTo(s).addClass("pharmit_featuresummary"));p.append($(document.createTextNode("("))),this.xsummary=$("<span>").appendTo(p),p.append($(document.createTextNode(","))),this.ysummary=$("<span>").appendTo(p),p.append($(document.createTextNode(","))),this.zsummary=$("<span>").appendTo(p),p.append($(document.createTextNode(") Radius "))),this.rsummary=$("<span>").appendTo(p);var c=$("<div>").appendTo(this.container),h=this.select=$("<select>").addClass("pharmit_featureselect").appendTo(c);$.each(i,function(e,t){$('<option value="'+t+'">'+t+"</option>").appendTo(h)}),h.change(function(){var e=this.value;r.obj.name=e,l.text(e),"Aromatic"==e||"HydrogenDonor"==e||"HydrogenAcceptor"==e?(r.orientdiv.show(),r.sizediv.hide(),r.obj.hasvec=!0):"Hydrophobic"==e?(r.orientdiv.hide(),r.sizediv.show(),r.obj.hasvec=!1):(r.orientdiv.hide(),r.sizediv.hide(),r.obj.hasvec=!1),r.updateViewer()}),h.selectmenu({width:"15em",change:function(){h.trigger("change")}}),i.length<=1&&h.next(".ui-selectmenu-button").hide();var u=$("<div>").appendTo(c).addClass("pharmit_locationdiv"),m=function(e,t){var a=function(){e.change()};return t.spin=t.stop=t.change=a,t},f=function(e){return Math.round(1e3*e)/1e3},v=function(e,t){if($.isNumeric(e.value)){var a=parseFloat(e.value);return t&&t.text(numeral(a).format("0.0[0]")),r.updateViewer(),f(a)}},g=$("<div>").appendTo(u).addClass("pharmit_coorddiv");$("<label>x:</label>").appendTo(g),this.x=$("<input>").appendTo(g).addClass("pharmit_coordinput").change(function(){r.obj.x=v(this,r.xsummary)}),this.x.spinner(m(r.x,{step:.1,numberFormat:"n"})),g=$("<div>").appendTo(u).addClass("pharmit_coorddiv"),$("<label>y:</label>").appendTo(g),this.y=$("<input>").appendTo(g).addClass("pharmit_coordinput"),this.y.spinner(m(r.y,{step:.1,numberFormat:"n"})).change(function(){r.obj.y=v(this,r.ysummary)}),g=$("<div>").appendTo(u).addClass("pharmit_coorddiv"),$("<label>z:</label>").appendTo(g),this.z=$("<input>").appendTo(g).addClass("pharmit_coordinput"),this.z.spinner(m(r.z,{step:.1,numberFormat:"n"})).change(function(){r.obj.z=v(this,r.zsummary)}),g=$("<div>").appendTo(u).addClass("pharmit_coorddiv"),$("<label>Radius:</label>").appendTo(g),this.radius=$("<input>").appendTo(g).addClass("pharmit_radiusinput"),this.radius.spinner(m(r.radius,{step:.1,numberFormat:"n"})).change(function(){r.obj.radius=v(this,r.rsummary)});var b=this.orientdiv=$("<div>").appendTo(c).addClass("pharmit_orientdiv"),y=null,w=null,T=function(){var e=Math.round(parseFloat(w.val()))%360,t=Math.round(parseFloat(y.val()))%360;isNaN(e)&&(e=0),isNaN(t)&&(t=0),w.val(e),y.val(t),t=t*Math.PI/180,e=e*Math.PI/180,r.obj.svector={x:Math.sin(t)*Math.cos(e),y:Math.sin(t)*Math.sin(e),z:Math.cos(t)},r.updateViewer()};this.orientenabled=$('<input type="checkbox">').appendTo(b).change(function(){$(this).prop("checked")?(y.spinner("option","disabled",!1),w.spinner("option","disabled",!1),r.obj.vector_on=1):(y.spinner("option","disabled",!0),w.spinner("option","disabled",!0),r.obj.vector_on=0,T()),r.updateViewer()});var _=$("<span>").addClass("pharmit_nowrap").appendTo(b);$("<label>&theta;:</label>").appendTo(_),y=this.theta=$("<input>").appendTo(_).addClass("pharmit_orientinput"),this.theta.spinner(m(r.theta,{step:1,numberFormat:"n"})).change(T),_=$("<span>").addClass("pharmit_nowrap").appendTo(b),$("<label>&phi;:</label>").appendTo(_),w=this.phi=$("<input>").appendTo(_).addClass("pharmit_orientinput"),this.phi.spinner(m(r.theta,{step:1,numberFormat:"n"})).change(T),this.orientdiv.hide();var C=this.sizediv=$("<div>").appendTo(c).addClass("pharmit_sizediv");this.minsize=$("<input>").appendTo(C).addClass("pharmit_sizeinput"),this.minsize.spinner(m(r.minsize,{step:1,numberFormat:"n"})).change(function(){r.obj.minsize=this.value,r.updateViewer()}),$("<label> &le; #Atoms &le;</label>").appendTo(C).addClass("pharmit_nowrap"),this.maxsize=$("<input>").appendTo(C).addClass("pharmit_sizeinput"),this.maxsize.spinner(m(r.maxsize,{step:1,numberFormat:"n"})).change(function(){r.obj.maxsize=this.value,r.updateViewer()}),this.sizediv.hide(),this.setFeature(a),delete this.updateViewer,this.viewer=e,this.updateViewer(),t.accordion("refresh"),t.accordion("option","active",t.children().length-1)}function Message(e,t,a){function n(e){"ack2"==e.data&&(l=1)}function i(){l?(r.postMessage(s,o),o="",s="",r=null,l=0,window.removeEventListener("message",n)):r&&(r.postMessage("ack",o),setTimeout(i,250))}var r=t,o=a,s=e,l=0;window.addEventListener("message",n),t.postMessage("ack",a),setTimeout(i,250)}Feature.INCLUSIVESHAPE=1,Feature.EXCLUSIVESHAPE=2,Feature.prototype.setFeature=function(e){if(this.select.val(e.name).trigger("change"),this.select.selectmenu("refresh"),this.x.val(e.x).trigger("change"),this.y.val(e.y).trigger("change"),this.z.val(e.z).trigger("change"),this.radius.val(e.radius).trigger("change"),this.enabled.toggles(e.enabled),this.obj.enabled=!!e.enabled,this.orientenabled.prop("checked",1==e.vector_on).trigger("change"),$.isNumeric(e.minsize)?this.minsize.val(e.minsize).trigger("change"):this.obj.minsize="",$.isNumeric(e.maxsize)?this.maxsize.val(e.maxsize).trigger("change"):this.obj.maxsize="",e.svector){var t=e.svector.x,a=e.svector.y,n=e.svector.z,i=180*Math.acos(n/Math.sqrt(t*t+a*a+n*n))/Math.PI,r=180*Math.atan2(a,t)/Math.PI;this.theta.val(i).trigger("change"),this.phi.val(r).trigger("change")}else this.obj.svector={x:1,y:0,z:0}},Feature.prototype.hideFeature=function(){this.obj.hidden=!0,null!==this.shape&&this.viewer.removeFeature(this.shape),this.updateViewer()},Feature.prototype.unhideFeature=function(){this.obj.hidden=!1,this.updateViewer()},Feature.prototype.updateViewer=function(){if(null!==this.shape&&(this.viewer.removeFeature(this.shape),this.shape=null),this.obj.enabled&&!this.obj.hidden){var e=this;this.shape=this.viewer.addFeature(this.obj,function(){e.selected?e.deselectFeature():e.selectFeature()})}},Feature.prototype.selectFeature=function(){this.viewer.selectFeature(this.shape),this.container.addClass("pharmit_selectedFeature"),this.selected=!0,this.obj.selected=!0},Feature.prototype.deselectFeature=function(){this.viewer.unselectFeature(this.shape),this.container.removeClass("pharmit_selectedFeature"),this.selected=!1,this.obj.selected=!1},Feature.prototype.deleteFeature=function(){null!==this.shape&&this.viewer.removeFeature(this.shape),this.container.feature=null,this.container.remove()};var Pharmit=Pharmit||{};!function(){function e(e){return a(t(n(e)))}function t(e){return r(o(i(e),8*e.length))}function a(e){for(var t,a=m?"0123456789ABCDEF":"0123456789abcdef",n="",i=0;i<e.length;i++)t=e.charCodeAt(i),n+=a.charAt(t>>>4&15)+a.charAt(15&t);return n}function n(e){for(var t,a,n="",i=-1;++i<e.length;)t=e.charCodeAt(i),a=i+1<e.length?e.charCodeAt(i+1):0,t>=55296&&56319>=t&&a>=56320&&57343>=a&&(t=65536+((1023&t)<<10)+(1023&a),i++),127>=t?n+=String.fromCharCode(t):2047>=t?n+=String.fromCharCode(192|t>>>6&31,128|63&t):65535>=t?n+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):2097151>=t&&(n+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return n}function i(e){for(var t=Array(e.length>>2),a=0;a<t.length;a++)t[a]=0;for(a=0;a<8*e.length;a+=8)t[a>>5]|=(255&e.charCodeAt(a/8))<<a%32;return t}function r(e){for(var t="",a=0;a<32*e.length;a+=8)t+=String.fromCharCode(e[a>>5]>>>a%32&255);return t}function o(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var a=1732584193,n=-271733879,i=-1732584194,r=271733878,o=0;o<e.length;o+=16){var s=a,u=n,m=i,f=r;a=l(a,n,i,r,e[o+0],7,-680876936),r=l(r,a,n,i,e[o+1],12,-389564586),i=l(i,r,a,n,e[o+2],17,606105819),n=l(n,i,r,a,e[o+3],22,-1044525330),a=l(a,n,i,r,e[o+4],7,-176418897),r=l(r,a,n,i,e[o+5],12,1200080426),i=l(i,r,a,n,e[o+6],17,-1473231341),n=l(n,i,r,a,e[o+7],22,-45705983),a=l(a,n,i,r,e[o+8],7,1770035416),r=l(r,a,n,i,e[o+9],12,-1958414417),i=l(i,r,a,n,e[o+10],17,-42063),n=l(n,i,r,a,e[o+11],22,-1990404162),a=l(a,n,i,r,e[o+12],7,1804603682),r=l(r,a,n,i,e[o+13],12,-40341101),i=l(i,r,a,n,e[o+14],17,-1502002290),n=l(n,i,r,a,e[o+15],22,1236535329),a=d(a,n,i,r,e[o+1],5,-165796510),r=d(r,a,n,i,e[o+6],9,-1069501632),i=d(i,r,a,n,e[o+11],14,643717713),n=d(n,i,r,a,e[o+0],20,-373897302),a=d(a,n,i,r,e[o+5],5,-701558691),r=d(r,a,n,i,e[o+10],9,38016083),i=d(i,r,a,n,e[o+15],14,-660478335),n=d(n,i,r,a,e[o+4],20,-405537848),a=d(a,n,i,r,e[o+9],5,568446438),r=d(r,a,n,i,e[o+14],9,-1019803690),i=d(i,r,a,n,e[o+3],14,-187363961),n=d(n,i,r,a,e[o+8],20,1163531501),a=d(a,n,i,r,e[o+13],5,-1444681467),r=d(r,a,n,i,e[o+2],9,-51403784),i=d(i,r,a,n,e[o+7],14,1735328473),n=d(n,i,r,a,e[o+12],20,-1926607734),a=p(a,n,i,r,e[o+5],4,-378558),r=p(r,a,n,i,e[o+8],11,-2022574463),i=p(i,r,a,n,e[o+11],16,1839030562),n=p(n,i,r,a,e[o+14],23,-35309556),a=p(a,n,i,r,e[o+1],4,-1530992060),r=p(r,a,n,i,e[o+4],11,1272893353),i=p(i,r,a,n,e[o+7],16,-155497632),n=p(n,i,r,a,e[o+10],23,-1094730640),a=p(a,n,i,r,e[o+13],4,681279174),r=p(r,a,n,i,e[o+0],11,-358537222),i=p(i,r,a,n,e[o+3],16,-722521979),n=p(n,i,r,a,e[o+6],23,76029189),a=p(a,n,i,r,e[o+9],4,-640364487),r=p(r,a,n,i,e[o+12],11,-421815835),i=p(i,r,a,n,e[o+15],16,530742520),n=p(n,i,r,a,e[o+2],23,-995338651),a=c(a,n,i,r,e[o+0],6,-198630844),r=c(r,a,n,i,e[o+7],10,1126891415),i=c(i,r,a,n,e[o+14],15,-1416354905),n=c(n,i,r,a,e[o+5],21,-57434055),a=c(a,n,i,r,e[o+12],6,1700485571),r=c(r,a,n,i,e[o+3],10,-1894986606),i=c(i,r,a,n,e[o+10],15,-1051523),n=c(n,i,r,a,e[o+1],21,-2054922799),a=c(a,n,i,r,e[o+8],6,1873313359),r=c(r,a,n,i,e[o+15],10,-30611744),i=c(i,r,a,n,e[o+6],15,-1560198380),n=c(n,i,r,a,e[o+13],21,1309151649),a=c(a,n,i,r,e[o+4],6,-145523070),r=c(r,a,n,i,e[o+11],10,-1120210379),i=c(i,r,a,n,e[o+2],15,718787259),n=c(n,i,r,a,e[o+9],21,-343485551),a=h(a,s),n=h(n,u),i=h(i,m),r=h(r,f)}return Array(a,n,i,r)}function s(e,t,a,n,i,r){return h(u(h(h(t,e),h(n,r)),i),a)}function l(e,t,a,n,i,r,o){return s(t&a|~t&n,e,t,i,r,o)}function d(e,t,a,n,i,r,o){return s(t&n|a&~n,e,t,i,r,o)}function p(e,t,a,n,i,r,o){return s(t^a^n,e,t,i,r,o)}function c(e,t,a,n,i,r,o){return s(a^(t|~n),e,t,i,r,o)}function h(e,t){var a=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(a>>16);return n<<16|65535&a}function u(e,t){return e<<t|e>>>32-t}var m=0;Pharmit.hex_md5=e}(),function(e){e.support.cssPseudoClasses=function(){try{var t=e("<input type='checkbox' checked/>").appendTo("body"),a=e('<style type="text/css" />').appendTo("head");a.text("input:checked {width: 200px; display: none}");var n="200px"==t.css("width");return t.remove(),a.remove(),n}catch(i){return!1}}(),e.fn.fileinput=function(t){var a=this;return t||(t='<button class="fileinput">Browse...</button>'),a.each(function(){var a=e(this);a.wrap('<div class="fileinput-wrapper" style=" position: relative; display: inline-block;" />'),a.parent().mousemove(function(t){var a,n,i=e(this);a=i.offset().left,n=i.offset().top,i.find("input").css({left:t.pageX-a-i.find("input[type=file]").width()+30,top:t.pageY-n-10})}),a.attr("tabindex","-1").css({filter:"alpha(opacity=0)","-moz-opacity":0,opacity:0,position:"absolute","z-index":-1}),a.before(t),a.prev().addClass("fileinput"),e.support.cssPseudoClasses?(a.prev(".fileinput").click(function(){a.click()}),a.prev(":submit.fileinput").click(function(e){e.preventDefault()})):(a.css({"z-index":"auto",cursor:"pointer"}),a.prev(".fileinput").css("z-index",-1),a.removeAttr("tabindex"),a.prev(".fileinput").attr("tabindex","-1"),a.hover(function(){e(this).prev(".fileinput").addClass("hover")},function(){e(this).prev(".fileinput").removeClass("hover")}).focusin(function(){e(this).prev(".fileinput").addClass("focus")}).focusout(function(){e(this).prev(".fileinput").removeClass("focus")}).mousedown(function(){e(this).prev(".fileinput").addClass("active")}).mouseup(function(){e(this).prev(".fileinput").removeClass("active")}))}),a}}(jQuery);var Pharmit=Pharmit||{};$(document).ready(function(){Pharmit.server="/fcgi-bin/pharmitserv.fcgi",Pharmit.email="dkoes@pitt.edu";var e={};for(var t in window)e[t]=!0;$(document).tooltip(),Pharmit.inFormSubmit=!1,Pharmit.checkGlobals=function(){var t=[];for(var a in window)a in e||t.push(a);t.length>0&&console.log("Leaked global variables: ["+t.join(", ")+"]")};var a=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",a=new RegExp(t),n=a.exec(window.location.href);return null===n?null:n[1]},n=$("#pharmit").addClass("pharmit_main"),i=new Pharmit.Viewer(n),r=new Pharmit.Results(n,i),o=new Pharmit.Query(n,i,r);a("SESSION")&&$.get(decodeURI(a("SESSION")),function(e){o.loadSession(e)}),Pharmit.checkGlobals(),$("button, input[type='button'], input[type='submit']").button().bind("mouseup",function(){$(this).blur()});var s=function(e){if("ack"==e.data)e.source.postMessage("ack2","*");else if("ack2"==e.data);else if(e.data.type&&"init"==e.data.type);else if(e.contexts);else try{var t=$.parseJSON(e.data);o.setLigandAndReceptor(t.ligand,t.ligandFormat,t.receptor,t.recname)}catch(a){console.log("Communication error: "+a)}};window.addEventListener("message",s)});var Pharmit=Pharmit||{};Pharmit.MinResults=function(){function e(e,a){var n=null,i=null,r=null,o=null,s=null,l=null,d=null,p=null,c=0,h=null,u=null,m=function(t){if(0===t.status)return{error:t.msg};for(var a=t.data,n=0;n<a.length;n++)a[n][3]=numeral(a[n][3]).format("0.00"),a[n][4]=numeral(a[n][4]).format("0.000"),a[n][2]=e.mangleName(a[n][2]);return a},f=function(e){return e.cmd="getsminadata",e.qid=i,""!==d.val()&&(e.maxRMSD=d.val()),""!==l.val()&&(e.maxScore=l.val()),p.prop("checked")&&(e.unique=1),e},v=this.cancel=function(){clearTimeout(h),$.fn.DataTable.isDataTable(s)&&i>0&&(s.DataTable().clear(),$.post(Pharmit.server,{cmd:"cancelsmina",qid:i})),i=null,a.setResult(),r.button("option","disabled",!0),n.hide()};this.minimize=function(e,a,r,l){c=r,o=l,i=e,u=a,c>t&&(alert("Results minimization is limited to "+t+" compounds.  Your results will be truncated."),c=t);var d={cmd:"startsmina",qid:i,receptorid:a.receptorid,recname:a.recname,num:c};$(".pharmit_mincontainer .pharmit_resbody").css({opacity:0}),$.post(Pharmit.server,d,null,"json").done(function(e){if(e.status){sminaid=e.sminaid;var t=Math.floor((T.height()-100)/29);s.dataTable({searching:!1,pageLength:t,destroy:!0,lengthChange:!1,order:[[3,"asc"]],orderMulti:!1,columnDefs:[{targets:[0],visible:!1},{targets:[1],visible:!1},{targets:[2],className:"pharmit_minname",searchable:!1,sortable:!1},{targets:[3],className:"pharmit_minscore",searchable:!1},{targets:[4],className:"pharmit_minrmsd",searchable:!1}],language:{emptyTable:"Minimizing...",infoEmpty:" ",infoFiltered:"<br>(filtered from _MAX_ total hits)",info:"Minimizing..."},serverSide:!0,processing:!1,ajax:{url:Pharmit.server,data:f,dataSrc:m}}),s.show(),$(".pharmit_mincontainer .pharmit_resbody").css({opacity:100})}else v(),o&&o(),alert("Error: "+e.msg)}).fail(function(){v(),o&&o(),alert("Error contacting minimization server.  Please inform "+Pharmit.email+" if this problem persists.")}),n.show()};var g=function(){Pharmit.inFormSubmit=!0;var e=Pharmit.server+"?cmd=savesmina&qid="+i;""!==d.val()&&(e+="&maxRMSD="+d.val()),""!==l.val()&&(e+="&maxScore="+l.val()),p.prop("checked")&&(e+="&unique=1");var t=s.DataTable().order();e+="&order[0][column]="+t[0][0],e+="&order[0][dir]="+t[0][1];var a=$("<form>",{action:e,method:"post"});a.appendTo(document.body),a.submit(),$(a).remove()};n=$("<div>").appendTo(e.div).addClass("pharmit_rescontainer pharmit_mincontainer");var b=$("<div>").appendTo(n).addClass("pharmit_resheader"),y=$("<div>Minimization Results</div>").appendTo(b).addClass("pharmit_heading").addClass("pharmit_rightheading"),w=$("<div>").addClass("pharmit_resclose").appendTo(y).click(function(){v(),o&&o()}),T=($("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(w),$("<div>").appendTo(n).addClass("pharmit_resbody"));s=$('<table width="100%" class="display compact" cellspacing="0">').addClass("pharmit_mintable").appendTo(T);var _=$("<tr>").appendTo($("<thead>").appendTo(s));$("<th>mid</th>").appendTo(_),$("<th>origpos</th>").appendTo(_),$("<th>Name</th>").appendTo(_),$('<th title="Computed using the AutoDock Vina scoring function">Score</th>').appendTo(_),$('<th title="The minimized RMSD, the heavy atom difference between the pharmacophore aligned pose and the minimized pose.  Small values imply a closer agreement to the query pharmacophore.">mRMSD</th>').appendTo(_),$("<tbody>").appendTo(s),s.on("xhr.dt",function(e,t,n){var o=s.DataTable().settings()[0].oLanguage;n.finished?(ga("send","event","query","minimize",u.subset,n.recordsTotal),r.button("option","disabled",!1),r.one("click",function(){ga("send","event","save","minimized",u.subset,n.recordsTotal)}),o.sInfo="Showing _START_ to _END_ of _TOTAL_ entries"):0===n.status?alert(n.msg):(a.setResult(),o.sInfo=numeral(n.recordsTotal).format("0,0")+"/"+numeral(c).format("0,0"),clearTimeout(h),h=setTimeout(function(){$.fn.DataTable.isDataTable(s)&&i>0&&s.DataTable().ajax.reload()},1e3))}),s.on("draw.dt",function(){$(".pharmit_minname span").powerTip({mouseOnToPopup:!0,placement:"s",smartPlacement:!0})}),$("tbody",s).on("click","tr",function(){var e=s.DataTable().row(this).data()[0],t=this;$(".pharmit_iterate_button").remove(),$(this).hasClass("selected")?($(this).removeClass("selected"),a.setResult()):(s.DataTable().$("tr.selected").removeClass("selected"),$(this).addClass("selected"),$.post(Pharmit.server,{cmd:"getsminamol",qid:i,molid:e}).done(function(n){$(t).hasClass("selected")&&a.setResult(n);var i=$('<div class="pharmit_iterate_button" title="Start new pharmit session around selected ligand">').appendTo($("td",t).last());i.button({icons:{primary:"ui-icon-arrowthickstop-1-e"},text:!1}),i.tooltip({show:{delay:500}}),i.click(function(t){t.stopPropagation();{var a=window.open("search.html"),i={ligand:n,ligandFormat:e+".sdf",receptor:u.receptor,recname:u.recname};new Message(JSON.stringify(i),a,"*")}})}))});var C=$("<div>").appendTo(n).addClass("pharmit_resfooter"),x=$("<div>").appendTo(C).addClass("pharmit_minparams").disableSelection(),S=$("<table>").appendTo(x),k=$("<tr>").appendTo(S).addClass("pharmit_paramrow");$("<td>").appendTo(k).append($("<label>Max Score</label>"));var P=$("<td>").appendTo(k);l=$('<input name="sminamaxscore">').appendTo(P).addClass("pharmit_sminainput").spinner(),p=$('<input type="checkbox" name="sminaunique">'),$("<td>").appendTo(k).addClass("pharmit_checkcell").append(p),$("<td>").appendTo(k).append($("<label>Single<br>conformer</label>")),k=$("<tr>").appendTo(S).addClass("pharmit_paramrow"),$("<td>").appendTo(k).append($("<label>Max mRMSD</label>")),P=$("<td>").appendTo(k),d=$('<input name="sminamaxrmsd">').appendTo(P).addClass("pharmit_sminainput").spinner(),P=$("<td colspan=2>").appendTo(k).addClass("pharmit_applycell"),$("<button>Apply</button>").appendTo(P).button().click(function(){s.DataTable().ajax.reload()});var M=$("<div>").appendTo(C).addClass("pharmit_minbottom");r=$("<button>Save...</button>").appendTo(M).button().click(g),n.hide();var F=0,R=0;$(window).resize(function(){if(i>0){var e=T.height();if(e!=F){F=e,e-=$("thead",s).height(),e-=$(".dataTables_info",T).height(),e-=$(".dataTables_paginate",T).height(),e-=20;var t=$("tr.odd",s).first().height()+1,a=Math.floor(e/t);a!=R&&(s.DataTable().page.len(a),s.DataTable().draw(),R=a)}}})}var t=25e3;return e}();var Pharmit=Pharmit||{};Pharmit.Query=function(){function e(e,d,p){var c=$("<div>").addClass("pharmit_query pharmit_overlay"),h=null,u=null,m=null,f=null,v=null,g=null,b=null,y=null,w=null,T=function(){var e=F(!0);"search"==t?(ga("send","event","query","shape",e.subset),p.shquery(e,v)):(ga("send","event","query","pharmacophore",e.subset),p.phquery(e,v))},_=function(e,t){if(e.files.length>0){var a=e.files[0],n=new FileReader;n.onload=function(e){t(e.target.result,a.name)},n.readAsText(a),$(e).val("")}},C=function(e,t,a){var n=t.parent();t.detach();var i=t.children();$.each(i,function(e,t){t.feature.deleteFeature()}),t.empty(),e&&$.each(e,function(e,n){new Feature(d,t,n,a)}),t.accordion("option","active",!1),t.accordion("refresh"),n.prepend(t)},x=function(e){if(e){{(new Date).getTime()}d.disableRendering();for(var t=[],a=[],n=[],i=0,r=e.length;r>i;i++){var o=e[i];"InclusionSphere"==o.name?a.push(o):"ExclusionSphere"==o.name?n.push(o):t.push(o)}C(t,h),C(a,u,Feature.INCLUSIVESHAPE),C(n,m,Feature.EXCLUSIVESHAPE),$("#exselect").change(),d.enableRendering();{(new Date).getTime()}}},S=function(e,t){y=null,w=null;var a={cmd:"getpharma",ligand:e,ligandname:t};g&&(b?(a.reckey=b,a.recname=g):(a.receptor=v,a.recname=g)),$.post(Pharmit.server,a,null,"json").done(function(a){a.status?(x(a.points),a.mol?(w=t,y=e,l(t,"mol2")&&o.test(e)&&(e=e.replace(o,"")),d.setLigand(e,t)):d.setView()):alert("Error: "+a.msg)}).fail(function(e,t){alert("parsererror"==t?"Didn't understand the the server resonse.  If you can reproduce this error, please send your input files to "+Pharmit.email+".":"Error contacting server.  Please inform "+Pharmit.email+" if this problem persists.")})},k=function(e,t){if(e&&t){v=e,g=t,d.setReceptor(e,t),b=null;var a=Pharmit.hex_md5(v);$.post(Pharmit.server,{cmd:"setreceptor",key:a,receptor:v}).done(function(){b=a})}};this.setLigandAndReceptor=function(e,t,a,n){a&&k(a,n),S(e,t)};var P=function(){var e=h.children().detach();e.sort(function(e,t){var a=e.feature.obj,n=t.feature.obj;return a.enabled!=n.enabled?n.enabled-a.enabled:a.name!=n.name?a.name.localeCompare(n.name):a.radius-n.radius}),h.append(e)},M=this.loadSession=function(e){var t=e;"string"==typeof e&&(t=$.parseJSON(e)),x(t.points),k(t.receptor,t.recname),d.setReceptor(v,g),t.sdf?(y=decodeURIComponent(t.sdf),w=y.match(/^@<TRIPOS>MOLECULE/)?".mol2":y.match(/^HETATM/)||y.match(/^ATOM/)?".pdb":y.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/)?".sdf":".xyz"):(y=t.ligand,w=t.ligandFormat),d.setLigand(y,w),$.each(t,function(e,t){var a=$("input[name="+e+"]");a.length?a.val(t).change():(a=$("select[name="+e+"]"),a.length?a.val(t).change():(a=$("button[name="+e+"]"),a.length&&a.val(t).change()))}),$.each($(".ui-buttonset",c),function(e,a){var n=a.id;if(t[n]){var i="#"+t[n];$(i).prop("checked",!0).change()}}),d.setView(t.view)},F=function(e){var t={};return t.points=[],$.each(h.children(),function(e,a){t.points.push(a.feature.obj)}),$.each(u.children(),function(e,a){t.points.push(a.feature.obj)}),$.each(m.children(),function(e,a){t.points.push(a.feature.obj)}),$.each($("[name]",c),function(e,a){var n=a.name;if(n){var i=a.value;$.isNumeric(a.value)&&(i=Number(a.value)),t[n]=i}}),$.each($(".ui-buttonset",c),function(e,a){var n=a.id;if(n&&n.length>0){var i=$(":checked",a).attr("id");t[n]=i}}),t.ligand=y,t.ligandFormat=w,b&&e||(t.receptor=v),t.recname=g,t.receptorid=b,t.view=d.getView(),t},R=function(){Pharmit.inFormSubmit=!0;var e=Pharmit.server+'?cmd=savedata&type="text%2Fphjson"&fname="pharmit.json"',t=$("<form>",{action:e,method:"post"}),a=F(!1);t.append($("<input>",{name:"data",type:"hidden",value:JSON.stringify(a,null,4)})),t.appendTo(document.body),t.submit(),$(t).remove()},A=function(e){return $("<div/>").text(e).html()},z=function(e){var t=F(!0),a=e.meshstyle.kind,n={cmd:"getmesh",type:a,json:JSON.stringify(t)};(null===e.mesh||e.meshtolerance!=e.val())&&$.post(Pharmit.server,n,null,"json").done(function(t){(t.tolerance==e.val()||null===e.mesh)&&(e.mesh&&d.removeMesh(e.mesh),e.mesh=d.addMesh(t,e.meshstyle),e.meshtolerance=t.tolerance)})},D=function(e){var t=$("<div>").appendTo(e);$("<div>Shape</div>").appendTo(t).addClass("pharmit_heading");var a=$("<div>").appendTo(t).addClass("pharmit_shapeconstraints"),n=($('<h3 id="inshapehead">Inclusive Shape<br></h3>').appendTo(a),$('<div id="pharmit_inclusiveshape">').appendTo(a)),o=null,s=$("<div>").appendTo(n),l=$('<select name="inselect" id="inselect">').addClass("pharmit_shapeselector").appendTo(s);$('<option value="none">None</option>').appendTo(l),$('<option value="ligand">Ligand</option>').appendTo(l),$('<option value="points">Spheres</option>').appendTo(l),l.val("none"),l.selectmenu({width:"14em",appendTo:s,change:function(){l.change()},position:{my:"left top",at:"left bottom",collision:"flip"}});var p=$('<div id="none-indiv">').appendTo(n);$("<div>No inclusive shape will be used to filter pharmacophore matches.</div>").appendTo(p).addClass("pharmit_shapedesc pharmit_shapefiltertext"),$("<div>No inclusive shape will be used for shape screening.</div>").appendTo(p).addClass("pharmit_shapedesc pharmit_shapesearchtext");var c=$('<div id="ligand-indiv">').appendTo(n);$("<div>At least one heavy atom in a pharmacophore aligned pose must fall within the inclusive shape.</div>").appendTo(c).addClass("pharmit_shapedesc pharmit_shapefiltertext"),$("<div>The entirety of the inclusive shape must be contained within the aligned hit.</div>").appendTo(c).addClass("pharmit_shapedesc pharmit_shapesearchtext");var h=$("<table>").appendTo(c),f=$("<tr>").appendTo(h);$("<td>").append('<label title="Depth in Angstroms to reduce surface of ligand inclusive shape by." value = "1" for="intolerance">Tolerance:</label>').appendTo(f),o=$("<td>").appendTo(f).addClass("pharmit_shapecell");var v=$('<input id="intolerance" name="intolerance">').appendTo(o);v.mesh=null,v.meshstyle={kind:"inclusive"},v.change(function(){z(v)}),v.spinner({step:.5,stop:function(){v.change()}}),v.val(1);var g=$('<div id="inshapestyle">').appendTo(c).addClass("pharmit_meshstylediv");$('<input type="radio" id="inshapestyle-hide" name="inshapestyle"><label for="inshapestyle-hide">Hide</label>').appendTo(g).change(function(){$(this).prop("checked")&&(v.meshstyle.hidden=!0,d.updateMesh(v.mesh,v.meshstyle)),g.buttonset("refresh")}),$('<input type="radio" id="inshapestyle-wire" name="inshapestyle"><label for="inshapestyle-wire">Wire</label>').appendTo(g).change(function(){$(this).prop("checked")&&(v.meshstyle.hidden=!1,v.meshstyle.wireframe=!0,d.updateMesh(v.mesh,v.meshstyle)),g.buttonset("refresh")}),$('<input type="radio" id="inshapestyle-solid" name="inshapestyle"><label for="inshapestyle-solid">Solid</label>').appendTo(g).change(function(){$(this).prop("checked")&&(v.meshstyle.hidden=!1,v.meshstyle.wireframe=!1,d.updateMesh(v.mesh,v.meshstyle)),g.buttonset("refresh")}).prop("checked",!0),g.buttonset();var b=$('<div id="points-indiv">').appendTo(n);$("<div>At least one heavy atom center of a pharmacophore aligned pose must fall within <b>each</b> sphere.</div>").appendTo(b).addClass("pharmit_shapedesc pharmit_shapefiltertext"),$("<div>The entirety of the interaction point shapes must be contained within the aligned hit.</div>").appendTo(b).addClass("pharmit_shapedesc pharmit_shapesearchtext"),u=$("<div>").appendTo(b),u.accordion({header:"> div > h3",animate:!0,active:!1,collapsible:!0,heightStyle:"content",beforeActivate:function(e,t){var a=null,n=u.children();$.each(n,function(e,t){t.feature.deselectFeature()}),t.newHeader.length>0&&(a=t.newHeader.parent(),a.get(0).feature.selectFeature())}}).sortable({axis:"y",handle:"h3",stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),$(this).accordion("refresh")}});var y=$('<div class="pharmit_pointsbuttons">').appendTo(b),w=$("<button>Add</button>").appendTo(y).button({text:!0,icons:{secondary:"ui-icon-circle-plus"}}).click(function(){new Feature(d,u,i,Feature.INCLUSIVESHAPE)});l.change(function(){p.hide(),c.hide(),b.hide(),"ligand"==this.value?($.each(u.children(),function(e,t){t.feature.hideFeature()}),c.show(),$("#inshapehead").addClass("pharmit_oblique"),v.change()):"points"==this.value?($.each(u.children(),function(e,t){t.feature.unhideFeature()}),$("#inshapehead").addClass("pharmit_oblique"),b.show(),v.mesh&&d.removeMesh(v.mesh),v.mesh=null):($.each(u.children(),function(e,t){t.feature.hideFeature()}),$("#inshapehead").removeClass("pharmit_oblique"),p.show(),v.mesh&&d.removeMesh(v.mesh),v.mesh=null),l.selectmenu("refresh")}),l.change();var T=($('<h3 id="exshapehead">Exclusive Shape<br></h3>').appendTo(a),$('<div id="pharmit_exclusiveshape">').appendTo(a)),_=$("<div>").appendTo(T),C=$('<select name="exselect" id="exselect">').addClass("pharmit_shapeselector").appendTo(_);$('<option value="none">None</option>').appendTo(C),$('<option value="receptor">Receptor</option>').appendTo(C),$('<option value="points">Spheres</option>').appendTo(C),C.val("none"),C.selectmenu({width:"11em",appendTo:_,change:function(){C.change()},position:{my:"left top",at:"left bottom",collision:"flip"}});var x=$('<div id="none-exdiv">').appendTo(T);$("<div>No exclusive shape constraint will be applied.</div>").appendTo(x).addClass("pharmit_shapedesc");var S=$('<div id="receptor-exdiv">').appendTo(T),k=$("<div>").appendTo(S).addClass("pharmit_shapedesc pharmit_shapefiltertext");k.text("Hits that have heavy atom centers within the exclusive shape in their pharmacophore aligned pose will be filtered out.");var P=$("<div>").appendTo(S).addClass("pharmit_shapedesc pharmit_shapesearchtext");P.text("Aligned hits may not overlap any portion of the exclusive shape.");var M=$("<table>").appendTo(S),F=$("<tr>").appendTo(M);$("<td>").append('<label title="Depth in Angstroms to reduce surface of receptor exclusive shape by." value = "1" for="extolerance">Tolerance:</label>').appendTo(F),o=$("<td>").appendTo(F).addClass("pharmit_shapecell");var R=$('<input id="extolerance" name="extolerance">').appendTo(o).val(1);R.mesh=null,R.meshstyle={kind:"exclusive"},R.change(function(){z(R)}),R.spinner({step:.5,stop:function(){R.change()}});var A=$('<div id="exshapestyle">').appendTo(S).addClass("pharmit_meshstylediv");$('<input type="radio" id="exshapestyle-hide" name="exshapestyle"><label for="exshapestyle-hide">Hide</label>').appendTo(A).change(function(){$(this).prop("checked")&&(R.meshstyle.hidden=!0,d.updateMesh(R.mesh,R.meshstyle)),A.buttonset("refresh")}),$('<input type="radio" id="exshapestyle-wire" name="exshapestyle"><label for="exshapestyle-wire">Wire</label>').appendTo(A).change(function(){$(this).prop("checked")&&(R.meshstyle.hidden=!1,R.meshstyle.wireframe=!0,d.updateMesh(R.mesh,R.meshstyle)),A.buttonset("refresh")}),$('<input type="radio" id="exshapestyle-solid" name="exshapestyle"><label for="exshapestyle-solid">Solid</label>').appendTo(A).change(function(){$(this).prop("checked")&&(R.meshstyle.hidden=!1,R.meshstyle.wireframe=!1,d.updateMesh(R.mesh,R.meshstyle)),A.buttonset("refresh")}).prop("checked",!0),A.buttonset();var D=$('<div id="points-exdiv">').appendTo(T);$("<div>Heavy atom centers of pharmacophore aligned poses may not fall within any exclusion sphere.</div>").appendTo(D).addClass("pharmit_shapedesc pharmit_shapefiltertext"),$("<div>Aligned hits may not overlap any exclusion sphere.</div>").appendTo(D).addClass("pharmit_shapedesc pharmit_shapesearchtext"),m=$("<div>").appendTo(D),m.accordion({header:"> div > h3",animate:!0,active:!1,collapsible:!0,heightStyle:"content",beforeActivate:function(e,t){var a=null,n=m.children();$.each(n,function(e,t){t.feature.deselectFeature()}),t.newHeader.length>0&&(a=t.newHeader.parent(),a.get(0).feature.selectFeature())}}).sortable({axis:"y",handle:"h3",stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),$(this).accordion("refresh")
}}),y=$('<div class="pharmit_pointsbuttons">').appendTo(D),w=$("<button>Add</button>").appendTo(y).button({text:!0,icons:{secondary:"ui-icon-circle-plus"}}).click(function(){new Feature(d,m,r,Feature.EXCLUSIVESHAPE)}),C.change(function(){"receptor"==this.value?($.each(m.children(),function(e,t){t.feature.hideFeature()}),x.hide(),D.hide(),S.show(),R.change(),$("#exshapehead").addClass("pharmit_oblique")):"points"==this.value?($.each(m.children(),function(e,t){t.feature.unhideFeature()}),x.hide(),S.hide(),D.show(),$("#exshapehead").addClass("pharmit_oblique"),R.mesh&&d.removeMesh(R.mesh),R.mesh=null):($.each(m.children(),function(e,t){t.feature.hideFeature()}),$("#exshapehead").removeClass("pharmit_oblique"),x.show(),D.hide(),S.hide(),R.mesh&&d.removeMesh(R.mesh),R.mesh=null),C.selectmenu("refresh")}),C.change(),a.accordion({animate:!0,active:!1,collapsible:!0,heightStyle:"content"})},H=function(e){var t=$("<div>").appendTo(e);$("<div>Filters</div>").appendTo(t).addClass("pharmit_heading");var a=$("<div>").appendTo(t),n=$("<h3>Hit Reduction<br></h3>").appendTo(a),i=$("<div>").addClass("pharmit_hitreduction").appendTo(a),r=$("<table>").appendTo(i),o=function(){""!==$("#reduceorienttext").val()||""!==$("#reduceconfstext").val()||""!==$("#reducehitstext").val()?n.addClass("pharmit_filtermodified"):n.removeClass("pharmit_filtermodified")},s=$("<tr>").addClass("pharmit_filterrow").appendTo(r);$("<td>").append('<label title="Maximum number of orientations returned for each conformation" value="1" for="reduceorienttext">Max Hits per Conf:</label>').appendTo(s);var l=$("<td>").appendTo(s);$('<input id="reduceorienttext" name="max-orient">').appendTo(l).spinner({min:0,stop:o}).change(o),s=$("<tr>").addClass("pharmit_filterrow").appendTo(r),$("<td>").append('<label title="Maximum number of conformations returned for each compound" value="1" for="reduceconfstext">Max Hits per Mol:</label>').appendTo(s),l=$("<td>").appendTo(s),$('<input id="reduceconfstext" name="reduceConfs">').appendTo(l).spinner({min:0,stop:o}).change(o),s=$("<tr>").addClass("pharmit_filterrow").appendTo(r),$("<td>").append('<label title="Maximum number of hits returned" value="1" for="reducehitstext">Max Total Hits:</label>').appendTo(s),l=$("<td>").appendTo(s),$('<input id="reducehitstext" name="max-hits">').appendTo(l).spinner({min:0,stop:o}).change(o);var d=$("<h3>Hit Screening<br></h3>").appendTo(a),p=$("<div>").appendTo(a).addClass("pharmit_hitscreening"),c=$("<table>").appendTo(p),h=function(){var e=!0;$("[name]",p).each(function(t,a){""!==a.value&&(e=!1)}),e?d.removeClass("pharmit_filtermodified"):d.addClass("pharmit_filtermodified")},u=function(e,t,a,n){var i=$("<tr>").addClass("pharmit_filterrow").appendTo(c),r=$("<td>").appendTo(i);$('<input name="min'+e+'">').appendTo(r).spinner({min:n,stop:h}).change(h),$("<td>").appendTo(i).append($('<label title="'+a+'" value="1" >&le;  '+t+" &le;</label>")),r=$("<td>").appendTo(i),$('<input name="max'+e+'">').appendTo(r).spinner({min:n,stop:h}).change(h)};u("MolWeight","MolWeight","Minimum/maximum molecular weight (weights are approximate)",0),u("rotbonds","RotBonds","Minimum/maximum number of rotatable bonds",0),u("logp","LogP","Minimum/maximum partition coefficient as calculated by OpenBabel"),u("psa","PSA","Minimum/maximum polar surface area as calculated by OpenBabel"),u("aromatics","Aromatics","Minimum/maximum number of smallest aromatic rings",0),u("hba","HBA","Minimum/maximum number of hydrogen bond acceptors",0),u("hbd","HBD","Minimum/maximum number of hydrogen bond donors",0),a.accordion({animate:!0,active:!1,collapsible:!0,heightStyle:"content"})},N=function(e){var a="ShapeModeSelect",n=$("<div>").prependTo(e).addClass("pharmit_shapemodediv"),i=$('<button name="'+a+'" id="'+a+' value="filter">Pharmacophore Search -&gt; Shape Filter</button>').addClass("pharmit_styleselector").appendTo(n);t="filter",i.button(),i.change(function(){t=this.value,"search"==t?(i.button("option","label","Shape Search -&gt; Pharmacophore Filter"),$(".pharmit_shapefiltertext").hide(),$(".pharmit_shapesearchtext").show()):(t="filter",i.button("option","label","Pharmacophore Search -&gt; Shape Filter"),$(".pharmit_shapefiltertext").show(),$(".pharmit_shapesearchtext").hide()),i.button("refresh")}),i.val("filter"),i.change(),i.click(function(){this.value="filter"==this.value?"search":"filter",i.change()})},E=function(e,t){var a=t.standard,i=$("<div>").addClass("pharmit_searchdiv"),r=$('<button id="pharmitsearchbutton" name="subset">Search '+a[0].name+"</button>").appendTo(i).button(),o=$("<button>Select subset to search</button>").appendTo(i).button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}});o.tooltip().tooltip("disable"),r.val(a[0].subdir),i.buttonset();var l,d,p,c=$("<ul>").appendTo($("body")).addClass("pharmit_floatmenu"),h=[];for(l=0,n=a.length;l<n;l++)d=a[l],p=A(d.name),d.html&&(p=d.html),h[l]="<li value="+l+' class="pharmit_subsetmenu">'+p+"<br>",h[l]+='<span class="pharmit_subsetcnts">'+numeral(d.numConfs).format("0,0")+" conformers of "+numeral(d.numMols).format("0,0")+" molecules</span>",h[l]+='<span class="pharmit_subsettime">Updated: '+d.updated+"</span>",h[l]+="</li>","molport"==d.subdir&&(r.button("option","label","Search "+d.name),r.val(d.subdir));c.append(h),c.append($("<li> </li>"));var u=$('<li class="pharmit_contributed">Contributed Libraries</li>'),m=$("<ul>").appendTo(u).addClass("pharmit_contributed_menu"),f=[],v=t["public"];for(l=0,n=v.length;l<n;l++){d=v[l],p=A(d.name);var g="";d.description&&(g=" title='"+A(d.description)+"' "),f[l]="<li value="+a.length+g+' class="pharmit_subsetmenu">'+p+"<br>",a.push(d),f[l]+='<span class="pharmit_subsetcnts">'+numeral(d.numConfs).format("0,0")+" conformers of "+numeral(d.numMols).format("0,0")+" molecules</span>",f[l]+='<span class="pharmit_subsettime">Created: '+d.updated+"</span>",f[l]+="</li>"}m.append(f),c.append(u),c.append($("<li> </li>")),$('<li class="pharmit_private">Access Private Library</li>').appendTo(c).click(function(){s.dialog("open")}),c.hide().menu({position:{my:"left top",at:"right top",collision:"fit"}}).on("menuselect",function(e,t){var n=a[t.item.val()];r.button("option","label","Search "+n.name),r.val(n.subdir)}),r.click(T),r.change(function(){var e,t,n=r.val();for(e=0,t=a.length;t>e;e++)if(d=a[e],d.subdir==n){r.button("option","label","Search "+d.name);break}e==t&&r.button("option","label","Unknown Subset")}),o.click(function(){var e=c.show().position({my:"left top",at:"left bottom",of:this,collision:"flipfit"});return $(document).one("click",function(){e.hide()}),!1}),e.prepend(i)},j=$("<div>").appendTo(c).addClass("pharmit_leftclose"),I=$("<span>").addClass("ui-icon ui-icon-carat-1-w").appendTo(j);c.resizable({handles:"e",resize:function(e,t){d.setLeft(t.size.width)}}),c.disableSelection(),j.click(function(){if(j.hasClass("pharmit_leftisclosed")){j.removeClass("pharmit_leftisclosed"),I.removeClass("ui-icon-carat-1-e"),I.addClass("ui-icon-carat-1-w");var e=c.width();c.css("width","");var t=c.width();c.width(e),c.animate({width:t},{progress:function(){d.setLeft(c.width())}}),c.resizable("option","disabled",!1)}else c.animate({width:0},{progress:function(){d.setLeft(c.width())}}),j.addClass("pharmit_leftisclosed"),I.addClass("ui-icon-carat-1-e"),I.removeClass("ui-icon-carat-1-w"),c.resizable("option","disabled",!0)});var O=$("<div>").appendTo(c).addClass("pharmit_queryheader");$.post(Pharmit.server,{cmd:"getsubsets"},null,"json").done(function(e){E(O,e)}).fail(function(){E(O,{standard:[{name:"Error"}],"public":[]}),alert("Error contacting server.  Please inform "+Pharmit.email+" if this problem persists.")});var L=$("<div>").appendTo(O).addClass("pharmit_loaderdiv").addClass("pharmit_nowrap"),q=$("<button>Load Receptor...</button>").button(),V="Pharmacophore features can be provided as pharmacophore query formats (MOE, LigBuilder, LigandScout, Pharmer) or automatically extracted from ligand structures (sdf, pdf, mol2, xyz). If a receptor is loaded, only interacting features will be enabled.",B=$('<button title="'+V+'">Load Features...</button>').button();e.append(c);$('<input type="file">').appendTo(L).fileinput(q).change(function(){_(this,k)}),$('<input type="file">').appendTo(L).fileinput(B).change(function(){_(this,S)});c.detach();{var U=$("<div>").appendTo(c).addClass("pharmit_querybody");$("<div>Pharmacophore</div>").appendTo(U).addClass("pharmit_heading")}f=$("<div>").appendTo(U),h=$("<div>").appendTo(f),h.accordion({header:"> div > h3",animate:!0,active:!1,collapsible:!0,heightStyle:"content",beforeActivate:function(e,t){var a=null,n=h.children();$.each(n,function(e,t){t.feature.deselectFeature()}),t.newHeader.length>0&&(a=t.newHeader.parent(),a.get(0).feature.selectFeature())}}).sortable({axis:"y",handle:"h3",stop:function(e,t){t.item.children("h3").triggerHandler("focusout"),$(this).accordion("refresh")}});{var W=$("<div>").appendTo(f).addClass("pharmit_featurebuttons");$("<button>Add</button>").appendTo(W).button({text:!0,icons:{secondary:"ui-icon-circle-plus"}}).click(function(){new Feature(d,h,a)}),$("<button>Sort</button>").appendTo(W).button({text:!0,icons:{secondary:"ui-icon ui-icon-carat-2-n-s"}}).click(P)}D(U),H(U),N(O);var X=$("<div>").appendTo(U);$("<div>Visualization</div>").appendTo(X).addClass("pharmit_heading");var J=$("<div>").appendTo(X).addClass("pharmit_vizdiv");d.appendViewerControls(J);var G=$("<div>").appendTo(c).addClass("pharmit_queryfooter"),Q=$("<div>").appendTo(G).addClass("pharmit_bottomloaders").addClass("pharmit_nowrap");e.append(c);{var Y=$("<button>Load Session...</button>").button();$('<input type="file">').appendTo(Q).fileinput(Y).change(function(){_(this,M)}),$("<button>Save Session...</button>").appendTo(Q).button().click(R)}d.setLeft(c.width()),s=$('<div class="pharmit_private_dialog" title="Access Private Library">Enter your access code: </div>').appendTo(U),$('<input type="text" id="privateid" class="pharmit_privatetext">').appendTo(s),s.dialog({autoOpen:!1,height:125,width:400,modal:!0,buttons:{Submit:function(){$.post(Pharmit.server,{cmd:"getsubsets",subset:"Private/"+$("#privateid").val()},null,"json").done(function(e){if(e.error)alert(e.error);else{var t=$("#pharmitsearchbutton");t.button("option","label","Search "+e.name),t.val(e.subdir)}}).fail(function(){alert("Error contacting server.  Please inform "+Pharmit.email+" if this problem persists.")}),s.dialog("close")},Cancel:function(){s.dialog("close")}}})}var t="filter",a={name:"Hydrophobic",x:0,y:0,z:0,radius:1,enabled:!0,vector_on:0,minsize:"",maxsize:"",svector:null,hasvec:!1},i={name:"InclusionSphere",x:0,y:0,z:0,radius:1,enabled:!0,vector_on:0,minsize:"",maxsize:"",svector:null,hasvec:!1},r={name:"ExclusionSphere",x:0,y:0,z:0,radius:1,enabled:!0,vector_on:0,minsize:"",maxsize:"",svector:null,hasvec:!1},o=/@<TRIPOS>MOLECULE[^@]*?@<TRIPOS>ATOM\n(\s*\d+\s*(ACC|DON|CAT|ANI|HYD|AR).*)*\n@<TRIPOS>BOND\n/g,s=null,l=function(e,t){return-1!==e.indexOf(t,e.length-t.length)};return e}();var Pharmit=Pharmit||{};Pharmit.Results=function(){function e(e,t){var a=this.div=$("<div>").addClass("pharmit_results pharmit_overlay").appendTo(e),n=null,i=null,r=null;this.phquery=function(e,t){n.cancel(),i.cancel(),i.hide(),n.query(e,t),this.show()},this.shquery=function(e,t){i.cancel(),n.cancel(),n.hide(),i.query(e,t),this.show()},this.show=function(){a.show(),t.setRight(a.width())},this.close=function(){a.hide(),t.setRight(0)};var o=function(e){var t=null;return(t=e.match(/PubChem-?(\d+)/))?"https://pubchem.ncbi.nlm.nih.gov/compound/"+t[1]:(t=e.match(/MolPort-?(\S+)/))?"https://www.molport.com/shop/moleculelink/about-this-molecule/"+t[1].replace(/-/g,""):(t=e.match(/^CHEMBL/))?"https://www.ebi.ac.uk/chembldb/index.php/compound/inspect/"+e:(t=e.match(/ChemDiv-?(\S+)/))?"http://chemistryondemand.com:8080/eShop/search_results.jsp?idnumber="+t[1]:(t=e.match(/ZINC(\d+)/))?"http://zinc15.docking.org/substances/"+t[1]:null};this.mangleName=function(e){for(var t=e.split(" "),a="",n=0;n<t.length;n++){var i=t[n],r=o(i);a+=r?"<a target='_blank' href='"+r+"'>"+i+"</a><br>":i+"<br>"}var s='<span data-powertip="'+a+'">'+t[0]+"</span>";return s};var s=$("<div>").appendTo(a).addClass("pharmit_rightclose"),l=$("<span>").addClass("ui-icon ui-icon-carat-1-e").appendTo(s);a.resizable({handles:"w",resize:function(e,a){t.setRight(a.size.width),$(this).css("left","")}}),a.disableSelection(),s.click(function(){if(s.hasClass("pharmit_rightisclosed")){s.removeClass("pharmit_rightisclosed"),l.removeClass("ui-icon-carat-1-w"),l.addClass("ui-icon-carat-1-e");var e=a.width();a.css("width","");var n=a.width();a.width(e),a.animate({width:n},{progress:function(){t.setRight(a.width())}}),a.resizable("option","disabled",!1)}else a.animate({width:0},{progress:function(){t.setRight(a.width())}}),s.addClass("pharmit_rightisclosed"),l.addClass("ui-icon-carat-1-w"),l.removeClass("ui-icon-carat-1-e"),a.resizable("option","disabled",!0)}),r=new Pharmit.MinResults(this,t),n=new Pharmit.SearchResults(this,t,r),n.hide(),i=new Pharmit.SearchResults(this,t,r,"shape"),i.hide(),a.hide(),a.is(":visible")&&t.setRight(a.width()),$(window).on("beforeunload",function(){Pharmit.inFormSubmit?Pharmit.inFormSubmit=!1:n.cancel()})}return e}();var Pharmit=Pharmit||{};Pharmit.SearchResults=function(){function e(e,t,a,n){var i=null,r=null,o=null,s=null,l=null,d=null,p=null,c=null,h=e,u=null,m=new Date,f=function(e){if(0===e.status)return{error:e.msg};for(var t=e.data,a=0;a<t.length;a++)t[a][1]=numeral(t[a][1]).format("0.000"),t[a][0]=h.mangleName(t[a][0]);return t},v=0,g=0,b=function(){if(r>0){var e=l.height();if(e!=v){v=e,e-=$("thead",s).height(),e-=$(".dataTables_info",l).height(),e-=$(".dataTables_paginate",l).height(),e-=24;var t=$("tr.odd",s).first().height()+1,a=Math.floor(e/t);a!=g&&(s.DataTable().page.len(a),s.DataTable().draw(),g=a)}}};$.fn.DataTable.ext.pager.numbers_length=5,this.query=function(e,t){o=$.extend({},e),u=t;var a={cmd:"startquery",json:JSON.stringify(o)};null!==r&&(a.oldqid=r),m=new Date,$.post(Pharmit.server,a,null,"json").done(function(e){if(e.status){r=e.qid;var t=Math.floor((l.height()-120)/28);s.dataTable({searching:!1,pageLength:t,destroy:!0,lengthChange:!1,order:"shape"==n?[[1,"desc"]]:[[1,"asc"]],orderMulti:!1,columnDefs:[{targets:[0],className:"pharmit_namecol",searchable:!1,sortable:!1},{targets:[1],className:"pharmit_rmsdcol",searchable:!1},{targets:[2],className:"pharmit_masscol",searchable:!1},{targets:[3],className:"pharmit_bondscol",searchable:!1},{targets:[4],visible:!1}],language:{emptyTable:"<span class='pharmit_pulse'>Searching "+numeral(e.numMols).format("0,0")+" molecules and "+numeral(e.numConfs).format("0,0")+" conformers...</span>",infoFiltered:"",infoEmpty:"",info:"<span class='pharmit_pulse'>Searching...</span>"},serverSide:!0,processing:!1,ajax:{url:Pharmit.server,data:{cmd:"getdata",qid:r},dataSrc:f}})}else y(),h.close(),alert("Error: "+e.msg)}).fail(function(){y(),h.close(),alert("Error contacting server.  Please inform "+Pharmit.email+" if this problem persists.")}),i.show()},this.hide=function(){i.hide()},this.show=function(){i.show(),s.DataTable().ajax.reload()};var y=this.cancel=function(){a.cancel(),clearTimeout(c),null!==r&&$.post(Pharmit.server,{cmd:"cancelquery",oldqid:r}),$.fn.DataTable.isDataTable(s)&&s.DataTable().clear(),r=null,d.button("option","disabled",!0),p.button("option","disabled",!0)},w=function(){var e=Pharmit.server+"?cmd=saveres&qid="+r,t=$("<form>",{action:e,method:"post"});t.appendTo(document.body),Pharmit.inFormSubmit=!0,t.submit(),$(t).remove()},T=function(){i.hide();var e=s.DataTable().ajax.json().recordsTotal,t=$.extend({},o);t.receptor=u,a.minimize(r,t,e,function(){i.show(),s.DataTable().ajax.reload()})};i=$("<div>").appendTo(h.div).addClass("pharmit_rescontainer");var _=$("<div>").appendTo(i).addClass("pharmit_resheader"),C="Pharmacophore Results";"shape"==n&&(C="Aligned Shape Results");{var x=$("<div>"+C+"</div>").appendTo(_).addClass("pharmit_heading").addClass("pharmit_rightheading"),S=$("<div>").addClass("pharmit_resclose").appendTo(x).click(function(){y(),h.close()});$("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(S)}l=$("<div>").appendTo(i).addClass("pharmit_resbody"),s=$('<table width="100%" class="display compact" cellspacing="0">').addClass("pharmit_phtable").appendTo(l);var k=$("<tr>").appendTo($("<thead>").appendTo(s));$("<th>Name</th>").appendTo(k),"shape"==n?$("<th>Sim</th>").appendTo(k):$("<th>RMSD</th>").appendTo(k),$("<th>Mass</th>").appendTo(k),$("<th>RBnds</th>").appendTo(k),$("<th>mid</th>").appendTo(k),$("<tbody>").appendTo(s),s.on("xhr.dt",function(e,a,n){if(n.finished){var i=s.DataTable().settings()[0].oLanguage,l=(new Date-m)/1e3;0===n.recordsTotal?i.emptyTable=i.sEmptyTable="No results found":(i.sInfo="<span title='Query took "+l+" seconds'>Showing _START_ to _END_ of _TOTAL_ hits",n.benchmark&&(i.sInfo+=". EF: "+numeral(n.benchmark.EF).format("0.0"),i.sInfo+=", F1: "+numeral(n.benchmark.F1).format("0.00")),i.sInfo+="</span>",d.button("option","disabled",!1),p.button("option","disabled",!1),p.one("click",function(){ga("send","event","save","pharmacophore",o.subset,n.recordsTotal)}))}else 0===n.status||(t.setResult(),clearTimeout(c),c=setTimeout(function(){r>0&&s.DataTable().ajax.reload()},1e3))}),s.on("draw.dt",function(){$(".pharmit_namecol span").powerTip({mouseOnToPopup:!0,placement:"s",smartPlacement:!0})}),$("tbody",s).on("click","tr",function(){var e=this,a=s.DataTable().row(e).data()[4];$(".pharmit_iterate_button").remove(),$(e).hasClass("selected")?($(e).removeClass("selected"),t.setResult()):(s.DataTable().$("tr.selected").removeClass("selected"),$(e).addClass("selected"),$.post(Pharmit.server,{cmd:"getmol",qid:r,loc:a}).done(function(n){if($(e).hasClass("selected")){t.setResult(n);var i=$('<div class="pharmit_iterate_button" title="Start new pharmit session around selected ligand">').appendTo($("td",e).last());i.button({icons:{primary:"ui-icon-arrowthickstop-1-e"},text:!1}),i.tooltip({show:{delay:500}}),i.click(function(e){e.stopPropagation();{var t=window.open("search.html"),i={ligand:n,ligandFormat:a+".sdf",receptor:u,recname:o.recname};new Message(JSON.stringify(i),t,"*")}})}}))});var P=$("<div>").appendTo(i).addClass("pharmit_resfooter"),M=$("<div>").appendTo(P).addClass("pharmit_bottomloaders").addClass("pharmit_nowrap");d=$("<button>Minimize</button>").appendTo(M).button({disabled:!0}).click(T),p=$("<button>Save...</button>").appendTo(M).button({disabled:!0}).click(w),$(window).resize(b)}return e}(),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&"object"==typeof module?module.exports=e:e(jQuery)}(function(e,t){"use strict";function a(t,a,n,i){for(var r=[],o=0;o<t.length;o++){var s=t[o];if(s){var l=tinycolor(s),d=l.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";d+=tinycolor.equals(a,s)?" sp-thumb-active":"";var p=l.toString(i.preferredFormat||"rgb"),c=f?"background-color:"+l.toRgbString():"filter:"+l.toFilter();r.push('<span title="'+p+'" data-color="'+l.toRgbString()+'" class="'+d+'"><span class="sp-thumb-inner" style="'+c+';" /></span>')}else{var h="sp-clear-display";r.push(e("<div />").append(e('<span data-color="" style="background-color:transparent;" class="'+h+'"></span>').attr("title",i.noColorSelectedText)).html())}}return"<div class='sp-cf "+n+"'>"+r.join("")+"</div>"}function n(){for(var e=0;e<u.length;e++)u[e]&&u[e].hide()}function i(t,a){var n=e.extend({},h,t);return n.callbacks={move:d(n.move,a),change:d(n.change,a),show:d(n.show,a),hide:d(n.hide,a),beforeShow:d(n.beforeShow,a)},n}function r(r,s){function d(){if(U.showPaletteOnly&&(U.showPalette=!0),Nt.text(U.showPaletteOnly?U.togglePaletteMoreText:U.togglePaletteLessText),U.palette){ct=U.palette.slice(0),ht=e.isArray(ct[0])?ct:[ct],ut={};for(var t=0;t<ht.length;t++)for(var a=0;a<ht[t].length;a++){var n=tinycolor(ht[t][a]).toRgbString();ut[n]=!0}}wt.toggleClass("sp-flat",W),wt.toggleClass("sp-input-disabled",!U.showInput),wt.toggleClass("sp-alpha-enabled",U.showAlpha),wt.toggleClass("sp-clear-enabled",Gt),wt.toggleClass("sp-buttons-disabled",!U.showButtons),wt.toggleClass("sp-palette-buttons-disabled",!U.togglePaletteOnly),wt.toggleClass("sp-palette-disabled",!U.showPalette),wt.toggleClass("sp-palette-only",U.showPaletteOnly),wt.toggleClass("sp-initial-disabled",!U.showInitial),wt.addClass(U.className).addClass(U.containerClassName),I()}function h(){function t(t){return t.data&&t.data.ignore?(A(e(t.target).closest(".sp-thumb-el").data("color")),H()):(A(e(t.target).closest(".sp-thumb-el").data("color")),H(),j(!0),U.hideAfterPaletteSelect&&F()),!1}if(m&&wt.find("*:not(input)").attr("unselectable","on"),d(),It&&yt.after(Ot).hide(),Gt||Dt.hide(),W)yt.after(wt).hide();else{var a="parent"===U.appendTo?yt.parent():e(U.appendTo);1!==a.length&&(a=e("body")),a.append(wt)}y(),Lt.bind("click.spectrum touchstart.spectrum",function(t){$t||k(),t.stopPropagation(),e(t.target).is("input")||t.preventDefault()}),(yt.is(":disabled")||U.disabled===!0)&&V(),wt.click(l),Ft.change(S),Ft.bind("paste",function(){setTimeout(S,1)}),Ft.keydown(function(e){13==e.keyCode&&S()}),zt.text(U.cancelText),zt.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),R(),F()}),Dt.attr("title",U.clearText),Dt.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),Jt=!0,H(),W&&j(!0)}),Ht.text(U.chooseText),Ht.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),D()&&(j(!0),F())}),Nt.text(U.showPaletteOnly?U.togglePaletteMoreText:U.togglePaletteLessText),Nt.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),U.showPaletteOnly=!U.showPaletteOnly,U.showPaletteOnly||W||wt.css("left","-="+(Tt.outerWidth(!0)+5)),d()}),p(Pt,function(e,t,a){pt=e/it,Jt=!1,a.shiftKey&&(pt=Math.round(10*pt)/10),H()},C,x),p(xt,function(e,t){st=parseFloat(t/at),Jt=!1,U.showAlpha||(pt=1),H()},C,x),p(_t,function(e,t,a){if(a.shiftKey){if(!gt){var n=lt*Z,i=et-dt*et,r=Math.abs(e-n)>Math.abs(t-i);gt=r?"x":"y"}}else gt=null;var o=!gt||"x"===gt,s=!gt||"y"===gt;o&&(lt=parseFloat(e/Z)),s&&(dt=parseFloat((et-t)/et)),Jt=!1,U.showAlpha||(pt=1),H()},C,x),Vt?(A(Vt),N(),Wt=Ut||tinycolor(Vt).format,$(Vt)):N(),W&&P();var n=m?"mousedown.spectrum":"click.spectrum touchstart.spectrum";Rt.delegate(".sp-thumb-el",n,t),At.delegate(".sp-thumb-el:nth-child(1)",n,{ignore:!0},t)}function y(){if(J&&window.localStorage){try{var t=window.localStorage[J].split(",#");t.length>1&&(delete window.localStorage[J],e.each(t,function(e,t){$(t)}))}catch(a){}try{mt=window.localStorage[J].split(";")}catch(a){}}}function $(t){if(X){var a=tinycolor(t).toRgbString();if(!ut[a]&&-1===e.inArray(a,mt))for(mt.push(a);mt.length>ft;)mt.shift();if(J&&window.localStorage)try{window.localStorage[J]=mt.join(";")}catch(n){}}}function w(){var e=[];if(U.showPalette)for(var t=0;t<mt.length;t++){var a=tinycolor(mt[t]).toRgbString();ut[a]||e.push(mt[t])}return e.reverse().slice(0,U.maxSelectionSize)}function T(){var t=z(),n=e.map(ht,function(e,n){return a(e,t,"sp-palette-row sp-palette-row-"+n,U)});y(),mt&&n.push(a(w(),t,"sp-palette-row sp-palette-row-selection",U)),Rt.html(n.join(""))}function _(){if(U.showInitial){var e=Bt,t=z();At.html(a([e,t],t,"sp-palette-row-initial",U))}}function C(){(0>=et||0>=Z||0>=at)&&I(),wt.addClass(vt),gt=null,yt.trigger("dragstart.spectrum",[z()])}function x(){wt.removeClass(vt),yt.trigger("dragstop.spectrum",[z()])}function S(){var e=Ft.val();if(null!==e&&""!==e||!Gt){var t=tinycolor(e);t.isValid()?(A(t),j(!0)):Ft.addClass("sp-validation-error")}else A(null),j(!0)}function k(){K?F():P()}function P(){var t=e.Event("beforeShow.spectrum");return K?void I():(yt.trigger(t,[z()]),void(Q.beforeShow(z())===!1||t.isDefaultPrevented()||(n(),K=!0,e(bt).bind("click.spectrum",M),e(window).bind("resize.spectrum",Y),Ot.addClass("sp-active"),wt.removeClass("sp-hidden"),I(),N(),Bt=z(),_(),Q.show(Bt),yt.trigger("show.spectrum",[Bt]))))}function M(e){2!=e.button&&(Xt?j(!0):R(),F())}function F(){K&&!W&&(K=!1,e(bt).unbind("click.spectrum",M),e(window).unbind("resize.spectrum",Y),Ot.removeClass("sp-active"),wt.addClass("sp-hidden"),Q.hide(z()),yt.trigger("hide.spectrum",[z()]))}function R(){A(Bt,!0)}function A(e,t){if(tinycolor.equals(e,z()))return void N();var a,n;!e&&Gt?Jt=!0:(Jt=!1,a=tinycolor(e),n=a.toHsv(),st=n.h%360/360,lt=n.s,dt=n.v,pt=n.a),N(),a&&a.isValid()&&!t&&(Wt=Ut||a.getFormat())}function z(e){return e=e||{},Gt&&Jt?null:tinycolor.fromRatio({h:st,s:lt,v:dt,a:Math.round(100*pt)/100},{format:e.format||Wt})}function D(){return!Ft.hasClass("sp-validation-error")}function H(){N(),Q.move(z()),yt.trigger("move.spectrum",[z()])}function N(){Ft.removeClass("sp-validation-error"),E();var e=tinycolor.fromRatio({h:st,s:1,v:1});_t.css("background-color",e.toHexString());var t=Wt;1>pt&&(0!==pt||"name"!==t)&&("hex"===t||"hex3"===t||"hex6"===t||"name"===t)&&(t="rgb");var a=z({format:t}),n="";if(qt.removeClass("sp-clear-display"),qt.css("background-color","transparent"),!a&&Gt)qt.addClass("sp-clear-display");else{var i=a.toHexString(),r=a.toRgbString();if(f||1===a.alpha?qt.css("background-color",r):(qt.css("background-color","transparent"),qt.css("filter",a.toFilter())),U.showAlpha){var o=a.toRgb();o.a=0;var s=tinycolor(o).toRgbString(),l="linear-gradient(left, "+s+", "+i+")";m?kt.css("filter",tinycolor(s).toFilter({gradientType:1},i)):(kt.css("background","-webkit-"+l),kt.css("background","-moz-"+l),kt.css("background","-ms-"+l),kt.css("background","linear-gradient(to right, "+s+", "+i+")"))}n=a.toString(t)}U.showInput&&Ft.val(n),U.showPalette&&T(),_()}function E(){var e=lt,t=dt;if(Gt&&Jt)Mt.hide(),St.hide(),Ct.hide();else{Mt.show(),St.show(),Ct.show();var a=e*Z,n=et-t*et;a=Math.max(-tt,Math.min(Z-tt,a-tt)),n=Math.max(-tt,Math.min(et-tt,n-tt)),Ct.css({top:n+"px",left:a+"px"});var i=pt*it;Mt.css({left:i-rt/2+"px"});var r=st*at;St.css({top:r-ot+"px"})}}function j(e){var t=z(),a="",n=!0;t&&(a=t.toString(Wt),$(t)),Et&&yt.val(a),e&&n&&(Q.change(t),yt.trigger("change",[t]))}function I(){Z=_t.width(),et=_t.height(),tt=Ct.height(),nt=xt.width(),at=xt.height(),ot=St.height(),it=Pt.width(),rt=Mt.width(),W||(wt.css("position","absolute"),wt.offset(U.offset?U.offset:o(wt,Lt))),E(),U.showPalette&&T(),yt.trigger("reflow.spectrum")}function O(){yt.show(),Lt.unbind("click.spectrum touchstart.spectrum"),wt.remove(),Ot.remove(),u[Qt.id]=null}function L(a,n){return a===t?e.extend({},U):n===t?U[a]:(U[a]=n,void d())}function q(){$t=!1,yt.attr("disabled",!1),Lt.removeClass("sp-disabled")}function V(){F(),$t=!0,yt.attr("disabled",!0),Lt.addClass("sp-disabled")}function B(e){U.offset=e,I()}var U=i(s,r),W=U.flat,X=U.showSelectionPalette,J=U.localStorageKey,G=U.theme,Q=U.callbacks,Y=c(I,10),K=!1,Z=0,et=0,tt=0,at=0,nt=0,it=0,rt=0,ot=0,st=0,lt=0,dt=0,pt=1,ct=[],ht=[],ut={},mt=U.selectionPalette.slice(0),ft=U.maxSelectionSize,vt="sp-dragging",gt=null,bt=r.ownerDocument,yt=(bt.body,e(r)),$t=!1,wt=e(b,bt).addClass(G),Tt=wt.find(".sp-picker-container"),_t=wt.find(".sp-color"),Ct=wt.find(".sp-dragger"),xt=wt.find(".sp-hue"),St=wt.find(".sp-slider"),kt=wt.find(".sp-alpha-inner"),Pt=wt.find(".sp-alpha"),Mt=wt.find(".sp-alpha-handle"),Ft=wt.find(".sp-input"),Rt=wt.find(".sp-palette"),At=wt.find(".sp-initial"),zt=wt.find(".sp-cancel"),Dt=wt.find(".sp-clear"),Ht=wt.find(".sp-choose"),Nt=wt.find(".sp-palette-toggle"),Et=yt.is("input"),jt=Et&&v&&"color"===yt.attr("type"),It=Et&&!W,Ot=It?e(g).addClass(G).addClass(U.className).addClass(U.replacerClassName):e([]),Lt=It?Ot:yt,qt=Ot.find(".sp-preview-inner"),Vt=U.color||Et&&yt.val(),Bt=!1,Ut=U.preferredFormat,Wt=Ut,Xt=!U.showButtons||U.clickoutFiresChange,Jt=!Vt,Gt=U.allowEmpty&&!jt;h();var Qt={show:P,hide:F,toggle:k,reflow:I,option:L,enable:q,disable:V,offset:B,set:function(e){A(e),j()},get:z,destroy:O,container:wt};return Qt.id=u.push(Qt)-1,Qt}function o(t,a){var n=0,i=t.outerWidth(),r=t.outerHeight(),o=a.outerHeight(),s=t[0].ownerDocument,l=s.documentElement,d=l.clientWidth+e(s).scrollLeft(),p=l.clientHeight+e(s).scrollTop(),c=a.offset();return c.top+=o,c.left-=Math.min(c.left,c.left+i>d&&d>i?Math.abs(c.left+i-d):0),c.top-=Math.min(c.top,c.top+r>p&&p>r?Math.abs(r+o-n):n),c}function s(){}function l(e){e.stopPropagation()}function d(e,t){var a=Array.prototype.slice,n=a.call(arguments,2);return function(){return e.apply(t,n.concat(a.call(arguments)))}}function p(t,a,n,i){function r(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function o(e){if(p){if(m&&d.documentMode<9&&!e.button)return l();var n=e.originalEvent&&e.originalEvent.touches,i=n?n[0].pageX:e.pageX,o=n?n[0].pageY:e.pageY,s=Math.max(0,Math.min(i-c.left,u)),v=Math.max(0,Math.min(o-c.top,h));f&&r(e),a.apply(t,[s,v,e])}}function s(a){var i=a.which?3==a.which:2==a.button;i||p||n.apply(t,arguments)!==!1&&(p=!0,h=e(t).height(),u=e(t).width(),c=e(t).offset(),e(d).bind(v),e(d.body).addClass("sp-dragging"),f||o(a),r(a))}function l(){p&&(e(d).unbind(v),e(d.body).removeClass("sp-dragging"),i.apply(t,arguments)),p=!1}a=a||function(){},n=n||function(){},i=i||function(){};var d=document,p=!1,c={},h=0,u=0,f="ontouchstart"in window,v={};v.selectstart=r,v.ragstart=r,v["touchmove mousemove"]=o,v["touchend mouseup"]=l,e(t).bind("touchstart mousedown",s)}function c(e,t,a){var n;return function(){var i=this,r=arguments,o=function(){n=null,e.apply(i,r)};a&&clearTimeout(n),(a||!n)&&(n=setTimeout(o,t))}}var h={beforeShow:s,move:s,change:s,show:s,hide:s,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},u=[],m=!!/msie/i.exec(window.navigator.userAgent),f=function(){function e(e,t){return!!~(""+e).indexOf(t)}var t=document.createElement("div"),a=t.style;return a.cssText="background-color:rgba(0,0,0,.5)",e(a.backgroundColor,"rgba")||e(a.backgroundColor,"hsla")}(),v=function(){var t=e("<input type='color' value='!' />")[0];return"color"===t.type&&"!"!==t.value}(),g=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),b=function(){var e="";if(m)for(var t=1;6>=t;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),y="spectrum.id";e.fn.spectrum=function(t){if("string"==typeof t){var a=this,n=Array.prototype.slice.call(arguments,1);return this.each(function(){var i=u[e(this).data(y)];if(i){var r=i[t];if(!r)throw new Error("Spectrum: no such method: '"+t+"'");
"get"==t?a=i.get():"container"==t?a=i.container:"option"==t?a=i.option.apply(i,n):"destroy"==t?(i.destroy(),e(this).removeData(y)):r.apply(i,n)}}),a}return this.spectrum("destroy").each(function(){var a=e.extend({},t,e(this).data()),n=r(this,a);e(this).data(y,n.id)})},e.fn.spectrum.load=!0,e.fn.spectrum.loadOpts={},e.fn.spectrum.draggable=p,e.fn.spectrum.defaults=h,e.spectrum={},e.spectrum.localization={},e.spectrum.palettes={},e.fn.spectrum.processNativeColorInputs=function(){v||e("input[type=color]").spectrum({preferredFormat:"hex6"})},function(){function e(e){var a={r:0,g:0,b:0},i=1,o=!1,s=!1;return"string"==typeof e&&(e=A(e)),"object"==typeof e&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(a=t(e.r,e.g,e.b),o=!0,s="%"===String(e.r).substr(-1)?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=M(e.s),e.v=M(e.v),a=r(e.h,e.s,e.v),o=!0,s="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=M(e.s),e.l=M(e.l),a=n(e.h,e.s,e.l),o=!0,s="hsl"),e.hasOwnProperty("a")&&(i=e.a)),i=T(i),{ok:o,format:e.format||s,r:j(255,I(a.r,0)),g:j(255,I(a.g,0)),b:j(255,I(a.b,0)),a:i}}function t(e,t,a){return{r:255*_(e,255),g:255*_(t,255),b:255*_(a,255)}}function a(e,t,a){e=_(e,255),t=_(t,255),a=_(a,255);var n,i,r=I(e,t,a),o=j(e,t,a),s=(r+o)/2;if(r==o)n=i=0;else{var l=r-o;switch(i=s>.5?l/(2-r-o):l/(r+o),r){case e:n=(t-a)/l+(a>t?6:0);break;case t:n=(a-e)/l+2;break;case a:n=(e-t)/l+4}n/=6}return{h:n,s:i,l:s}}function n(e,t,a){function n(e,t,a){return 0>a&&(a+=1),a>1&&(a-=1),1/6>a?e+6*(t-e)*a:.5>a?t:2/3>a?e+(t-e)*(2/3-a)*6:e}var i,r,o;if(e=_(e,360),t=_(t,100),a=_(a,100),0===t)i=r=o=a;else{var s=.5>a?a*(1+t):a+t-a*t,l=2*a-s;i=n(l,s,e+1/3),r=n(l,s,e),o=n(l,s,e-1/3)}return{r:255*i,g:255*r,b:255*o}}function i(e,t,a){e=_(e,255),t=_(t,255),a=_(a,255);var n,i,r=I(e,t,a),o=j(e,t,a),s=r,l=r-o;if(i=0===r?0:l/r,r==o)n=0;else{switch(r){case e:n=(t-a)/l+(a>t?6:0);break;case t:n=(a-e)/l+2;break;case a:n=(e-t)/l+4}n/=6}return{h:n,s:i,v:s}}function r(e,t,a){e=6*_(e,360),t=_(t,100),a=_(a,100);var n=N.floor(e),i=e-n,r=a*(1-t),o=a*(1-i*t),s=a*(1-(1-i)*t),l=n%6,d=[a,o,r,r,s,a][l],p=[s,a,a,o,r,r][l],c=[r,r,s,a,a,o][l];return{r:255*d,g:255*p,b:255*c}}function o(e,t,a,n){var i=[P(E(e).toString(16)),P(E(t).toString(16)),P(E(a).toString(16))];return n&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function s(e,t,a,n){var i=[P(F(n)),P(E(e).toString(16)),P(E(t).toString(16)),P(E(a).toString(16))];return i.join("")}function l(e,t){t=0===t?0:t||10;var a=L(e).toHsl();return a.s-=t/100,a.s=C(a.s),L(a)}function d(e,t){t=0===t?0:t||10;var a=L(e).toHsl();return a.s+=t/100,a.s=C(a.s),L(a)}function p(e){return L(e).desaturate(100)}function c(e,t){t=0===t?0:t||10;var a=L(e).toHsl();return a.l+=t/100,a.l=C(a.l),L(a)}function h(e,t){t=0===t?0:t||10;var a=L(e).toRgb();return a.r=I(0,j(255,a.r-E(255*-(t/100)))),a.g=I(0,j(255,a.g-E(255*-(t/100)))),a.b=I(0,j(255,a.b-E(255*-(t/100)))),L(a)}function u(e,t){t=0===t?0:t||10;var a=L(e).toHsl();return a.l-=t/100,a.l=C(a.l),L(a)}function m(e,t){var a=L(e).toHsl(),n=(E(a.h)+t)%360;return a.h=0>n?360+n:n,L(a)}function f(e){var t=L(e).toHsl();return t.h=(t.h+180)%360,L(t)}function v(e){var t=L(e).toHsl(),a=t.h;return[L(e),L({h:(a+120)%360,s:t.s,l:t.l}),L({h:(a+240)%360,s:t.s,l:t.l})]}function g(e){var t=L(e).toHsl(),a=t.h;return[L(e),L({h:(a+90)%360,s:t.s,l:t.l}),L({h:(a+180)%360,s:t.s,l:t.l}),L({h:(a+270)%360,s:t.s,l:t.l})]}function b(e){var t=L(e).toHsl(),a=t.h;return[L(e),L({h:(a+72)%360,s:t.s,l:t.l}),L({h:(a+216)%360,s:t.s,l:t.l})]}function y(e,t,a){t=t||6,a=a||30;var n=L(e).toHsl(),i=360/a,r=[L(e)];for(n.h=(n.h-(i*t>>1)+720)%360;--t;)n.h=(n.h+i)%360,r.push(L(n));return r}function $(e,t){t=t||6;for(var a=L(e).toHsv(),n=a.h,i=a.s,r=a.v,o=[],s=1/t;t--;)o.push(L({h:n,s:i,v:r})),r=(r+s)%1;return o}function w(e){var t={};for(var a in e)e.hasOwnProperty(a)&&(t[e[a]]=a);return t}function T(e){return e=parseFloat(e),(isNaN(e)||0>e||e>1)&&(e=1),e}function _(e,t){S(e)&&(e="100%");var a=k(e);return e=j(t,I(0,parseFloat(e))),a&&(e=parseInt(e*t,10)/100),N.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function C(e){return j(1,I(0,e))}function x(e){return parseInt(e,16)}function S(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)}function k(e){return"string"==typeof e&&-1!=e.indexOf("%")}function P(e){return 1==e.length?"0"+e:""+e}function M(e){return 1>=e&&(e=100*e+"%"),e}function F(e){return Math.round(255*parseFloat(e)).toString(16)}function R(e){return x(e)/255}function A(e){e=e.replace(z,"").replace(D,"").toLowerCase();var t=!1;if(q[e])e=q[e],t=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};var a;return(a=B.rgb.exec(e))?{r:a[1],g:a[2],b:a[3]}:(a=B.rgba.exec(e))?{r:a[1],g:a[2],b:a[3],a:a[4]}:(a=B.hsl.exec(e))?{h:a[1],s:a[2],l:a[3]}:(a=B.hsla.exec(e))?{h:a[1],s:a[2],l:a[3],a:a[4]}:(a=B.hsv.exec(e))?{h:a[1],s:a[2],v:a[3]}:(a=B.hsva.exec(e))?{h:a[1],s:a[2],v:a[3],a:a[4]}:(a=B.hex8.exec(e))?{a:R(a[1]),r:x(a[2]),g:x(a[3]),b:x(a[4]),format:t?"name":"hex8"}:(a=B.hex6.exec(e))?{r:x(a[1]),g:x(a[2]),b:x(a[3]),format:t?"name":"hex"}:(a=B.hex3.exec(e))?{r:x(a[1]+""+a[1]),g:x(a[2]+""+a[2]),b:x(a[3]+""+a[3]),format:t?"name":"hex"}:!1}var z=/^[\s,#]+/,D=/\s+$/,H=0,N=Math,E=N.round,j=N.min,I=N.max,O=N.random,L=function U(t,a){if(t=t?t:"",a=a||{},t instanceof U)return t;if(!(this instanceof U))return new U(t,a);var n=e(t);this._originalInput=t,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=E(100*this._a)/100,this._format=a.format||n.format,this._gradientType=a.gradientType,this._r<1&&(this._r=E(this._r)),this._g<1&&(this._g=E(this._g)),this._b<1&&(this._b=E(this._b)),this._ok=n.ok,this._tc_id=H++};L.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},setAlpha:function(e){return this._a=T(e),this._roundA=E(100*this._a)/100,this},toHsv:function(){var e=i(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=i(this._r,this._g,this._b),t=E(360*e.h),a=E(100*e.s),n=E(100*e.v);return 1==this._a?"hsv("+t+", "+a+"%, "+n+"%)":"hsva("+t+", "+a+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var e=a(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=a(this._r,this._g,this._b),t=E(360*e.h),n=E(100*e.s),i=E(100*e.l);return 1==this._a?"hsl("+t+", "+n+"%, "+i+"%)":"hsla("+t+", "+n+"%, "+i+"%, "+this._roundA+")"},toHex:function(e){return o(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return s(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:E(this._r),g:E(this._g),b:E(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+E(this._r)+", "+E(this._g)+", "+E(this._b)+")":"rgba("+E(this._r)+", "+E(this._g)+", "+E(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:E(100*_(this._r,255))+"%",g:E(100*_(this._g,255))+"%",b:E(100*_(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+E(100*_(this._r,255))+"%, "+E(100*_(this._g,255))+"%, "+E(100*_(this._b,255))+"%)":"rgba("+E(100*_(this._r,255))+"%, "+E(100*_(this._g,255))+"%, "+E(100*_(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":this._a<1?!1:V[o(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+s(this._r,this._g,this._b,this._a),a=t,n=this._gradientType?"GradientType = 1, ":"";if(e){var i=L(e);a=i.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+t+",endColorstr="+a+")"},toString:function(e){var t=!!e;e=e||this._format;var a=!1,n=this._a<1&&this._a>=0,i=!t&&n&&("hex"===e||"hex6"===e||"hex3"===e||"name"===e);return i?"name"===e&&0===this._a?this.toName():this.toRgbString():("rgb"===e&&(a=this.toRgbString()),"prgb"===e&&(a=this.toPercentageRgbString()),("hex"===e||"hex6"===e)&&(a=this.toHexString()),"hex3"===e&&(a=this.toHexString(!0)),"hex8"===e&&(a=this.toHex8String()),"name"===e&&(a=this.toName()),"hsl"===e&&(a=this.toHslString()),"hsv"===e&&(a=this.toHsvString()),a||this.toHexString())},_applyModification:function(e,t){var a=e.apply(null,[this].concat([].slice.call(t)));return this._r=a._r,this._g=a._g,this._b=a._b,this.setAlpha(a._a),this},lighten:function(){return this._applyModification(c,arguments)},brighten:function(){return this._applyModification(h,arguments)},darken:function(){return this._applyModification(u,arguments)},desaturate:function(){return this._applyModification(l,arguments)},saturate:function(){return this._applyModification(d,arguments)},greyscale:function(){return this._applyModification(p,arguments)},spin:function(){return this._applyModification(m,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(y,arguments)},complement:function(){return this._applyCombination(f,arguments)},monochromatic:function(){return this._applyCombination($,arguments)},splitcomplement:function(){return this._applyCombination(b,arguments)},triad:function(){return this._applyCombination(v,arguments)},tetrad:function(){return this._applyCombination(g,arguments)}},L.fromRatio=function(e,t){if("object"==typeof e){var a={};for(var n in e)e.hasOwnProperty(n)&&(a[n]="a"===n?e[n]:M(e[n]));e=a}return L(e,t)},L.equals=function(e,t){return e&&t?L(e).toRgbString()==L(t).toRgbString():!1},L.random=function(){return L.fromRatio({r:O(),g:O(),b:O()})},L.mix=function(e,t,a){a=0===a?0:a||50;var n,i=L(e).toRgb(),r=L(t).toRgb(),o=a/100,s=2*o-1,l=r.a-i.a;n=s*l==-1?s:(s+l)/(1+s*l),n=(n+1)/2;var d=1-n,p={r:r.r*n+i.r*d,g:r.g*n+i.g*d,b:r.b*n+i.b*d,a:r.a*o+i.a*(1-o)};return L(p)},L.readability=function(e,t){var a=L(e),n=L(t),i=a.toRgb(),r=n.toRgb(),o=a.getBrightness(),s=n.getBrightness(),l=Math.max(i.r,r.r)-Math.min(i.r,r.r)+Math.max(i.g,r.g)-Math.min(i.g,r.g)+Math.max(i.b,r.b)-Math.min(i.b,r.b);return{brightness:Math.abs(o-s),color:l}},L.isReadable=function(e,t){var a=L.readability(e,t);return a.brightness>125&&a.color>500},L.mostReadable=function(e,t){for(var a=null,n=0,i=!1,r=0;r<t.length;r++){var o=L.readability(e,t[r]),s=o.brightness>125&&o.color>500,l=3*(o.brightness/125)+o.color/500;(s&&!i||s&&i&&l>n||!s&&!i&&l>n)&&(i=s,n=l,a=L(t[r]))}return a};var q=L.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},V=L.hexNames=w(q),B=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",a="(?:"+t+")|(?:"+e+")",n="[\\s|\\(]+("+a+")[,|\\s]+("+a+")[,|\\s]+("+a+")\\s*\\)?",i="[\\s|\\(]+("+a+")[,|\\s]+("+a+")[,|\\s]+("+a+")[,|\\s]+("+a+")\\s*\\)?";return{rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+i),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();window.tinycolor=L}(),e(function(){e.fn.spectrum.load&&e.fn.spectrum.processNativeColorInputs()})});var Pharmit=Pharmit||{};Pharmit.Viewer=function(){"use strict";function e(e){var t=($3Dmol.elementColors,{left:0,right:0}),a={Aromatic:"purple",HydrogenDonor:"0xf0f0f0",HydrogenAcceptor:"orange",Hydrophobic:"green",NegativeIon:"red",PositiveIon:"blue",ExclusionSphere:"grey",InclusionSphere:"yellow"},n={Ligand:{model:null,defaultColor:"#C8C8C8",colorscheme:$.extend({},$3Dmol.elementColors.defaultColors),selectedstyle:"stick",styles:{stick:{name:"Stick",style:{stick:{radius:.15}},nonbond:{sphere:{radius:.15}}},wire:{name:"Wire",style:{line:{linewidth:2}},nonbond:{sphere:{radius:.05}}},sphere:{name:"Sphere",style:{sphere:{}},nonbond:{sphere:{}}},none:{name:"None",style:{},nonbond:{}}}},Receptor:{model:null,defaultColor:"#C8C8C8",colorscheme:$.extend({},$3Dmol.elementColors.defaultColors),backbone:null,selectedstyle:"cartoonwire",styles:{stick:{name:"Stick",style:{stick:{radius:.1}},nonbond:{sphere:{radius:.1}}},wire:{name:"Wire",style:{line:{linewidth:3}},nonbond:{sphere:{radius:.05}}},sphere:{name:"Sphere",style:{sphere:{}},nonbond:{sphere:{}}},cartoon:{name:"Cartoon",style:{cartoon:{}},nonbond:{sphere:{radius:.1}}},cartoonwire:{name:"Cartoon+Wire",style:{cartoon:{},line:{linewidth:3}},nonbond:{sphere:{radius:.2}}},none:{name:"None",style:{},nonbond:{}}}},Results:{model:null,defaultColor:"gray",colorscheme:$.extend({},$3Dmol.elementColors.defaultColors),selectedstyle:"stick",styles:{stick:{name:"Stick",style:{stick:{radius:.25}},nonbond:{sphere:{radius:.25}}},wire:{name:"Wire",style:{line:{linewidth:4}},nonbond:{sphere:{radius:.1}}},sphere:{name:"Sphere",style:{sphere:{}},nonbond:{sphere:{}}},none:{name:"None",style:{},nonbond:{}}}}},i=null,r={map:{prop:"partialCharge",scheme:new $3Dmol.Gradient.RWB(-.8,.8)},opacity:.8},o=null,s=[],l=function(e){if(!e)return"";var t=e.split(".");return t.length<=1?"":t.pop()},d=function(e){var t=n[e],a=t.selectedStyle,i=t.styles[a],r=i.style,s=i.nonbond,l=t.model;l&&(l.setStyle({},r),l.setStyle({bonds:0},s)),o.render()},p=function(e,t){var a=n[e],i=$("<tr>").appendTo(t).addClass("pharmit_styleselectrow"),r=e+"MolStyleSelect";$('<label for="'+r+'">'+e+":</label>").appendTo(i).addClass("pharmit_stylelabel").appendTo($("<td>").appendTo(i));var o=$("<td nowrap>").appendTo(i),s=$('<select name="'+r+'" id="'+r+'">').appendTo(o).addClass("pharmit_styleselector");$.each(a.styles,function(e,t){$('<option value="'+e+'">'+t.name+"</option>").appendTo(s)}),s.val(a.selectedstyle),s.selectmenu({width:"11em",appendTo:t,change:function(){s.change()},position:{my:"left top",at:"left bottom",collision:"flip"}}),s.selectmenu("widget").css("width","");var l=a.colorscheme;$.each(a.styles,function(e,t){$.each(t.style,function(e,t){t.colorscheme=l})}),s.change(function(){a.selectedStyle=this.value,s.selectmenu("refresh"),d(e)});var p=$('<input name="'+r+'color">').appendTo($("<td>").appendTo(i));p.val(a.defaultColor),p.change(function(){var t=this.value;p.spectrum("set",t);var n=parseInt(p.spectrum("get").toHex(),16);a.colorscheme.C=n,d(e)}),p.spectrum({showPalette:!0,preferredFormat:"hex",replacerClassName:"ui-state-default ui-corner-all",showPaletteOnly:!0,clickoutFiresChange:!0,palette:["#C8C8C8","gray","white","green","cyan","magenta","yellow","orange","purple","blue"],change:function(){p.change()}}),s.change(),p.change(),s.selectmenu("refresh")};this.appendViewerControls=function(e){var t=$("<table>").appendTo(e);p("Ligand",t,null),p("Results",t,null),p("Receptor",t,null);var a=$("<div>").addClass("pharmit_backbonediv").appendTo(e);$('<label for="receptorbackbone">Receptor Backbone:</label>').appendTo(a);var s=$('<div id="receptorbackbone">').appendTo(a);$('<input type="radio" id="plainBackbone" name="receptorbackbone"><label for="plainBackbone">Plain</label>').appendTo(s).change(function(){if($(this).prop("checked")){var e=n.Receptor;delete e.styles.cartoon.style.cartoon.color,delete e.styles.cartoonwire.style.cartoon.color,d("Receptor")}s.buttonset("refresh")}).prop("checked",!0),$('<input type="radio" id="rainbowBackbone" name="receptorbackbone"><label for="rainbowBackbone">Rainbow</label>').appendTo(s).change(function(){if($(this).prop("checked")){var e=n.Receptor;e.styles.cartoon.style.cartoon.color="spectrum",e.styles.cartoonwire.style.cartoon.color="spectrum",d("Receptor")}s.buttonset("refresh")}),s.buttonset();var l=$("<div>").addClass("pharmit_surfacetransparencydiv").appendTo(e);$('<label for="surfaceopacity">Receptor Surface Opacity:</label>').appendTo(l);var c=$("<div>").addClass("pharmit_surfacetransparencyslider").appendTo(l),h=$('<input type="hidden" name="surfaceopacity">').appendTo(l),u=.8;h.val(u);var m=$('<div id="surfaceopacity">').appendTo(c).slider({animate:"fast",step:.05,min:0,max:1,value:u,change:function(e,t){h.val(t.value).change()}});h.change(function(){var e=h.val();r.opacity=e,null!==i&&o.setSurfaceMaterialStyle(i,r),m.slider("value")!=e&&m.slider("value",e),o.render()});var f=$("<div>").addClass("pharmit_backgroundcolordiv").appendTo(e);$('<label for="backgroundcolor">Background Color:</label>').appendTo(f);var v=$('<div id="backgroundcolor">').appendTo(f);$('<input type="radio" id="whiteBackground" name="backgroundcolor"><label for="whiteBackground">White</label>').appendTo(v).change(function(){$(this).prop("checked")&&o.setBackgroundColor("white"),v.buttonset("refresh")}).prop("checked",!0),$('<input type="radio" id="blackBackground" name="backgroundcolor"><label for="blackBackground">Black</label>').appendTo(v).change(function(){$(this).prop("checked")&&o.setBackgroundColor("black"),v.buttonset("refresh")}),v.buttonset()};this.setReceptor=function(e,t){var a=n.Receptor.model;if(a&&o.removeModel(a),a=null,null!==i&&o.removeSurface(i),i=null,e){var s=l(t);a=o.addModel(e,s),n.Receptor.model=a,d("Receptor"),o.mapAtomProperties($3Dmol.applyPartialCharges,{model:a});var p=o.addSurface($3Dmol.SurfaceType.VDW,r,{model:a,bonds:0,invert:!0});i=p.surfid,o.zoomTo({})}else o.render()},this.setLigand=function(e,t){var a=n.Ligand.model;if(a&&o.removeModel(a),a=null,e){var i=l(t);a=o.addModel(e,i),n.Ligand.model=a,d("Ligand"),o.zoomTo({model:a})}else o.render()},this.setResult=function(e){var t=n.Results.model;t&&o.removeModel(t),e?(t=o.addModel(e,"sdf"),n.Results.model=t,d("Results"),o.zoomTo({model:t})):o.render()},this.setView=function(e){e?o.setView(e):o.zoomTo()},this.getView=function(){return o.getView()},this.addMesh=function(e,t){"exclusive"==t.kind?e.color="grey":"inclusive"==t.kind&&(e.color="yellow"),$.extend(e,t);var a=o.addCustom(e);return o.render(),a},this.updateMesh=function(e,t){e&&(e.updateStyle&&e.updateStyle(t),o.render())},this.removeMesh=function(e){o.removeShape(e),o.render()},this.hideMesh=function(){},this.unhideMesh=function(){},this.addFeature=function(e,t){var n={center:{x:e.x,y:e.y,z:e.z},radius:e.radius,color:a[e.name],wireframe:!0,linewidth:1.5,clickable:!0,callback:t},i={sphere:null,arrows:[],label:null};if(i.sphere=o.addSphere(n),e.selected&&i.sphere.updateStyle({wireframe:!1}),e.hasvec&&e.vector_on&&e.svector){var r=new $3Dmol.Vector3(e.svector.x,e.svector.y,e.svector.z),l=e.radius+1,d=(l-.5)/l;r=r.normalize();var p=r.clone().multiplyScalar(e.radius).add(e),c=r.clone().multiplyScalar(l).add(e),h={start:p,end:c,radius:.075,radiusRatio:2,mid:d,wireframe:!e.selected,color:a[e.name]};i.arrows.push(o.addArrow(h)),"Aromatic"==e.name&&(p=r.clone().multiplyScalar(-e.radius).add(e),c=r.clone().multiplyScalar(-l).add(e),h.start=p,h.end=c,i.arrows.push(o.addArrow(h)))}if("Hydrophobic"==e.name){var u=e.minsize+":"+e.maxsize;if(":"!=u){var m={position:{x:e.x,y:e.y,z:e.z},showBackground:!0,fontColor:"black",backgroundColor:a[e.name],backgroundOpacity:.5,alignment:$3Dmol.SpriteAlignment.center};i.label=o.addLabel(u,m)}}return o.render(),s.push(i),s.length-1},this.selectFeature=function(e){var t=s[e];t&&t.sphere&&(t.sphere.updateStyle({wireframe:!1}),$.each(t.arrows,function(e,t){t.updateStyle({wireframe:!1})}),o.render())},this.unselectFeature=function(e){var t=s[e];t&&t.sphere&&(t.sphere.updateStyle({wireframe:!0}),$.each(t.arrows,function(e,t){t.updateStyle({wireframe:!0})}),o.render())},this.removeFeature=function(e){var t=s[e];for(t&&(t.sphere&&o.removeShape(t.sphere),$.each(t.arrows,function(e,t){o.removeShape(t)}),t.label&&o.removeLabel(t.label),o.render()),delete s[e];s.length>0&&"undefined"==typeof s[s.length-1];)s.pop()},this.setLeft=function(e){var a=e-t.left;t.left=e,o.translate(a/2,0)},this.setRight=function(e){var a=t.right-e;t.right=e,o.translate(a/2,0)};var c=null;this.disableRendering=function(){c=o.render,o.render=function(){}},this.enableRendering=function(){c&&(o.render=c),o.render()},o=new $3Dmol.GLViewer(e),o.setBackgroundColor("white")}return e}();