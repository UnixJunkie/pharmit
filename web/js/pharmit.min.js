function Feature(e,a,t){var i=this;this.obj={},this.shape=null,this.selected=!1,this.updateViewer=function(){},this.container=$("<div>").appendTo(a).addClass("pharmit_featurediv"),this.container.get(0).feature=this,this.container.disableSelection();var n=$("<h3></h3>").appendTo(this.container);this.enabled=$("<div>").addClass("toggle toggle-light pharmit_togglediv").appendTo(n).toggles().on("toggle",function(e,a){a?(i.obj.enabled=!0,i.container.addClass("pharmit_enabledfeature")):(i.obj.enabled=!1,i.container.removeClass("pharmit_enabledfeature")),i.updateViewer()}).click(function(){return!1});var o=$("<div>").addClass("pharmit_featurenamediv").appendTo(n),r=$("<span>").addClass("pharmit_featurenameheading").appendTo(o),s=$("<div>").addClass("pharmit_featureclose").appendTo(n).click(function(){i.shape&&e.removeFeature(i.shape),i.container.feature=null,i.container.remove()}),d=($("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(s),$("<span>").appendTo(o).addClass("pharmit_featuresummary"));d.append($(document.createTextNode("("))),this.xsummary=$("<span>").appendTo(d),d.append($(document.createTextNode(","))),this.ysummary=$("<span>").appendTo(d),d.append($(document.createTextNode(","))),this.zsummary=$("<span>").appendTo(d),d.append($(document.createTextNode(") Radius "))),this.rsummary=$("<span>").appendTo(d);var p=$("<div>").appendTo(this.container),l=this.select=$('<select name="featurename">').addClass("pharmit_featureselect").appendTo(p);$.each(this.featureNames,function(e,a){$('<option value="'+a+'">'+a+"</option>").appendTo(l)}),l.change(function(){var e=this.value;i.obj.name=e,r.text(e),"Aromatic"==e||"HydrogenDonor"==e||"HydrogenAcceptor"==e?(i.orientdiv.show(),i.sizediv.hide(),i.obj.hasvec=!0):"Hydrophobic"==e?(i.orientdiv.hide(),i.sizediv.show(),i.obj.hasvec=!1):(i.orientdiv.hide(),i.sizediv.hide(),i.obj.hasvec=!1),i.updateViewer()}),l.selectmenu({width:"12em",change:function(){l.trigger("change")}});var c=$("<div>").appendTo(p).addClass("pharmit_locationdiv"),u=function(e,a){var t=function(){e.change()};return a.spin=a.stop=a.change=t,a},h=function(e){return Math.round(1e3*e)/1e3},m=$("<div>").appendTo(c).addClass("pharmit_coorddiv");$("<label>x:</label>").appendTo(m),this.x=$("<input>").appendTo(m).addClass("pharmit_coordinput").change(function(){var e=this.value=h(parseFloat(this.value));i.xsummary.text(numeral(e).format("0.[00]")),i.obj.x=h(e),i.updateViewer()}),this.x.spinner(u(i.x,{step:.1,numberFormat:"n"})),m=$("<div>").appendTo(c).addClass("pharmit_coorddiv"),$("<label>y:</label>").appendTo(m),this.y=$("<input>").appendTo(m).addClass("pharmit_coordinput"),this.y.spinner(u(i.y,{step:.1,numberFormat:"n"})).change(function(){var e=this.value=h(parseFloat(this.value));i.ysummary.text(numeral(e).format("0.[00]")),i.obj.y=h(e),i.updateViewer()}),m=$("<div>").appendTo(c).addClass("pharmit_coorddiv"),$("<label>z:</label>").appendTo(m),this.z=$("<input>").appendTo(m).addClass("pharmit_coordinput"),this.z.spinner(u(i.z,{step:.1,numberFormat:"n"})).change(function(){var e=this.value=h(parseFloat(this.value));i.zsummary.text(numeral(e).format("0.[00]")),i.obj.z=e,i.updateViewer()}),m=$("<div>").appendTo(c).addClass("pharmit_coorddiv"),$("<label>Radius:</label>").appendTo(m),this.radius=$("<input>").appendTo(m).addClass("pharmit_radiusinput"),this.radius.spinner(u(i.radius,{step:.1,numberFormat:"n"})).change(function(){i.rsummary.text(numeral(this.value).format("0.[00]")),i.obj.radius=this.value=h(this.value),i.updateViewer()});var v=this.orientdiv=$("<div>").appendTo(p).addClass("pharmit_orientdiv"),f=null,b=null,g=function(){var e=Math.round(parseFloat(b.val()))%360,a=Math.round(parseFloat(f.val()))%360;isNaN(e)&&(e=0),isNaN(a)&&(a=0),b.val(e),f.val(a),a=a*Math.PI/180,e=e*Math.PI/180,i.obj.svector={x:Math.sin(a)*Math.cos(e),y:Math.sin(a)*Math.sin(e),z:Math.cos(a)},i.updateViewer()};this.orientenabled=$('<input type="checkbox">').appendTo(v).change(function(){$(this).prop("checked")?(f.spinner("option","disabled",!1),b.spinner("option","disabled",!1),i.obj.vector_on=1):(f.spinner("option","disabled",!0),b.spinner("option","disabled",!0),i.obj.vector_on=0,g()),i.updateViewer()});var T=$("<span>").addClass("pharmit_nowrap").appendTo(v);$("<label>&theta;:</label>").appendTo(T),f=this.theta=$("<input>").appendTo(T).addClass("pharmit_orientinput"),this.theta.spinner(u(i.theta,{step:1,numberFormat:"n"})).change(g),T=$("<span>").addClass("pharmit_nowrap").appendTo(v),$("<label>&phi;:</label>").appendTo(T),b=this.phi=$("<input>").appendTo(T).addClass("pharmit_orientinput"),this.phi.spinner(u(i.theta,{step:1,numberFormat:"n"})).change(g),this.orientdiv.hide();var w=this.sizediv=$("<div>").appendTo(p).addClass("pharmit_sizediv");this.minsize=$("<input>").appendTo(w).addClass("pharmit_sizeinput"),this.minsize.spinner(u(i.minsize,{step:1,numberFormat:"n"})).change(function(){i.obj.minsize=this.value,i.updateViewer()}),$("<label> &le; #Atoms &le;</label>").appendTo(w).addClass("pharmit_nowrap"),this.maxsize=$("<input>").appendTo(w).addClass("pharmit_sizeinput"),this.maxsize.spinner(u(i.maxsize,{step:1,numberFormat:"n"})).change(function(){i.obj.maxsize=this.value,i.updateViewer()}),this.sizediv.hide(),this.setFeature(t),delete this.updateViewer,this.viewer=e,this.updateViewer(),a.accordion("refresh"),a.accordion("option","active",a.children().length-1)}Feature.prototype.setFeature=function(e){if(this.select.val(e.name).trigger("change"),this.select.selectmenu("refresh"),this.x.val(e.x).trigger("change"),this.y.val(e.y).trigger("change"),this.z.val(e.z).trigger("change"),this.radius.val(e.radius).trigger("change"),this.enabled.toggles(e.enabled),this.obj.enabled=!!e.enabled,this.orientenabled.prop("checked",1==e.vector_on).trigger("change"),$.isNumeric(e.minsize)?this.minsize.val(e.minsize).trigger("change"):this.obj.minsize="",$.isNumeric(e.maxsize)?this.maxsize.val(e.maxsize).trigger("change"):this.obj.maxsize="",e.svector){var a=e.svector.x,t=e.svector.y,i=e.svector.z,n=180*Math.acos(i/Math.sqrt(a*a+t*t+i*i))/Math.PI,o=180*Math.atan2(t,a)/Math.PI;this.theta.val(n).trigger("change"),this.phi.val(o).trigger("change")}else this.obj.svector={x:1,y:0,z:0}},Feature.prototype.featureNames=["Aromatic","HydrogenDonor","HydrogenAcceptor","Hydrophobic","NegativeIon","PositiveIon"],Feature.prototype.updateViewer=function(){if(null!==this.shape&&this.viewer.removeFeature(this.shape),this.obj.enabled){var e=this;this.shape=this.viewer.addFeature(this.obj,function(){e.selected?e.deselectFeature():e.selectFeature()})}},Feature.prototype.selectFeature=function(){this.viewer.selectFeature(this.shape),this.container.addClass("pharmit_selectedFeature"),this.selected=!0,this.obj.selected=!0},Feature.prototype.deselectFeature=function(){this.viewer.unselectFeature(this.shape),this.container.removeClass("pharmit_selectedFeature"),this.selected=!1,this.obj.selected=!1},function(e){e.support.cssPseudoClasses=function(){try{var a=e("<input type='checkbox' checked/>").appendTo("body"),t=e('<style type="text/css" />').appendTo("head");t.text("input:checked {width: 200px; display: none}");var i="200px"==a.css("width");return a.remove(),t.remove(),i}catch(n){return!1}}(),e.fn.fileinput=function(a){var t=this;return a||(a='<button class="fileinput">Browse...</button>'),t.each(function(){var t=e(this);t.wrap('<div class="fileinput-wrapper" style=" position: relative; display: inline-block;" />'),t.parent().mousemove(function(a){var t,i,n=e(this);t=n.offset().left,i=n.offset().top,n.find("input").css({left:a.pageX-t-n.find("input[type=file]").width()+30,top:a.pageY-i-10})}),t.attr("tabindex","-1").css({filter:"alpha(opacity=0)","-moz-opacity":0,opacity:0,position:"absolute","z-index":-1}),t.before(a),t.prev().addClass("fileinput"),e.support.cssPseudoClasses?(t.prev(".fileinput").click(function(){t.click()}),t.prev(":submit.fileinput").click(function(e){e.preventDefault()})):(t.css({"z-index":"auto",cursor:"pointer"}),t.prev(".fileinput").css("z-index",-1),t.removeAttr("tabindex"),t.prev(".fileinput").attr("tabindex","-1"),t.hover(function(){e(this).prev(".fileinput").addClass("hover")},function(){e(this).prev(".fileinput").removeClass("hover")}).focusin(function(){e(this).prev(".fileinput").addClass("focus")}).focusout(function(){e(this).prev(".fileinput").removeClass("focus")}).mousedown(function(){e(this).prev(".fileinput").addClass("active")}).mouseup(function(){e(this).prev(".fileinput").removeClass("active")}))}),t}}(jQuery);var Pharmit={};$(document).ready(function(){var e={};for(var a in window)e[a]=!0;Pharmit.checkGlobals=function(){var a=[];for(var t in window)t in e||a.push(t);a.length>0&&console.log("Leaked global variables: ["+a.join(", ")+"]")};var t=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+e+"=([^&#]*)",t=new RegExp(a),i=t.exec(window.location.href);return null===i?null:i[1]};Pharmit.server="/fcgi-bin/pharmitserv.fcgi";var i=$("#pharmit").addClass("pharmit_main"),n=new Pharmit.Viewer(i),o=new Pharmit.Results(i,n),r=new Pharmit.Query(i,n,o);t("SESSION")&&$.get(decodeURI(t("SESSION")),function(e){r.loadSession(e)}),Pharmit.checkGlobals(),$("button, input[type='button'], input[type='submit']").button().bind("mouseup",function(){$(this).blur()})});var Pharmit=Pharmit||{};Pharmit.MinResults=function(){function e(e){var a=null,t=null;this.minimize=function(e,i){t=i,a.show()};var i=function(){};a=$("<div>").appendTo(e.div).addClass("pharmit_rescontainer");{var n=$("<div>").appendTo(a).addClass("pharmit_resheader"),o=$("<div>Minimization Results</div>").appendTo(n).addClass("pharmit_heading").addClass("pharmit_rightheading"),r=$("<div>").addClass("pharmit_resclose").appendTo(o).click(function(){a.hide(),t&&t()}),s=($("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(r),$("<div>").appendTo(a).addClass("pharmit_resbody"),$("<div>").appendTo(a).addClass("pharmit_resfooter")),d=$("<div>").appendTo(s).addClass("pharmit_bottomloaders").addClass("pharmit_nowrap");$("<button>Save...</button>").appendTo(d).button().click(i)}a.hide()}return e}();var Pharmit=Pharmit||{};Pharmit.PhResults=function(){function e(e,a,t){var i=null;this.query=function(){},this.quit=function(){};var n=function(){},o=function(){i.hide(),t.minimize(0,function(){i.show()})};i=$("<div>").appendTo(e.div).addClass("pharmit_rescontainer");{var r=$("<div>").appendTo(i).addClass("pharmit_resheader"),s=$("<div>Pharmacophore Results</div>").appendTo(r).addClass("pharmit_heading").addClass("pharmit_rightheading"),d=$("<div>").addClass("pharmit_resclose").appendTo(s).click(function(){e.hide()}),p=($("<span>").addClass("ui-icon-circle-close ui-icon").appendTo(d),$("<div>").appendTo(i).addClass("pharmit_resbody"),$("<div>").appendTo(i).addClass("pharmit_resfooter")),l=$("<div>").appendTo(p).addClass("pharmit_bottomloaders").addClass("pharmit_nowrap");$("<button>Minimize</button>").appendTo(l).button().click(o),$("<button>Save...</button>").appendTo(l).button().click(n)}}return e}();var Pharmit=Pharmit||{};Pharmit.Query=function(){function e(e,t,i){var n=$("<div>").addClass("pharmit_query pharmit_overlay"),o=null,r=null,s=null,d=null,p=null,l=null,c=function(){var e=b();i.phquery(e)},u=function(e,a){if(e.files.length>0){var t=e.files[0],i=new FileReader;i.onload=function(e){a(e.target.result,t.name)},i.readAsText(t),$(e).val("")}},h=function(){},m=function(e,a){s=e,d=a,t.setReceptor(e,a)},v=function(){var e=o.children().detach();e.sort(function(e,a){var t=e.feature.obj,i=a.feature.obj;return t.enabled!=i.enabled?i.enabled-t.enabled:t.name!=i.name?t.name.localeCompare(i.name):t.radius-i.radius}),o.append(e)},f=this.loadSession=function(e){var a=$.parseJSON(e);o.detach(),o.empty(),a.points&&$.each(a.points,function(e,a){new Feature(t,o,a)}),o.accordion("option","active",!1),o.accordion("refresh"),r.after(o),$.each(a,function(e,a){var t=$("input[name="+e+"]");t.length&&t.val(a)}),s=a.receptor,d=a.recname,t.setReceptor(s,d),a.sdf?(p=decodeURIComponent(a.sdf),l=p.match(/^@<TRIPOS>MOLECULE/)?".mol2":p.match(/^HETATM/)||p.match(/^ATOM/)?".pdb":p.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/)?".sdf":".xyz"):(p=a.ligand,l=a.ligandFormat),t.setLigand(p,l),a.backgroundcolor&&$("#"+a.backgroundcolor).prop("checked",!0).change(),t.setView(a.view)},b=function(){var e={};return e.points=[],$.each(o.children(),function(a,t){e.points.push(t.feature.obj)}),$.each($("[name]",n),function(a,t){t.name&&(e[t.name]=t.value)}),e.backgroundcolor="whiteBackground",$("#blackBackground").prop("checked")&&(e.backgroundcolor="blackBackground"),e.ligand=p,e.ligandFormat=l,e.receptor=s,e.recname=d,e},g=function(){var e=Pharmit.server+'?cmd=savedata&type="text%2Fphjson"&fname="pharmit.json"',a=$("<form>",{action:e,method:"post"}),t=b();a.append($("<input>",{name:"data",type:"hidden",value:JSON.stringify(t,null,4)})),a.appendTo(document.body),a.submit(),$(a).remove()},T=function(e,a){var t=$("<div>").addClass("pharmit_searchdiv"),i=$("<button>Search "+a[0]+"</button>").appendTo(t).button(),n=$("<button>Select subset to search</button>").appendTo(t).button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}});t.buttonset();for(var o=$("<ul>").appendTo($("body")).addClass("pharmit_floatmenu"),r=[],s=0,d=a.length;d>s;s++)r[s]="<li>"+a[s]+"</li>";o.append(r),o.hide().menu().on("menuselect",function(e,a){i.button("option","label","Search "+a.item.text())}),i.click(c),n.click(function(){var e=o.show().position({my:"left top",at:"left buttom",of:this});return $(document).one("click",function(){e.hide()}),!1}),e.prepend(t)},w=$("<div>").appendTo(n).addClass("pharmit_leftclose"),y=$("<span>").addClass("ui-icon ui-icon-carat-1-w").appendTo(w);n.resizable({handles:"e",resize:function(e,a){t.setLeft(a.size.width)}}),n.disableSelection(),w.click(function(){if(w.hasClass("pharmit_leftisclosed")){w.removeClass("pharmit_leftisclosed"),y.removeClass("ui-icon-carat-1-e"),y.addClass("ui-icon-carat-1-w");var e=n.width();n.css("width","");var a=n.width();n.width(e),n.animate({width:a},{progress:function(){t.setLeft(n.width())}}),n.resizable("option","disabled",!1)}else n.animate({width:0},{progress:function(){t.setLeft(n.width())}}),w.addClass("pharmit_leftisclosed"),y.addClass("ui-icon-carat-1-e"),y.removeClass("ui-icon-carat-1-w"),n.resizable("option","disabled",!0)});var C=$("<div>").appendTo(n).addClass("pharmit_queryheader");T(C,["MolPort","ZINC"]);var _=$("<div>").appendTo(C).addClass("pharmit_loaderdiv").addClass("pharmit_nowrap"),x=$("<button>Load Receptor...</button>").button(),z=$("<button>Load Features...</button>").button();e.append(n);$('<input type="file">').appendTo(_).fileinput(x).change(function(){u(this,m)}),$('<input type="file">').appendTo(_).fileinput(z).change(h);n.detach();var k=$("<div>").appendTo(n).addClass("pharmit_querybody"),S=$("<div>").appendTo(k);r=$("<div>Pharmacophore</div>").appendTo(S).addClass("pharmit_heading"),o=$("<div>").appendTo(S),o.accordion({header:"> div > h3",animate:!0,active:!1,collapsible:!0,heightStyle:"content",beforeActivate:function(e,a){var t=null,i=o.children();$.each(i,function(e,a){a.feature.deselectFeature()}),a.newHeader.length>0&&(t=a.newHeader.parent(),t.get(0).feature.selectFeature())}}).sortable({axis:"y",handle:"h3",stop:function(e,a){a.item.children("h3").triggerHandler("focusout"),$(this).accordion("refresh")}});var F=$("<div>").appendTo(S).addClass("pharmit_featurebuttons"),M=($("<button>Add</button>").appendTo(F).button({text:!0,icons:{secondary:"ui-icon-circle-plus"}}).click(function(){new Feature(t,o,a)}),$("<button>Sort</button>").appendTo(F).button({text:!0,icons:{secondary:"ui-icon ui-icon-carat-2-n-s"}}).click(v),$("<div>").appendTo(k));$("<div>Filters</div>").appendTo(M).addClass("pharmit_heading");var P=$("<div>").appendTo(M),R=$("<h3>Hit Reduction<br></h3>").appendTo(P),j=($("<span>").appendTo(R).addClass("pharmit_headingsummary"),$("<div>").addClass("pharmit_hitreduction").appendTo(P)),V=$("<table>").appendTo(j),L=$("<tr>").addClass("pharmit_filterrow").appendTo(V);$("<td>").append('<label title="Maximum number of orientations returned for each conformation" value="1" for="reduceorienttext">Max Hits per Conf:</label>').appendTo(L);var H=$("<td>").appendTo(L);$('<input id="reduceorienttext" name="max-orient">').appendTo(H).spinner(),L=$("<tr>").addClass("pharmit_filterrow").appendTo(V),$("<td>").append('<label title="Maximum number of conformations returned for each compound" value="1" for="reduceconfstext">Max Hits per Mol:</label>').appendTo(L),H=$("<td>").appendTo(L),$('<input id="reduceconfstext" name="reduceConfs">').appendTo(H).spinner(),L=$("<tr>").addClass("pharmit_filterrow").appendTo(V),$("<td>").append('<label title="Maximum number of hits returned" value="1" for="reducehitstext">Max Total Hits:</label>').appendTo(L),H=$("<td>").appendTo(L),$('<input id="reducehitstext" name="max-hits">').appendTo(H).spinner(),R=$("<h3>Hit Screening<br></h3>").appendTo(P);var N=($("<span>").appendTo(R).addClass("pharmit_headingsummary"),$("<div>").appendTo(P).addClass("pharmit_hitscreening")),A=$("<table>").appendTo(N);L=$("<tr>").addClass("pharmit_filterrow").appendTo(A),H=$("<td>").appendTo(L),$('<input id="minmolweight" name="minMolWeight">').appendTo(H).spinner(),$("<td>").appendTo(L).append($('<label title="Minimum/maximum molecular weight (weights are approximate)" value="1" for="maxmolweight">&le;  MolWeight &le;</label>')),H=$("<td>").appendTo(L),$('<input id="maxmolweight" name=maxMolWeight>').appendTo(H).spinner(),L=$("<tr>").addClass("pharmit_filterrow").appendTo(A),H=$("<td>").appendTo(L),$('<input id="minnrot" name="minrotbonds">').appendTo(H).spinner(),$("<td>").appendTo(L).append($('<label title="Minimum/maximum number of rotatable bonds" value="1" for="maxnrot"> &le;  RotBonds &le;</label>')),H=$("<td>").appendTo(L),$('<input id="maxnrot" name="maxrotbonds">').appendTo(H).spinner(),P.accordion({animate:!0,active:!1,collapsible:!0,heightStyle:"content"});var B=$("<div>").appendTo(k);$("<div>Visualization</div>").appendTo(B).addClass("pharmit_heading");var I=$("<div>").appendTo(B).addClass("pharmit_vizdiv");t.appendViewerControls(I);var D=$("<div>").appendTo(n).addClass("pharmit_queryfooter"),O=$("<div>").appendTo(D).addClass("pharmit_bottomloaders").addClass("pharmit_nowrap");e.append(n);{var q=$("<button>Load Session...</button>").button();$('<input type="file">').appendTo(O).fileinput(q).change(function(){u(this,f)}),$("<button>Save Session...</button>").appendTo(O).button().click(g)}t.setLeft(n.width())}var a={name:"Hydrophobic",x:0,y:0,z:0,radius:1,enabled:!0,vector_on:0,minsize:"",maxsize:"",svector:null,hasvec:!1};return e}();var Pharmit=Pharmit||{};Pharmit.Results=function(){function e(e,a){var t=this.div=$("<div>").addClass("pharmit_results pharmit_overlay").appendTo(e),i=null,n=null;this.phquery=function(){this.show()},this.hide=function(){t.hide(),a.setRight(0)},this.show=function(){t.show(),a.setRight(t.width())},this.close=function(){t.hide(),a.setRight(0)};var o=$("<div>").appendTo(t).addClass("pharmit_rightclose"),r=$("<span>").addClass("ui-icon ui-icon-carat-1-e").appendTo(o);t.resizable({handles:"w",resize:function(e,t){a.setRight(t.size.width),$(this).css("left","")}}),t.disableSelection(),o.click(function(){if(o.hasClass("pharmit_rightisclosed")){o.removeClass("pharmit_rightisclosed"),r.removeClass("ui-icon-carat-1-w"),r.addClass("ui-icon-carat-1-e");var e=t.width();t.css("width","");var i=t.width();t.width(e),t.animate({width:i},{progress:function(){a.setRight(t.width())}}),t.resizable("option","disabled",!1)}else t.animate({width:0},{progress:function(){a.setRight(t.width())}}),o.addClass("pharmit_rightisclosed"),r.addClass("ui-icon-carat-1-w"),r.removeClass("ui-icon-carat-1-e"),t.resizable("option","disabled",!0)}),n=new Pharmit.MinResults(this,a),i=new Pharmit.PhResults(this,a,n),t.is(":visible")&&a.setRight(t.width())}return e}();var Pharmit=Pharmit||{};Pharmit.Viewer=function(){"use strict";function e(e){var a=($3Dmol.elementColors,{none:"None",rasmol:"RasMol",whiteCarbon:"White",greenCarbon:"Green",cyanCarbon:"Cyan",magentaCarbon:"Magenta",yellowCarbon:"Yellow",orangeCarbon:"Orange",purpleCarbon:"Purple",blueCarbon:"Blue"}),t={left:0,right:0},i={Aromatic:"purple",HydrogenDonor:"0xf0f0f0",HydrogenAcceptor:"orange",Hydrophobic:"green",NegativeIon:"red",PositiveIon:"blue"},n={Ligand:{model:null,style:{stick:{radius:.15}},nonbond:{sphere:{radius:.15}}},Receptor:{model:null,style:{cartoon:{},line:{linewidth:3}},nonbond:{sphere:{radius:.2}}},Results:{model:null,style:{stick:{radius:.25}},nonbond:{sphere:{radius:.25}}}},o=null,r={map:{prop:"partialCharge",scheme:new $3Dmol.Gradient.RWB(-.8,.8)},opacity:.8},s=null,d=[],p=function(e){if(!e)return"";var a=e.split(".");return a.length<=1?"":a.pop()},l=function(e,t,i){var o=$("<tr>").appendTo(i).addClass("pharmit_styleselectrow"),r=e+"MolStyleSelect";$('<label for="'+r+'">'+e+" Style:</label>").appendTo(o).addClass("pharmit_stylelabel").appendTo($("<td>").appendTo(o));var d=$("<td>").appendTo(o),p=$('<select name="'+r+'" id="'+r+'">').appendTo(d).addClass("pharmit_styleselector");$.each(a,function(e,a){$('<option value="'+e+'">'+a+"</option>").appendTo(p)}),p.val(t),p.selectmenu({width:"9em",appendTo:i,change:function(){p.change()},position:{my:"left top",at:"left bottom",collision:"flip"}}),p.change(function(){var a=this.value,t=function(e,t){"none"==a?t.hidden=!0:(t.colorscheme=a,delete t.hidden)},i=n[e].style,o=n[e].nonbond;$.each(i,t),$.each(o,t);var r=n[e].model;r&&(r.setStyle({},i),r.setStyle({bonds:0},o)),p.selectmenu("refresh"),s.render()}),p.change()};this.appendViewerControls=function(e){var a=$("<table>").appendTo(e);l("Ligand","rasmol",a,null),l("Results","rasmol",a,null),l("Receptor","rasmol",a,null);var t=$("<div>").addClass("pharmit_surfacetransparencydiv").appendTo(e);$('<label for="surfaceopacity">Receptor Surface Opacity:</label>').appendTo(t);var i=$("<div>").addClass("pharmit_surfacetransparencyslider").appendTo(t);$('<div id="surfaceopacity" name="surfaceopacity">').appendTo(i).slider({animate:"fast",step:.05,min:0,max:1,value:.8,change:function(e,a){r.opacity=a.value,null!==o&&s.setSurfaceMaterialStyle(o,r),s.render()}});var n=$("<div>").addClass("pharmit_backgroundcolordiv").appendTo(e);$('<label for="backgroundcolor">Background Color:</label>').appendTo(n);var d=$('<div id="backgroundcolor">').appendTo(n);$('<input type="radio" id="whiteBackground" name="backgroundcolor"><label for="whiteBackground">White</label>').appendTo(d).change(function(){$(this).prop("checked")&&s.setBackgroundColor("white"),d.buttonset("refresh")}).prop("checked",!0),$('<input type="radio" id="blackBackground" name="backgroundcolor"><label for="blackBackground">Black</label>').appendTo(d).change(function(){$(this).prop("checked")&&s.setBackgroundColor("black"),d.buttonset("refresh")}),d.buttonset()};this.setReceptor=function(e,a){var t=n.Receptor.model;if(t&&s.removeModel(t),t=null,null!==o&&s.removeSurface(o),o=null,e){var i=p(a);t=s.addModel(e,i);var d=n.Receptor.style;t.setStyle({},d),t.setStyle({bonds:0},n.Receptor.nonbond),n.Receptor.model=t,s.render(),s.mapAtomProperties($3Dmol.applyPartialCharges,{model:t}),o=s.addSurface($3Dmol.SurfaceType.VDW,r,{model:t},{bonds:0,invert:!0}),s.zoomTo({})}s.render()},this.setLigand=function(e,a){var t=n.Ligand.model;if(t&&s.removeModel(t),t=null,e){var i=p(a);t=s.addModel(e,i),t.setStyle({},n.Ligand.style),t.setStyle({bonds:0},n.Ligand.nonbond),n.Ligand.model=t,s.zoomTo({model:t})}s.render()},this.setView=function(e){e&&s.setView(e)},this.getView=function(){return s.getView()},this.addFeature=function(e,a){var t={center:{x:e.x,y:e.y,z:e.z},radius:e.radius,color:i[e.name],wireframe:!0,linewidth:1.5,clickable:!0,callback:a},n={sphere:null,arrows:[],label:null};if(n.sphere=s.addSphere(t),e.selected&&n.sphere.updateStyle({wireframe:!1}),e.hasvec&&e.vector_on&&e.svector){var o=new $3Dmol.Vector3(e.svector.x,e.svector.y,e.svector.z),r=e.radius+1,p=(r-.5)/r;o=o.normalize();var l=o.clone().multiplyScalar(e.radius).add(e),c=o.clone().multiplyScalar(r).add(e),u={start:l,end:c,radius:.075,radiusRatio:2,mid:p,wireframe:!e.selected,color:i[e.name]};n.arrows.push(s.addArrow(u)),"Aromatic"==e.name&&(l=o.clone().multiplyScalar(-e.radius).add(e),c=o.clone().multiplyScalar(-r).add(e),u.start=l,u.end=c,n.arrows.push(s.addArrow(u)))}if("Hydrophobic"==e.name){var h=e.minsize+":"+e.maxsize;if(":"!=h){var m={position:{x:e.x,y:e.y,z:e.z},showBackground:!0,fontColor:"black",backgroundColor:i[e.name],backgroundOpacity:.5,alignment:$3Dmol.SpriteAlignment.center};n.label=s.addLabel(h,m)}}return s.render(),d.push(n),d.length-1},this.selectFeature=function(e){var a=d[e];a&&a.sphere&&(a.sphere.updateStyle({wireframe:!1}),$.each(a.arrows,function(e,a){a.updateStyle({wireframe:!1})}),s.render())},this.unselectFeature=function(e){var a=d[e];a&&a.sphere&&(a.sphere.updateStyle({wireframe:!0}),$.each(a.arrows,function(e,a){a.updateStyle({wireframe:!0})}),s.render())},this.removeFeature=function(e){var a=d[e];for(a&&(a.sphere&&s.removeShape(a.sphere),$.each(a.arrows,function(e,a){s.removeShape(a)}),a.label&&s.removeLabel(a.label),s.render()),delete d[e];d.length>0&&"undefined"==typeof d[d.length-1];)d.pop()},this.setLeft=function(e){var a=e-t.left;t.left=e,s.translate(a/2,0)},this.setRight=function(e){var a=t.right-e;t.right=e,s.translate(a/2,0)},s=new $3Dmol.GLViewer(e),s.setBackgroundColor("white")}return e}();